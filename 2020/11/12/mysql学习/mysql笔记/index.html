<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha256-AbA177XfpSnFEvgpYu1jMygiLabzPCJCRIBtR5jGc0k=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.13.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="这是文章开头，显示在主页面，详情请点击此处。">
<meta property="og:type" content="article">
<meta property="og:title" content="mysql笔记">
<meta property="og:url" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="Tiger_pop&#39;s Blog">
<meta property="og:description" content="这是文章开头，显示在主页面，详情请点击此处。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-16%2016.41.48.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/51EB2AC5-758D-42CD-947E-6CDE8D1A7654_1_105_c-20221029171307386.jpeg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/077E886C-0AE1-4A76-9B4F-3C7F69A5EB72_1_105_c-20221029171307492.jpeg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/F51A6AD6-9621-44BB-909F-23752F7CC9CD_1_105_c-20221029171307600.jpeg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/2070BC05-6770-4BE7-BAA3-5C88761D03C3_1_105_c-20221029171307786.jpeg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/76024979-5358-4E84-AE98-6CEB66AB4ECE_1_105_c-20221029171307875.jpeg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/image-20220217164752601.png">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-13%2012.08.27.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-13%2012.09.46.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-13%2012.34.01.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-13%2012.54.53.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-14%2011.52.30.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-14%2011.54.40.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-14%2012.25.38.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-14%2012.34.30.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-14%2012.54.57.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-14%2012.01.15.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-14%2012.10.51.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-14%2012.17.47.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-18%2016.10.15.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-18%2016.17.46.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-18%2016.21.58.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-18%2017.04.16.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-18%2017.06.43.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-18%2017.19.24.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-18%2017.36.10.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-18%2018.00.33.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-18%2018.10.49.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-18%2018.24.19.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-19%2022.12.35.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-19%2022.17.41-7034786.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-19%2022.21.55.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-19%2022.29.30.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-19%2022.30.14.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-19%2022.33.47.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-19%2022.34.22.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-19%2022.35.03.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-19%2022.45.15.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-19%2022.51.31.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-20%2013.16.12.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-20%2013.24.22.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-20%2013.27.58.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-20%2013.30.27.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-20%2013.34.32.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-20%2013.36.59.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-20%2013.38.19.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-20%2014.00.51.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-20%2014.01.56.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-20%2014.08.44.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-20%2020.16.59.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-20%2020.17.17.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-20%2020.20.03.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-20%2020.28.57.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-20%2020.39.47.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-20%2021.23.14.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-20%2021.32.18.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-20%2022.11.02.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-20%2022.11.32.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-20%2022.12.58.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-21%2015.51.22.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-22%2022.08.13.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-22%2022.22.03.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-10%2023.36.58.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-10%2023.39.38.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-23%2017.47.03.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-23%2019.06.04.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-23%2019.08.42.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-23%2019.10.55.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-10%2017.34.11.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-10%2017.45.47.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-10%2017.48.12.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-10%2017.54.04.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-10%2017.59.03.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-10%2018.16.26.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-10%2018.29.15.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-10%2018.37.47.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-10%2018.38.37.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-10%2018.42.02.jpg">
<meta property="og:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-10%2018.49.58.jpg">
<meta property="article:published_time" content="2020-11-12T03:31:01.000Z">
<meta property="article:modified_time" content="2022-10-29T09:20:29.090Z">
<meta property="article:author" content="陈宇韶chenyushao">
<meta property="article:tag" content="mysql">
<meta property="article:tag" content="索引">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-16%2016.41.48.jpg">


<link rel="canonical" href="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/","path":"2020/11/12/mysql学习/mysql笔记/","title":"mysql笔记"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>mysql笔记 | Tiger_pop's Blog</title>
  






  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="Tiger_pop's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Tiger_pop's Blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">tiger_pop 的博客</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%EF%BC%9A"><span class="nav-number">1.</span> <span class="nav-text">基础：</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BB%A5%E4%B8%8B%E4%B8%BA%E8%A1%A5%E5%85%85%EF%BC%9A"><span class="nav-number">2.</span> <span class="nav-text">以下为补充：</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%84%8F%E8%AF%BB"><span class="nav-number">2.1.</span> <span class="nav-text">脏读</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0%E4%B8%A2%E5%A4%B1"><span class="nav-number">2.2.</span> <span class="nav-text">更新丢失</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%84%8F%E5%86%99"><span class="nav-number">2.3.</span> <span class="nav-text">脏写</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%8D%E5%8F%AF%E9%87%8D%E5%A4%8D%E8%AF%BB%EF%BC%88%E8%AF%BB%E5%80%BE%E6%96%9C%EF%BC%89"><span class="nav-number">2.4.</span> <span class="nav-text">不可重复读（读倾斜）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B9%BB%E8%AF%BB%EF%BC%88%E5%86%99%E5%80%BE%E6%96%9C%EF%BC%89"><span class="nav-number">2.5.</span> <span class="nav-text">幻读（写倾斜）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E5%A6%82%E4%BD%95%E9%80%9A%E8%BF%87%E9%94%81%E6%9D%A5%E5%AE%9E%E7%8E%B0%EF%BC%9F"><span class="nav-number">2.6.</span> <span class="nav-text">事务隔离如何通过锁来实现？</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#serializable"><span class="nav-number">2.6.1.</span> <span class="nav-text">serializable</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#repeatable-read"><span class="nav-number">2.6.2.</span> <span class="nav-text">repeatable-read</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#read-commited"><span class="nav-number">2.6.3.</span> <span class="nav-text">read-commited</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#read-uncommited"><span class="nav-number">2.6.4.</span> <span class="nav-text">read-uncommited</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#mysql-%E6%8F%90%E9%AB%98"><span class="nav-number">3.</span> <span class="nav-text">mysql 提高</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95"><span class="nav-number">3.1.</span> <span class="nav-text">索引</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E7%B1%BB%EF%BC%9A"><span class="nav-number">3.1.1.</span> <span class="nav-text">分类：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95%E4%B8%8B%E6%8E%A8-icp-%EF%BC%9A"><span class="nav-number">3.1.2.</span> <span class="nav-text">索引下推(icp)：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88%EF%BC%9A"><span class="nav-number">3.1.3.</span> <span class="nav-text">索引失效：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96-%EF%BC%9A"><span class="nav-number">3.1.4.</span> <span class="nav-text">索引优化 ：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95%E7%BC%BA%E7%82%B9%EF%BC%9A"><span class="nav-number">3.1.5.</span> <span class="nav-text">索引缺点：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95%E4%BC%98%E7%82%B9%EF%BC%9A"><span class="nav-number">3.1.6.</span> <span class="nav-text">索引优点：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#B%E6%A0%91"><span class="nav-number">3.1.7.</span> <span class="nav-text">B树</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95%E5%88%9B%E5%BB%BA%E3%80%81%E6%98%BE%E7%A4%BA%E4%B8%8E%E5%88%A0%E9%99%A4"><span class="nav-number">3.1.8.</span> <span class="nav-text">索引创建、显示与删除</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sql%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98"><span class="nav-number">3.2.</span> <span class="nav-text">sql性能问题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%88id%EF%BC%89"><span class="nav-number">3.2.1.</span> <span class="nav-text">（id）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%88select-type%EF%BC%89"><span class="nav-number">3.2.2.</span> <span class="nav-text">（select_type）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%88type%EF%BC%89%E7%B4%A2%E5%BC%95%E7%B1%BB%E5%9E%8B%E3%80%81%E7%B1%BB%E5%9E%8B"><span class="nav-number">3.2.3.</span> <span class="nav-text">（type）索引类型、类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%88possible-keys%EF%BC%89%E5%8F%AF%E8%83%BD%E7%94%A8%E5%88%B0%E7%9A%84%E7%B4%A2%E5%BC%95"><span class="nav-number">3.2.4.</span> <span class="nav-text">（possible_keys）可能用到的索引</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%88key%EF%BC%89%E5%AE%9E%E9%99%85%E7%94%A8%E5%88%B0%E7%9A%84%E7%B4%A2%E5%BC%95"><span class="nav-number">3.2.5.</span> <span class="nav-text">（key）实际用到的索引</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%88key-len%EF%BC%89%E7%B4%A2%E5%BC%95%E7%9A%84%E9%95%BF%E5%BA%A6%EF%BC%8C%E7%94%A8%E4%BA%8E%E5%88%A4%E6%96%AD%E5%A4%8D%E5%90%88%E7%B4%A2%E5%BC%95%E6%98%AF%E5%90%A6%E8%A2%AB%E5%AE%8C%E5%85%A8%E4%BD%BF%E7%94%A8%E3%80%82"><span class="nav-number">3.2.6.</span> <span class="nav-text">（key_len）索引的长度，用于判断复合索引是否被完全使用。</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%88ref%EF%BC%89%E8%A1%A8%E6%98%8E%E5%BD%93%E5%89%8D%E8%A1%A8%E6%89%80%E5%8F%82%E7%85%A7%E7%9A%84%E5%AD%97%E6%AE%B5%E3%80%82"><span class="nav-number">3.2.7.</span> <span class="nav-text">（ref）表明当前表所参照的字段。</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%88rows%EF%BC%89%E5%AE%9E%E9%99%85%E9%80%9A%E8%BF%87%E7%B4%A2%E5%BC%95%E6%89%AB%E6%8F%8F%E7%9A%84-%E6%95%B0%E6%8D%AE%E4%B8%AA%E6%95%B0%E3%80%82"><span class="nav-number">3.2.8.</span> <span class="nav-text">（rows）实际通过索引扫描的 数据个数。</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%88Extra%EF%BC%89"><span class="nav-number">3.2.9.</span> <span class="nav-text">（Extra）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1%E3%80%81using-filesort%EF%BC%9A"><span class="nav-number">3.2.9.1.</span> <span class="nav-text">1、using filesort：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2%E3%80%81using-temporary%EF%BC%9A"><span class="nav-number">3.2.9.2.</span> <span class="nav-text">2、using temporary：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3%E3%80%81using-index"><span class="nav-number">3.2.9.3.</span> <span class="nav-text">3、using index</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4%E3%80%81using-where"><span class="nav-number">3.2.9.4.</span> <span class="nav-text">4、using where</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5%E3%80%81impossible-where"><span class="nav-number">3.2.9.5.</span> <span class="nav-text">5、impossible where</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%98%E5%8C%96%E4%BA%8B%E4%BE%8B"><span class="nav-number">3.2.10.</span> <span class="nav-text">优化事例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%88%E4%B8%80%EF%BC%89%E5%A4%8D%E5%90%88%E7%B4%A2%E5%BC%95"><span class="nav-number">3.2.10.1.</span> <span class="nav-text">（一）复合索引</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%88%E4%BA%8C%EF%BC%89%E5%8D%95%E8%A1%A8%E4%BC%98%E5%8C%96"><span class="nav-number">3.2.10.2.</span> <span class="nav-text">（二）单表优化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%88%E4%B8%89%EF%BC%89%E4%B8%A4%E8%A1%A8%E4%BC%98%E5%8C%96"><span class="nav-number">3.2.10.3.</span> <span class="nav-text">（三）两表优化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%88%E5%9B%9B%EF%BC%89%E4%B8%89%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="nav-number">3.2.10.4.</span> <span class="nav-text">（四）三表查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%88%E9%81%BF%E5%85%8D%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88%EF%BC%89"><span class="nav-number">3.2.10.5.</span> <span class="nav-text">（避免索引失效）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%88%E5%85%B6%E5%AE%83%E4%BC%98%E5%8C%96%E6%96%B9%E6%B3%95%EF%BC%89"><span class="nav-number">3.2.10.6.</span> <span class="nav-text">（其它优化方法）</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1%E3%80%81exists%E5%92%8C-in"><span class="nav-number">3.2.10.6.1.</span> <span class="nav-text">1、exists和 in</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2%E3%80%81order-by-%E4%BC%98%E5%8C%96"><span class="nav-number">3.2.10.6.2.</span> <span class="nav-text">2、order by 优化</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%85%A2%E6%97%A5%E5%BF%97%E6%9F%A5%E8%AF%A2"><span class="nav-number">3.3.</span> <span class="nav-text">慢日志查询</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A8%A1%E6%8B%9F%E6%B5%B7%E9%87%8F%E6%95%B0%E6%8D%AE%E4%BC%98%E5%8C%96"><span class="nav-number">3.4.</span> <span class="nav-text">模拟海量数据优化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8F%92%E5%85%A5%E6%B5%B7%E9%87%8F%E6%95%B0%E6%8D%AE"><span class="nav-number">3.4.1.</span> <span class="nav-text">插入海量数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E6%9E%90%E6%B5%B7%E9%87%8F%E6%95%B0%E6%8D%AE"><span class="nav-number">3.4.2.</span> <span class="nav-text">分析海量数据</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MySQL%E7%9A%84%E9%94%81"><span class="nav-number">3.5.</span> <span class="nav-text">MySQL的锁</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A1%A8%E9%94%81%E7%A4%BA%E4%BE%8B"><span class="nav-number">3.5.1.</span> <span class="nav-text">表锁示例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#read%E9%94%81%E6%80%BB%E7%BB%93%EF%BC%9A"><span class="nav-number">3.5.1.1.</span> <span class="nav-text">read锁总结：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#write%E9%94%81%E6%80%BB%E7%BB%93%EF%BC%9A"><span class="nav-number">3.5.1.2.</span> <span class="nav-text">write锁总结：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%86%E6%9E%90%E8%A1%A8%E9%94%81%EF%BC%9A"><span class="nav-number">3.5.1.3.</span> <span class="nav-text">分析表锁：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A1%8C%E9%94%81%E7%A4%BA%E4%BE%8B"><span class="nav-number">3.5.2.</span> <span class="nav-text">行锁示例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A1%8C%E9%94%81%E6%80%BB%E7%BB%93%EF%BC%88%E5%85%B3%E9%97%AD%E4%BA%86%E8%87%AA%E5%8A%A8%E6%8F%90%E4%BA%A4%EF%BC%89%EF%BC%9A"><span class="nav-number">3.5.2.1.</span> <span class="nav-text">行锁总结（关闭了自动提交）：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A1%8C%E9%94%81%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%EF%BC%9A"><span class="nav-number">3.5.2.2.</span> <span class="nav-text">行锁注意事项：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%84%8F%E5%90%91%E9%94%81"><span class="nav-number">3.5.3.</span> <span class="nav-text">意向锁</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A1%8C%E9%94%81%E7%9A%84%E5%8C%BA%E9%97%B4"><span class="nav-number">3.5.4.</span> <span class="nav-text">行锁的区间</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MVCC-%E5%BF%AB%E7%85%A7%E8%AF%BB%EF%BC%88%E4%B8%8D%E7%94%A8%E9%94%81%EF%BC%89%E5%AE%9E%E7%8E%B0%E9%9A%94%E7%A6%BB"><span class="nav-number">3.6.</span> <span class="nav-text">MVCC 快照读（不用锁）实现隔离</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E2%80%9C%E5%BF%AB%E7%85%A7%E8%AF%BB%E2%80%9D-%E7%BB%93%E5%90%88-%E2%80%9C%E5%BD%93%E5%89%8D%E8%AF%BB%E2%80%9D"><span class="nav-number">3.6.1.</span> <span class="nav-text">“快照读” 结合 “当前读”</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="陈宇韶chenyushao"
      src="/images/my.jpg">
  <p class="site-author-name" itemprop="name">陈宇韶chenyushao</p>
  <div class="site-description" itemprop="description">爱学习、爱工作、爱生活;         微信号: Tiger_and_master;         手机号码:18515678348 </div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">427</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">26</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">201</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/my.jpg">
      <meta itemprop="name" content="陈宇韶chenyushao">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tiger_pop's Blog">
      <meta itemprop="description" content="爱学习、爱工作、爱生活;         微信号: Tiger_and_master;         手机号码:18515678348 ">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="mysql笔记 | Tiger_pop's Blog">
      <meta itemprop="description" content="这是文章开头，显示在主页面，详情请点击此处。">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          mysql笔记
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-11-12 11:31:01" itemprop="dateCreated datePublished" datetime="2020-11-12T11:31:01+08:00">2020-11-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-10-29 17:20:29" itemprop="dateModified" datetime="2022-10-29T17:20:29+08:00">2022-10-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/mysql/" itemprop="url" rel="index"><span itemprop="name">mysql</span></a>
        </span>
    </span>

  
</div>

            <div class="post-description">这是文章开头，显示在主页面，详情请点击此处。</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>​	</p>
<p>参考：<span id="more"></span></p>
<h1 id="基础："><a href="#基础：" class="headerlink" title="基础："></a>基础：</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 进入mysql</span></span><br><span class="line">mysql <span class="operator">-</span>uroot <span class="operator">-</span>p[密码]</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 改用户名</span></span><br><span class="line"><span class="comment">-- use mysql;</span></span><br><span class="line"><span class="comment">-- update user set user=&#x27;chenyushao&#x27; where user=&#x27;root&#x27;;</span></span><br><span class="line"><span class="comment">-- select user,host from mysql.user;</span></span><br><span class="line"><span class="comment">-- flush privileges;</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+-----------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">user</span>             <span class="operator">|</span> host      <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+-----------+</span></span><br><span class="line"><span class="operator">|</span> chenyushao       <span class="operator">|</span> localhost <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql.infoschema <span class="operator">|</span> localhost <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql.session    <span class="operator">|</span> localhost <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql.sys        <span class="operator">|</span> localhost <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+-----------+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> database test;  #创建新的名叫test的数据库</span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> databases;  #查看由哪些数据库</span><br><span class="line"></span><br><span class="line">use test;    #选中数据库</span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> tables;    #查看数据库里的表</span><br><span class="line"></span><br><span class="line"><span class="keyword">truncate</span> <span class="keyword">table</span> 表名 # 删除表中数据 <span class="keyword">delete</span> 可以事物回滚，<span class="keyword">truncate</span>不可以。</span><br><span class="line"></span><br><span class="line">#创建数据表pet</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> pet(name <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">   owner <span class="type">VARCHAR</span>(<span class="number">20</span>), </span><br><span class="line">   species </span><br><span class="line">   <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">   sex <span class="type">CHAR</span>(<span class="number">1</span>),</span><br><span class="line">   brith <span class="type">DATE</span>,</span><br><span class="line">   death <span class="type">DATE</span>);  </span><br><span class="line"></span><br><span class="line"><span class="keyword">describe</span> pet;   #查看数据表pet结构</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> pet #查看pet表中记录</span><br><span class="line"></span><br><span class="line">#往数据表里添加数据</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> pet</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="string">&#x27;Puffball&#x27;</span>,<span class="string">&#x27;Diane&#x27;</span>,<span class="string">&#x27;hamster&#x27;</span>,<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;1999-03-30&#x27;</span>,<span class="keyword">NULL</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#删除数据</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> pet <span class="keyword">where</span> name<span class="operator">=</span>‘旺财’;</span><br><span class="line"></span><br><span class="line">#修改数据，注意是<span class="keyword">update</span>不是updata</span><br><span class="line"><span class="keyword">update</span> pet <span class="keyword">set</span> name<span class="operator">=</span>‘旺旺财’ <span class="keyword">where</span> owner<span class="operator">=</span>‘周星驰’;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～#～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～</span><br><span class="line">#mysql建表约束</span><br><span class="line"><span class="number">1.</span>#主键约束</span><br><span class="line">   它能够唯一确定一张表中的一条记录，也就是给某个字段添加约束，使得该字段不重复且&quot;不为空&quot;;</span><br><span class="line">   <span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">user</span>(id <span class="type">int</span> <span class="keyword">primary</span> key, name <span class="type">varchar</span>(<span class="number">20</span>)); #key确定了id为主键,也就是不能再有出现相同的id了,name没做主键约束，故可以插入一样的name;</span><br><span class="line">   </span><br><span class="line">   #联合主键（id和name组成的这一对字段，要不为空，且不能id和name同时相同，id或name单个出现相同的字段是可以的，同时id和name任意一个不能为空<span class="keyword">null</span>。）</span><br><span class="line">   <span class="keyword">create</span> <span class="keyword">table</span> user3(id <span class="type">int</span>,name <span class="type">varchar</span>(<span class="number">20</span>), password <span class="type">varchar</span>(<span class="number">20</span>), <span class="keyword">primary</span> key(id,name) );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>#自增约束</span><br><span class="line">   <span class="keyword">create</span> <span class="keyword">table</span> userthree(id <span class="type">int</span> <span class="keyword">primary</span> key auto_increment,   name <span class="type">varchar</span>(<span class="number">20</span> )  );</span><br><span class="line">   </span><br><span class="line">   #仅仅添加name，id 会自动生成<span class="number">1</span>，若再添加一个name（name里面的字段相同不相同都不影响），对应的id会变成<span class="number">2</span>….</span><br><span class="line">   <span class="keyword">create</span> <span class="keyword">table</span> userthree(id <span class="type">int</span> <span class="keyword">primary</span> key auto_increment, name <span class="type">varchar</span>(<span class="number">20</span>));</span><br><span class="line"></span><br><span class="line">   #忘记创建主键约束了，怎么办？</span><br><span class="line">   <span class="keyword">create</span> <span class="keyword">table</span> user4(       id <span class="type">int</span>,</span><br><span class="line">      name <span class="type">varchar</span>(<span class="number">20</span>)   );</span><br><span class="line"></span><br><span class="line">   <span class="keyword">alter</span> <span class="keyword">table</span> user4 <span class="keyword">add</span> <span class="keyword">primary</span> key(id); #后续定义主键 （有时候会说找不到id这个field不知道为什么，换别的field就可以。）</span><br><span class="line">   <span class="keyword">alter</span> <span class="keyword">table</span> user4 modify id <span class="type">int</span> <span class="keyword">primary</span> key;这样也可以</span><br><span class="line">   <span class="keyword">alter</span> <span class="keyword">table</span> user4 <span class="keyword">drop</span> <span class="keyword">primary</span> key;#后续删除主键</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>#唯一约束</span><br><span class="line">   约束修饰的字段值不可以重复。</span><br><span class="line">   <span class="keyword">create</span> <span class="keyword">table</span> user5(id <span class="type">int</span>,name <span class="type">varchar</span>(<span class="number">20</span>));</span><br><span class="line">   <span class="keyword">alter</span> <span class="keyword">table</span> user5 <span class="keyword">add</span> <span class="keyword">unique</span>(name);</span><br><span class="line">   #或者</span><br><span class="line">   <span class="keyword">create</span> <span class="keyword">table</span> user6(id <span class="type">int</span>,name <span class="type">varchar</span>(<span class="number">20</span>),<span class="keyword">unique</span>(name));</span><br><span class="line"></span><br><span class="line">   <span class="keyword">create</span> <span class="keyword">table</span> user7(id <span class="type">int</span>,</span><br><span class="line">      name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">      <span class="keyword">unique</span>(id,name) #类似联合主键，但是这样key会落到id上，后续要删除就<span class="keyword">alter</span> <span class="keyword">table</span> user6 <span class="keyword">drop</span> index id;即可</span><br><span class="line">   );</span><br><span class="line">    #删除唯一约束</span><br><span class="line">   <span class="keyword">alter</span> <span class="keyword">table</span> user6 <span class="keyword">drop</span> index name;</span><br><span class="line">   #modify添加唯一约束</span><br><span class="line">   <span class="keyword">alter</span> <span class="keyword">table</span> user6 modify name <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">unique</span>;</span><br><span class="line"></span><br><span class="line">#临时总结：</span><br><span class="line">   一、建表的时候添加约束</span><br><span class="line">   <span class="keyword">alter</span> <span class="keyword">table</span> ... add...</span><br><span class="line">   <span class="keyword">alter</span> <span class="keyword">table</span> ... modify ...</span><br><span class="line">    二、删除约束(key落到谁头上删除谁就可以了)</span><br><span class="line">    <span class="keyword">alter</span> <span class="keyword">table</span> ... <span class="keyword">drop</span> ...</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span>#非空约束</span><br><span class="line">    字面意思，</span><br><span class="line">   <span class="keyword">create</span> <span class="keyword">table</span> user9(</span><br><span class="line">      id <span class="type">int</span>,</span><br><span class="line">      name <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">   );</span><br><span class="line">    <span class="keyword">insert</span> <span class="keyword">into</span> user9 (id) <span class="keyword">values</span>(<span class="number">1</span>);#错</span><br><span class="line">    <span class="keyword">insert</span> <span class="keyword">into</span> user9 <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;张三&#x27;</span>);#对</span><br><span class="line"></span><br><span class="line">   inser <span class="keyword">into</span> user9 (name) <span class="keyword">values</span>(<span class="string">&#x27;李四&#x27;</span>);#对 <span class="keyword">right</span></span><br><span class="line"><span class="number">5.</span>#默认约束</span><br><span class="line">   当插入字段值时，如果没有传值，就会使用默认值</span><br><span class="line">   <span class="keyword">create</span> <span class="keyword">table</span> user10(</span><br><span class="line">      id <span class="type">int</span>,</span><br><span class="line">      name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">      age <span class="type">int</span> <span class="keyword">default</span> <span class="number">10</span></span><br><span class="line">   );</span><br><span class="line">    #如果没有传入值，age就用<span class="number">10</span>，传入<span class="number">9</span>就变成了<span class="number">9</span>；</span><br><span class="line">   <span class="keyword">insert</span> <span class="keyword">into</span> user10 (id,name,age) <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;zhangsan&#x27;</span>,<span class="number">9</span>);</span><br><span class="line">   <span class="keyword">insert</span> <span class="keyword">into</span> user10 (id,name) <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;zhangsan&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="number">6.</span>#外键约束</span><br><span class="line">   涉及：  父表、子表。</span><br><span class="line">      主表、副表。</span><br><span class="line"></span><br><span class="line">   #（班级）</span><br><span class="line">   <span class="keyword">create</span> <span class="keyword">table</span> classes(</span><br><span class="line">      id <span class="type">int</span> <span class="keyword">primary</span> key,</span><br><span class="line">      name <span class="type">varchar</span>(<span class="number">20</span>)</span><br><span class="line">   );</span><br><span class="line">   #学生表</span><br><span class="line">   <span class="keyword">create</span> <span class="keyword">table</span> students(</span><br><span class="line">      id <span class="type">int</span> <span class="keyword">primary</span> key,</span><br><span class="line">      name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">      class_id <span class="type">int</span>,</span><br><span class="line">      <span class="keyword">foreign</span> key(class_id) <span class="keyword">references</span> classes(id)# 指明学生的class_id必须引用来自classes的id</span><br><span class="line">   );</span><br><span class="line">   <span class="keyword">insert</span> <span class="keyword">into</span> classes <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;一班&#x27;</span>);</span><br><span class="line">   <span class="keyword">insert</span> <span class="keyword">into</span> classes <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">&#x27;二班&#x27;</span>);</span><br><span class="line">   <span class="keyword">insert</span> <span class="keyword">into</span> classes <span class="keyword">values</span>(<span class="number">3</span>,<span class="string">&#x27;三班&#x27;</span>);</span><br><span class="line">   <span class="keyword">insert</span> <span class="keyword">into</span> classes <span class="keyword">values</span>(<span class="number">4</span>,<span class="string">&#x27;四班&#x27;</span>);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">insert</span> <span class="keyword">into</span> students <span class="keyword">values</span>(<span class="number">1001</span>,<span class="string">&#x27;张三&#x27;</span>,<span class="number">1</span>);</span><br><span class="line">   <span class="keyword">insert</span> <span class="keyword">into</span> students <span class="keyword">values</span>(<span class="number">1002</span>,<span class="string">&#x27;张三&#x27;</span>,<span class="number">2</span>);</span><br><span class="line">   <span class="keyword">insert</span> <span class="keyword">into</span> students <span class="keyword">values</span>(<span class="number">1003</span>,<span class="string">&#x27;张三&#x27;</span>,<span class="number">3</span>);</span><br><span class="line">   <span class="keyword">insert</span> <span class="keyword">into</span> students <span class="keyword">values</span>(<span class="number">1004</span>,<span class="string">&#x27;张三&#x27;</span>,<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">insert</span> <span class="keyword">into</span> students <span class="keyword">values</span>(<span class="number">1005</span>,<span class="string">&#x27;李四&#x27;</span>,<span class="number">5</span>);#报错 students`, <span class="keyword">CONSTRAINT</span> `students_ibfk_1` <span class="keyword">FOREIGN</span> KEY (`class_id`) <span class="keyword">REFERENCES</span> `classes` (`id</span><br><span class="line"></span><br><span class="line">   <span class="keyword">delete</span> <span class="keyword">from</span> classes <span class="keyword">where</span> id<span class="operator">=</span><span class="number">4</span>; # 报错，已经被引用，父表此项就不能删除。</span><br><span class="line"></span><br><span class="line">    #<span class="number">1</span>、父表 中没有的数据值，在子表中是不可以使用的</span><br><span class="line">   #<span class="number">2</span>、子表已经引用了父表的数据后，父表的此这条记录不能被删除。</span><br><span class="line"></span><br><span class="line">#<span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span></span><br><span class="line">#<span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span></span><br><span class="line"></span><br><span class="line">#数据库三大设计范式</span><br><span class="line"></span><br><span class="line">#第一范式</span><br><span class="line"><span class="comment">--1NF</span></span><br><span class="line">数据表中所有的字段都是不可分割的原子值。</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> students2(</span><br><span class="line">   id <span class="type">int</span>,</span><br><span class="line">   name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">   address <span class="type">varchar</span>(<span class="number">30</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> students2 <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;张三&#x27;</span>,<span class="string">&#x27;湖南省衡阳市雁峰区&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> students2 <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">&#x27;李四&#x27;</span>,<span class="string">&#x27;湖南省衡阳市蒸湘区&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> students2 <span class="keyword">values</span>(<span class="number">3</span>,<span class="string">&#x27;王五&#x27;</span>,<span class="string">&#x27;湖南省衡阳市石鼓区&#x27;</span>);</span><br><span class="line">   #字段还可以继续拆分的，就不满足第一范式,上面就是不满足的address，就是说要尽可能拆分的细。</span><br><span class="line">   #范式，设计的越详细，对于某一些实际操作可能更好，但是不一定都是好处。</span><br><span class="line"></span><br><span class="line">#第二范式</span><br><span class="line"><span class="comment">--2NF</span></span><br><span class="line"><span class="comment">--必须是满足第一范式的前提下，第二范式要求，除主键外的每一列都必须完全依赖主键。</span></span><br><span class="line"><span class="comment">--提示：不完全依赖，只可能发生在联合主键的情况下。</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> myorder(</span><br><span class="line">   product_id <span class="type">int</span>,</span><br><span class="line">   customer_id <span class="type">int</span>,</span><br><span class="line">   product_name <span class="type">varchar</span>(<span class="number">20</span>),#只和product_id有关</span><br><span class="line">   customer_name <span class="type">varchar</span>(<span class="number">20</span>),#只和customer_id有关</span><br><span class="line">   <span class="keyword">primary</span> key(product_id,customer_id)#联合主键</span><br><span class="line">);</span><br><span class="line">   #以上，除主键以外的其他列，只依赖于主键的部分字段。不满足第二范式。</span><br><span class="line"></span><br><span class="line"><span class="comment">--拆表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> myorder2(</span><br><span class="line">   order_id <span class="type">int</span> <span class="keyword">primary</span> key,</span><br><span class="line">   product_id <span class="type">int</span>,</span><br><span class="line">   customer_id <span class="type">int</span></span><br><span class="line">);#以上的product_id和customer_id完全依赖于order_id</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> product(</span><br><span class="line">   id <span class="type">int</span> <span class="keyword">primary</span> key,</span><br><span class="line">   name <span class="type">varchar</span>(<span class="number">20</span>)</span><br><span class="line">);#以上的name 完全依赖于id</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> customer(</span><br><span class="line">   id <span class="type">int</span> <span class="keyword">primary</span> key,</span><br><span class="line">   name <span class="type">varchar</span>(<span class="number">20</span>)</span><br><span class="line">);#以上的name 完全依赖于id</span><br><span class="line"></span><br><span class="line"><span class="comment">--分成三个表以后，就满足了第二范式的设计规范。</span></span><br><span class="line"></span><br><span class="line">另一个解释案例：</span><br><span class="line">讲师P 性别 班级P         教室 代课时间 开始 结束</span><br><span class="line">韩忠康 Male php0331 <span class="number">102</span> <span class="number">30</span>天 <span class="number">2013</span><span class="number">-03</span><span class="number">-31</span> <span class="number">2013</span><span class="number">-05</span><span class="number">-05</span></span><br><span class="line">韩忠康 Male php0228 <span class="number">106</span> <span class="number">30</span>天 <span class="number">2013</span><span class="number">-02</span><span class="number">-28</span> <span class="number">2013</span><span class="number">-03</span><span class="number">-30</span></span><br><span class="line">韩顺平 male Php0228 <span class="number">106</span> <span class="number">15</span>天 <span class="number">2013</span><span class="number">-03</span><span class="number">-31</span> <span class="number">2013</span><span class="number">-04</span><span class="number">-20</span></span><br><span class="line"></span><br><span class="line">上面的设计可以用讲师P，班级，两个字段作为组合主键，但是问题来了，那么后面的教室仅仅由班级字段(组合主键中的一条)就可以确定，即所谓教室部分依赖于组合主键，那么就不符合<span class="number">2</span>NF。</span><br><span class="line"></span><br><span class="line">#第三范式</span><br><span class="line"><span class="comment">--3NF</span></span><br><span class="line"><span class="comment">--在满足第二范式的基础上，除开主键列的其他列之间，不能有传递依赖关系。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> myorder(</span><br><span class="line">   order_id <span class="type">int</span> <span class="keyword">primary</span> key,</span><br><span class="line">   product_id <span class="type">int</span>,</span><br><span class="line">   customer_id <span class="type">int</span>,</span><br><span class="line">   customer_phone <span class="type">varchar</span>(<span class="number">15</span>)#和customer_id有关,customer_id非主键。所以不满足第三范式。</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">--拆分</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> myorder(</span><br><span class="line">   order_id <span class="type">int</span> <span class="keyword">primary</span> key,</span><br><span class="line">   product_id <span class="type">int</span>,</span><br><span class="line">   customer_id <span class="type">int</span>,</span><br><span class="line">);</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> customer(</span><br><span class="line">   customer_id <span class="type">int</span> <span class="keyword">primary</span> key,</span><br><span class="line">   name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">   phone <span class="type">varchar</span>(<span class="number">15</span>)</span><br><span class="line">);</span><br><span class="line">#以上满足了第三范式。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#<span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span><span class="operator">~</span></span><br><span class="line">#这里的快速注释 ，是command<span class="operator">+</span><span class="operator">/</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 学生表</span></span><br><span class="line"><span class="comment">-- Student</span></span><br><span class="line"><span class="comment">-- 学号</span></span><br><span class="line"><span class="comment">-- 姓名</span></span><br><span class="line"><span class="comment">-- 性别</span></span><br><span class="line"><span class="comment">-- 出生年月日</span></span><br><span class="line"><span class="comment">-- 所在班级</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> student(</span><br><span class="line">    sno <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">primary</span> key,</span><br><span class="line">    sname <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    ssex <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    sbirthday datetime,</span><br><span class="line">    class <span class="type">varchar</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">--课程表</span></span><br><span class="line"><span class="comment">-- Course</span></span><br><span class="line"><span class="comment">-- 课程号</span></span><br><span class="line"><span class="comment">-- 课程名称</span></span><br><span class="line"><span class="comment">-- 教师编号</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> course(</span><br><span class="line">    cno <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">primary</span> key,</span><br><span class="line">    cname <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    tno <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>, <span class="comment">-- 因为这里的老师编号是来源于老师表的老师编号，所以需要外键约束。</span></span><br><span class="line">    <span class="keyword">foreign</span> key(tno) <span class="keyword">references</span> teacher(tno)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 成绩表</span></span><br><span class="line"><span class="comment">-- Sorce</span></span><br><span class="line"><span class="comment">-- 学号</span></span><br><span class="line"><span class="comment">-- 课程号</span></span><br><span class="line"><span class="comment">-- 成绩</span></span><br><span class="line">分数表的错误设计：</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> score(</span><br><span class="line">    sno <span class="type">varchar</span> (<span class="number">20</span>) <span class="keyword">primary</span> key, <span class="comment">-- 这里有问题见下文解释。</span></span><br><span class="line">    cno <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    degree <span class="type">decimal</span>, <span class="comment">-- 一种数值类型</span></span><br><span class="line">    <span class="keyword">foreign</span> key(sno) <span class="keyword">references</span> student(sno),</span><br><span class="line">    <span class="keyword">foreign</span> key(cno) <span class="keyword">references</span> course(cno)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 教师表</span></span><br><span class="line"><span class="comment">-- Teacher</span></span><br><span class="line"><span class="comment">-- 教师编号</span></span><br><span class="line"><span class="comment">-- 教师姓名</span></span><br><span class="line"><span class="comment">-- 教师性别</span></span><br><span class="line"><span class="comment">-- 出生年月</span></span><br><span class="line"><span class="comment">-- 职称</span></span><br><span class="line"><span class="comment">-- 所在部门</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> teacher(</span><br><span class="line">    tno <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">primary</span> key,</span><br><span class="line">    tname <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    tsex <span class="type">varchar</span> (<span class="number">10</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    tbirthday datetime <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    prof <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    depart <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 往数据表中添加数据。</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> student <span class="keyword">values</span>(<span class="string">&#x27;18416&#x27;</span>,<span class="string">&#x27;陈宇韶&#x27;</span>,<span class="string">&#x27;男&#x27;</span>,<span class="string">&#x27;1993-4-6&#x27;</span>,<span class="string">&#x27;184&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> student <span class="keyword">values</span>(<span class="string">&#x27;18438&#x27;</span>,<span class="string">&#x27;董文勇&#x27;</span>,<span class="string">&#x27;男&#x27;</span>,<span class="string">&#x27;1993-4-6&#x27;</span>,<span class="string">&#x27;184&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> student <span class="keyword">values</span>(<span class="string">&#x27;18435&#x27;</span>,<span class="string">&#x27;宁鹏飞&#x27;</span>,<span class="string">&#x27;男&#x27;</span>,<span class="string">&#x27;1993-4-6&#x27;</span>,<span class="string">&#x27;184&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> student <span class="keyword">values</span>(<span class="string">&#x27;18434&#x27;</span>,<span class="string">&#x27;刘雯&#x27;</span>,<span class="string">&#x27;男&#x27;</span>,<span class="string">&#x27;1993-4-6&#x27;</span>,<span class="string">&#x27;184&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> student <span class="keyword">values</span>(<span class="string">&#x27;18433&#x27;</span>,<span class="string">&#x27;陶碧云&#x27;</span>,<span class="string">&#x27;男&#x27;</span>,<span class="string">&#x27;1993-4-6&#x27;</span>,<span class="string">&#x27;184&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> student <span class="keyword">values</span>(<span class="string">&#x27;18432&#x27;</span>,<span class="string">&#x27;曹杰&#x27;</span>,<span class="string">&#x27;男&#x27;</span>,<span class="string">&#x27;1993-4-6&#x27;</span>,<span class="string">&#x27;184&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> student <span class="keyword">values</span>(<span class="string">&#x27;18417&#x27;</span>,<span class="string">&#x27;秦壁辉&#x27;</span>,<span class="string">&#x27;男&#x27;</span>,<span class="string">&#x27;1993-4-6&#x27;</span>,<span class="string">&#x27;184&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> student <span class="keyword">values</span>(<span class="string">&#x27;18410&#x27;</span>,<span class="string">&#x27;秦诗&#x27;</span>,<span class="string">&#x27;女&#x27;</span>,<span class="string">&#x27;1995-4-6&#x27;</span>,<span class="string">&#x27;183&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> student <span class="keyword">values</span>(<span class="string">&#x27;18422&#x27;</span>,<span class="string">&#x27;秦静静&#x27;</span>,<span class="string">&#x27;女&#x27;</span>,<span class="string">&#x27;1992-4-6&#x27;</span>,<span class="string">&#x27;181&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> teacher <span class="keyword">values</span>(<span class="string">&#x27;1841&#x27;</span>,<span class="string">&#x27;李辉&#x27;</span>,<span class="string">&#x27;男&#x27;</span>,<span class="string">&#x27;1983-4-8&#x27;</span>,<span class="string">&#x27;副教授&#x27;</span>,<span class="string">&#x27;数学系&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> teacher <span class="keyword">values</span>(<span class="string">&#x27;1842&#x27;</span>,<span class="string">&#x27;朱文&#x27;</span>,<span class="string">&#x27;女&#x27;</span>,<span class="string">&#x27;1983-7-9&#x27;</span>,<span class="string">&#x27;副教授&#x27;</span>,<span class="string">&#x27;语文系&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> teacher <span class="keyword">values</span>(<span class="string">&#x27;1843&#x27;</span>,<span class="string">&#x27;何勇&#x27;</span>,<span class="string">&#x27;男&#x27;</span>,<span class="string">&#x27;1988-2-3&#x27;</span>,<span class="string">&#x27;副教授&#x27;</span>,<span class="string">&#x27;英语系&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> course <span class="keyword">values</span>(<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;数学&#x27;</span>,<span class="string">&#x27;1841&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> course <span class="keyword">values</span>(<span class="string">&#x27;2&#x27;</span>,<span class="string">&#x27;语文&#x27;</span>,<span class="string">&#x27;1842&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> course <span class="keyword">values</span>(<span class="string">&#x27;3&#x27;</span>,<span class="string">&#x27;英语&#x27;</span>,<span class="string">&#x27;1843&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> score;</span><br><span class="line">分数表的正确设计：</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> score(</span><br><span class="line">    sno <span class="type">varchar</span> (<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>, <span class="comment">-- 像上文，若学生编号作为score的主键，则一个分数对应的学生学号是唯一的，也就是score和sno一一对应了，也就是一个学生只能有一个成绩了，实际上学生每个course都有一个成绩。</span></span><br><span class="line">    cno <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    degree <span class="type">decimal</span>, <span class="comment">-- 一种数值类型</span></span><br><span class="line">    <span class="keyword">foreign</span> key(sno) <span class="keyword">references</span> student(sno),</span><br><span class="line">    <span class="keyword">foreign</span> key(cno) <span class="keyword">references</span> course(cno),</span><br><span class="line">    <span class="keyword">primary</span> key(sno,cno)   <span class="comment">-- score与 （学生编号、课程号）的整体才是一一对应的关系，（学生编号、课程号）对应一个唯一的分数。</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> score <span class="keyword">values</span>(<span class="string">&#x27;18416&#x27;</span>,<span class="string">&#x27;1&#x27;</span>,<span class="number">120</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> score <span class="keyword">values</span>(<span class="string">&#x27;18438&#x27;</span>,<span class="string">&#x27;1&#x27;</span>,<span class="number">111</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> score <span class="keyword">values</span>(<span class="string">&#x27;18435&#x27;</span>,<span class="string">&#x27;2&#x27;</span>,<span class="number">119</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> score <span class="keyword">values</span>(<span class="string">&#x27;18434&#x27;</span>,<span class="string">&#x27;3&#x27;</span>,<span class="number">99</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> score <span class="keyword">values</span>(<span class="string">&#x27;18433&#x27;</span>,<span class="string">&#x27;2&#x27;</span>,<span class="number">109</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> score <span class="keyword">values</span>(<span class="string">&#x27;18432&#x27;</span>,<span class="string">&#x27;1&#x27;</span>,<span class="number">88</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> score <span class="keyword">values</span>(<span class="string">&#x27;18417&#x27;</span>,<span class="string">&#x27;3&#x27;</span>,<span class="number">115</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> score <span class="keyword">values</span>(<span class="string">&#x27;18417&#x27;</span>,<span class="string">&#x27;2&#x27;</span>,<span class="number">115</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> score <span class="keyword">values</span>(<span class="string">&#x27;18416&#x27;</span>,<span class="string">&#x27;2&#x27;</span>,<span class="number">120</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> score <span class="keyword">values</span>(<span class="string">&#x27;18416&#x27;</span>,<span class="string">&#x27;1&#x27;</span>,<span class="number">121</span>);<span class="comment">-- 报错，（学号、课程）对应唯一分数。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询练习</span></span><br><span class="line"><span class="comment">-- ～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～</span></span><br><span class="line"><span class="comment">-- 1、查询student表的所有记录。</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student;  <span class="comment">-- * 表示所有的字段，就是各个属性。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2、查询student表的sname，ssex，class字段（列）</span></span><br><span class="line"><span class="keyword">select</span> sname ,ssex,class <span class="keyword">from</span> student; <span class="comment">-- 查这三个字段。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3、查询教师所有单位，即不重复的depart字段（列）。</span></span><br><span class="line"><span class="keyword">select</span> depart <span class="keyword">from</span> teacher;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> depart <span class="keyword">from</span> teacher; <span class="comment">--去掉depart字段中重复 。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 4、查询score表中成绩在110到120之间的记录。</span></span><br><span class="line"><span class="comment">-- 查询区间。between ..小. and ..大.</span></span><br><span class="line"><span class="comment">-- where 引出条件</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> score <span class="keyword">where</span> degree <span class="keyword">between</span> <span class="number">110</span> <span class="keyword">and</span> <span class="number">120</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> score <span class="keyword">where</span> degree <span class="operator">&gt;</span> <span class="number">110</span> <span class="keyword">and</span> degree <span class="operator">&lt;</span> <span class="number">121</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 5、查询score表中成绩为85，86或88的记录。</span></span><br><span class="line"><span class="comment">-- 表示或或者关系。</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> score <span class="keyword">where</span> degree <span class="keyword">in</span>(<span class="number">120</span>,<span class="number">115</span>,<span class="number">112</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 6、查询student表中183班或者为&#x27;女&#x27;的记录。</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student <span class="keyword">where</span> class<span class="operator">=</span><span class="string">&#x27;183&#x27;</span> <span class="keyword">or</span> ssex<span class="operator">=</span><span class="string">&#x27;女&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 7、以class降序\升序查询student表的所有记录。</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student <span class="keyword">order</span> <span class="keyword">by</span> class <span class="keyword">desc</span>; <span class="comment">-- 降序</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student <span class="keyword">order</span> <span class="keyword">by</span> class <span class="keyword">asc</span>;<span class="comment">-- 升序</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 8、以cno升序、degree降序查询score表的所有记录。</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> score <span class="keyword">order</span> <span class="keyword">by</span> cno <span class="keyword">asc</span> , degree <span class="keyword">desc</span>; <span class="comment">-- 先以cno升序排列，再在cno排序好的基础上，对所有cno同值行以degree降序排列。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 9、查询184班的学生人数。</span></span><br><span class="line"><span class="comment">-- 统计 count</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> student <span class="keyword">where</span> class<span class="operator">=</span><span class="string">&#x27;184&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 10、查询score表中的最高分学生学号和课程号。（子查询或排序）</span></span><br><span class="line"><span class="keyword">select</span> sno,cno <span class="keyword">from</span> score <span class="keyword">where</span> degree<span class="operator">=</span>(<span class="keyword">select</span> <span class="built_in">max</span>(degree) <span class="keyword">from</span> score);</span><br><span class="line"><span class="comment">--（1）找到最高分</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">max</span>(degree) <span class="keyword">from</span> score;</span><br><span class="line"><span class="comment">-- (2) 找最高分的sno和cno</span></span><br><span class="line"><span class="keyword">select</span> sno,cno <span class="keyword">from</span> score <span class="keyword">where</span> degree<span class="operator">=</span>(<span class="keyword">select</span> <span class="built_in">max</span>(degree) <span class="keyword">from</span> score);</span><br><span class="line"><span class="comment">-- 排序做法</span></span><br><span class="line"><span class="keyword">select</span> sno,cno <span class="keyword">from</span> score <span class="keyword">order</span> <span class="keyword">by</span> degree;<span class="comment">-- 默认是升序</span></span><br><span class="line"><span class="keyword">select</span> sno , cno <span class="keyword">from</span> score <span class="keyword">order</span> <span class="keyword">by</span> degree <span class="keyword">desc</span> limit <span class="number">0</span>,<span class="number">1</span>;<span class="comment">-- 降序排列，取最大值。但是这样会出现bug，重分只会留一个。</span></span><br><span class="line"><span class="comment">-- limit 第一个数字表示从多少开始，第二个数字表示查多少条。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询每门课的平均成绩</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> course;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- avg()</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">avg</span>(degree) <span class="keyword">from</span> score <span class="keyword">where</span> cno<span class="operator">=</span><span class="string">&#x27;2&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">avg</span>(degree) <span class="keyword">from</span> score <span class="keyword">where</span> cno<span class="operator">=</span><span class="string">&#x27;1&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">avg</span>(degree) <span class="keyword">from</span> score <span class="keyword">where</span> cno<span class="operator">=</span><span class="string">&#x27;3&#x27;</span>;</span><br><span class="line"><span class="comment">-- 以上也可以写成</span></span><br><span class="line"><span class="comment">-- group by 分组，就是有多少种。</span></span><br><span class="line"><span class="keyword">select</span> cno,<span class="built_in">avg</span>(degree) <span class="keyword">from</span> score <span class="keyword">group</span> <span class="keyword">by</span> cno;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 12、查询score表中至少2名学生选修的并以3开头的课程平均分。</span></span><br><span class="line"><span class="keyword">select</span> cno <span class="keyword">from</span> score <span class="keyword">group</span> <span class="keyword">by</span> cno <span class="comment">-- 这里group by和having 一起使用。</span></span><br><span class="line"><span class="keyword">having</span> <span class="built_in">count</span>(cno)<span class="operator">&gt;=</span><span class="number">3</span>; <span class="comment">-- having 是group 后进行的，where 是group 前。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> cno <span class="keyword">from</span> score <span class="keyword">group</span> <span class="keyword">by</span> cno</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">count</span>(cno)<span class="operator">&gt;=</span><span class="number">2</span> <span class="keyword">and</span> cno <span class="keyword">like</span> <span class="string">&#x27;3%&#x27;</span>; <span class="comment">-- cno like &#x27;3%&#x27; 是以3开头的意思。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> cno, <span class="built_in">avg</span>(degree) <span class="keyword">from</span> score <span class="keyword">group</span> <span class="keyword">by</span> cno</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">count</span>(cno)<span class="operator">&gt;=</span><span class="number">2</span> <span class="keyword">and</span> cno <span class="keyword">like</span> <span class="string">&#x27;3%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> cno, <span class="built_in">avg</span>(degree),<span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> score <span class="keyword">group</span> <span class="keyword">by</span> cno <span class="comment">--count(*)满足所有这样条件的计数一共有多少个。</span></span><br><span class="line"><span class="keyword">having</span> <span class="built_in">count</span>(cno)<span class="operator">&gt;=</span><span class="number">2</span> <span class="keyword">and</span> cno <span class="keyword">like</span> <span class="string">&#x27;3%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 13、 查询分数大于70，小于90的sno列。</span></span><br><span class="line"><span class="keyword">select</span> sno ,degree <span class="keyword">from</span> score</span><br><span class="line"><span class="keyword">where</span> degree <span class="keyword">between</span> <span class="number">90</span> <span class="keyword">and</span> <span class="number">122</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> sno ,degree <span class="keyword">from</span> score</span><br><span class="line"><span class="keyword">where</span> degree <span class="operator">&gt;</span><span class="number">70</span> <span class="keyword">and</span> degree <span class="operator">&lt;</span><span class="number">90</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 14 查询所有学生的 sname、cno 和 degree 列。(多表查询)</span></span><br><span class="line"><span class="keyword">select</span> sname ,cno ,degree <span class="keyword">from</span> student,score</span><br><span class="line"><span class="keyword">where</span> student.sno <span class="operator">=</span> score.sno;  <span class="comment">-- mysql 的等于是单等于号。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 15、查询所有学生学号、课程名、和成绩。</span></span><br><span class="line"><span class="keyword">select</span> cno ,cname, <span class="keyword">from</span> course;</span><br><span class="line"><span class="keyword">select</span> cname,sno,degree <span class="keyword">from</span> course,score</span><br><span class="line"><span class="keyword">where</span> course.cno <span class="operator">=</span> score.cno;  <span class="comment">-- 这里需要注意，cno=cno充当粘合的列 不能在select后面。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 16、查询所有学生的sname、cname和degree列。（三表查询）</span></span><br><span class="line"><span class="keyword">select</span> sname,cname,degree <span class="keyword">from</span> student,course,score</span><br><span class="line"><span class="keyword">where</span> student.sno<span class="operator">=</span>score.sno <span class="keyword">and</span> course.cno<span class="operator">=</span>score.cno; <span class="comment">-- 粘合列不能当作select后面的列。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 若想把粘合的列select，则需要以下写法。</span></span><br><span class="line"><span class="keyword">select</span> sname,cname,degree,student.sno,course.cno <span class="keyword">from</span> student,course,score</span><br><span class="line"><span class="keyword">where</span> student.sno<span class="operator">=</span>score.sno <span class="keyword">and</span> course.cno<span class="operator">=</span>score.cno;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 把student.sno 换个名称 stu_s</span></span><br><span class="line"><span class="keyword">select</span> sname,cname,degree,student.sno <span class="keyword">as</span> stu_s,course.cno <span class="keyword">as</span> cou_c <span class="keyword">from</span> student,course,score</span><br><span class="line"><span class="keyword">where</span> student.sno<span class="operator">=</span>score.sno <span class="keyword">and</span> course.cno<span class="operator">=</span>score.cno;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 17、查询&quot;184班&quot;学生，每门课的平均分。</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student <span class="keyword">where</span> class<span class="operator">=</span><span class="string">&#x27;184&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> sno <span class="keyword">from</span> student <span class="keyword">where</span> class<span class="operator">=</span><span class="string">&#x27;184&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">avg</span>(degree) <span class="keyword">from</span> score</span><br><span class="line"><span class="keyword">where</span> sno <span class="keyword">in</span>(<span class="keyword">select</span> sno <span class="keyword">from</span> student <span class="keyword">where</span> class<span class="operator">=</span><span class="string">&#x27;184&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> cno, <span class="built_in">avg</span>(degree) <span class="keyword">from</span> score</span><br><span class="line"><span class="keyword">where</span> sno <span class="keyword">in</span>(<span class="keyword">select</span> sno <span class="keyword">from</span> student <span class="keyword">where</span> class<span class="operator">=</span><span class="string">&#x27;184&#x27;</span>) <span class="keyword">group</span> <span class="keyword">by</span> cno;<span class="comment">-- 按课程编号求平均分</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 18、查询课程1 的成绩高于18432号同学，的所有同学的记录。 </span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> score</span><br><span class="line"><span class="keyword">where</span> cno<span class="operator">=</span><span class="string">&#x27;1&#x27;</span> <span class="keyword">and</span> degree <span class="operator">&gt;</span>(<span class="keyword">select</span> degree <span class="keyword">from</span> score <span class="keyword">where</span> sno<span class="operator">=</span><span class="string">&#x27;18432&#x27;</span> <span class="keyword">and</span> cno<span class="operator">=</span><span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 19、查询成绩高于学号18432、课程号为2的成绩的所有记录。</span></span><br><span class="line"><span class="keyword">select</span> degree <span class="keyword">from</span> score <span class="keyword">where</span> sno<span class="operator">=</span><span class="string">&#x27;18432&#x27;</span> <span class="keyword">and</span> cno<span class="operator">=</span><span class="string">&#x27;1&#x27;</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> score <span class="keyword">where</span> degree<span class="operator">&gt;</span>(<span class="keyword">select</span> degree <span class="keyword">from</span> score <span class="keyword">where</span> sno<span class="operator">=</span><span class="string">&#x27;18432&#x27;</span> <span class="keyword">and</span> cno<span class="operator">=</span><span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 20、查询和学号为18416、18433 的同学同年出生的所有学生的sno、sname和sbirthday。</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">year</span>(sbirthday) <span class="keyword">from</span> student <span class="keyword">where</span> sno <span class="keyword">in</span>(<span class="string">&#x27;18416&#x27;</span>,<span class="string">&#x27;18433&#x27;</span>)</span><br><span class="line"><span class="keyword">select</span> sno,sname,sbirthday <span class="keyword">from</span> student</span><br><span class="line"><span class="keyword">where</span> <span class="keyword">year</span>(sbirthday) <span class="keyword">in</span></span><br><span class="line">(<span class="keyword">select</span> <span class="keyword">year</span>(sbirthday) <span class="keyword">from</span> student <span class="keyword">where</span> sno <span class="keyword">in</span>(<span class="string">&#x27;18416&#x27;</span>,<span class="string">&#x27;18433&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 21、 查询&#x27;李辉&#x27;任课的学生的成绩。</span></span><br><span class="line"><span class="keyword">select</span> tno <span class="keyword">from</span> teacher <span class="keyword">where</span> tname<span class="operator">=</span><span class="string">&#x27;李辉&#x27;</span></span><br><span class="line"><span class="keyword">select</span> cno <span class="keyword">from</span> course <span class="keyword">where</span> tno<span class="operator">=</span>(<span class="keyword">select</span> tno <span class="keyword">from</span> teacher <span class="keyword">where</span> tname<span class="operator">=</span><span class="string">&#x27;李辉&#x27;</span>)</span><br><span class="line"><span class="keyword">select</span> degree , sno  <span class="keyword">from</span> score <span class="keyword">where</span> cno<span class="operator">=</span>(<span class="keyword">select</span> cno <span class="keyword">from</span> course <span class="keyword">where</span> tno<span class="operator">=</span>(<span class="keyword">select</span> tno <span class="keyword">from</span> teacher <span class="keyword">where</span> tname<span class="operator">=</span><span class="string">&#x27;李辉&#x27;</span>)</span><br><span class="line">) ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 22、查询选修课程的人数多于2人的教师姓名。</span></span><br><span class="line"><span class="keyword">select</span> cno <span class="keyword">from</span> score <span class="keyword">group</span> <span class="keyword">by</span> cno <span class="keyword">having</span> <span class="built_in">count</span>(sno)<span class="operator">&gt;</span><span class="number">2</span>;</span><br><span class="line"><span class="keyword">select</span> cno <span class="keyword">from</span> score <span class="keyword">group</span> <span class="keyword">by</span> cno <span class="keyword">having</span> <span class="built_in">count</span>(cno)<span class="operator">&gt;</span><span class="number">2</span>;</span><br><span class="line"><span class="keyword">select</span> cno <span class="keyword">from</span> score <span class="keyword">group</span> <span class="keyword">by</span> cno <span class="keyword">having</span> <span class="built_in">count</span>(<span class="operator">*</span>)<span class="operator">&gt;</span><span class="number">2</span>;<span class="comment">-- 以上三者等价。</span></span><br><span class="line"><span class="keyword">select</span> tno <span class="keyword">from</span> course <span class="keyword">where</span> cno<span class="operator">=</span>(<span class="keyword">select</span> cno <span class="keyword">from</span> score <span class="keyword">group</span> <span class="keyword">by</span> cno <span class="keyword">having</span> <span class="built_in">count</span>(<span class="operator">*</span>)<span class="operator">&gt;</span><span class="number">2</span>);</span><br><span class="line"><span class="keyword">select</span> tname <span class="keyword">from</span> teacher <span class="keyword">where</span> tno<span class="operator">=</span>(<span class="keyword">select</span> tno <span class="keyword">from</span> course <span class="keyword">where</span> cno<span class="operator">=</span>(<span class="keyword">select</span> cno <span class="keyword">from</span> score <span class="keyword">group</span> <span class="keyword">by</span> cno <span class="keyword">having</span> <span class="built_in">count</span>(<span class="operator">*</span>)<span class="operator">&gt;</span><span class="number">2</span>));</span><br><span class="line"><span class="comment">-- 以上会有bug， count(*)&gt;2，一旦有两以上个就不行，应该用in</span></span><br><span class="line"><span class="keyword">select</span> tname <span class="keyword">from</span> teacher <span class="keyword">where</span> tno <span class="keyword">in</span> (<span class="keyword">select</span> tno <span class="keyword">from</span> course <span class="keyword">where</span> cno <span class="keyword">in</span> (<span class="keyword">select</span> cno <span class="keyword">from</span> score <span class="keyword">group</span> <span class="keyword">by</span> cno <span class="keyword">having</span> <span class="built_in">count</span>(sno)<span class="operator">&gt;</span><span class="number">2</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 23、查询184班和185班全体学生的记录。</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student <span class="keyword">where</span> class <span class="keyword">in</span> (<span class="string">&#x27;184&#x27;</span>,<span class="string">&#x27;185&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 24、查询有120分以上成绩的cno。</span></span><br><span class="line"><span class="keyword">select</span> cno ,degree <span class="keyword">from</span> score <span class="keyword">where</span> degree<span class="operator">&gt;=</span><span class="string">&#x27;120&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 25、查询数学系教师所教课程的成绩。</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> teacher <span class="keyword">where</span> depart<span class="operator">=</span><span class="string">&#x27;数学系&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> course <span class="keyword">where</span> tno <span class="keyword">in</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> teacher <span class="keyword">where</span> depart<span class="operator">=</span><span class="string">&#x27;数学系&#x27;</span>)</span><br><span class="line"><span class="keyword">select</span> degree <span class="keyword">from</span> score <span class="keyword">where</span> cno <span class="keyword">in</span> (<span class="keyword">select</span> cno <span class="keyword">from</span> course <span class="keyword">where</span> tno <span class="keyword">in</span> (<span class="keyword">select</span> tno <span class="keyword">from</span> teacher <span class="keyword">where</span> depart<span class="operator">=</span><span class="string">&#x27;数学系&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 26、查询&#x27;数学系&#x27;与&#x27;英语系&#x27;不同职称的教师的tname和prof。</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> teacher;</span><br><span class="line"><span class="keyword">select</span> prof <span class="keyword">from</span> teacher <span class="keyword">where</span> depart<span class="operator">=</span><span class="string">&#x27;数学系&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> teacher <span class="keyword">where</span> depart<span class="operator">=</span><span class="string">&#x27;数学系&#x27;</span> <span class="keyword">and</span> prof <span class="keyword">not</span> <span class="keyword">in</span> (<span class="keyword">select</span> prof <span class="keyword">from</span> teacher <span class="keyword">where</span> depart<span class="operator">=</span><span class="string">&#x27;英语系&#x27;</span>)</span><br><span class="line"><span class="keyword">union</span> <span class="comment">-- 求并集。</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> teacher <span class="keyword">where</span> depart<span class="operator">=</span><span class="string">&#x27;英语系&#x27;</span> <span class="keyword">and</span> prof <span class="keyword">not</span> <span class="keyword">in</span> (<span class="keyword">select</span> prof <span class="keyword">from</span> teacher <span class="keyword">where</span> depart<span class="operator">=</span><span class="string">&#x27;数学系&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 27、查询选修1号课程，且成绩至少高于选修编号为2号课程的同学的cno、sno、和degree，并按degree降序排列。</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> score <span class="keyword">where</span> cno<span class="operator">=</span><span class="string">&#x27;1&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> score <span class="keyword">where</span> cno<span class="operator">=</span><span class="string">&#x27;2&#x27;</span>;<span class="comment">-- 大于2课程的最小分数就行</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> score <span class="keyword">where</span> cno<span class="operator">=</span><span class="string">&#x27;1&#x27;</span> <span class="keyword">and</span> degree <span class="operator">&gt;</span> <span class="keyword">any</span>(<span class="keyword">select</span> degree <span class="keyword">from</span> score <span class="keyword">where</span> cno<span class="operator">=</span><span class="string">&#x27;2&#x27;</span>) <span class="keyword">order</span> <span class="keyword">by</span> degree <span class="keyword">desc</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 28、查询课程号为1且成绩高于3课程的cno、sno、degree。</span></span><br><span class="line"><span class="comment">-- 大于2课程所有的分数。</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> score <span class="keyword">where</span> cno<span class="operator">=</span><span class="string">&#x27;1&#x27;</span> <span class="keyword">and</span> degree <span class="operator">&gt;</span> <span class="keyword">all</span>(<span class="keyword">select</span> degree <span class="keyword">from</span> score <span class="keyword">where</span> cno<span class="operator">=</span><span class="string">&#x27;3&#x27;</span>) <span class="keyword">order</span> <span class="keyword">by</span> degree <span class="keyword">desc</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 29、 查询所有的教师和同学的name、sex和birthday。</span></span><br><span class="line"><span class="keyword">select</span> tname,tsex,tbirthday <span class="keyword">from</span> teacher</span><br><span class="line"><span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> sname,ssex,sbirthday <span class="keyword">from</span> student;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 30、查询所有女教师女同学的name、sex和birthday。</span></span><br><span class="line"><span class="keyword">select</span> tname <span class="keyword">as</span> name,tsex <span class="keyword">as</span> sex,tbirthday <span class="keyword">as</span> birhday <span class="keyword">from</span> teacher <span class="keyword">where</span> tsex<span class="operator">=</span><span class="string">&#x27;女&#x27;</span></span><br><span class="line"><span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> sname,ssex,sbirthday <span class="keyword">from</span> student <span class="keyword">where</span> ssex<span class="operator">=</span><span class="string">&#x27;女&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 31、查询成绩比该课程平均成绩低的同学的成绩。注意！！！</span></span><br><span class="line"><span class="keyword">select</span> cno ,<span class="built_in">avg</span>(degree) <span class="keyword">from</span> score <span class="keyword">group</span> <span class="keyword">by</span> cno;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> score a  <span class="keyword">where</span> a.degree <span class="operator">&gt;</span>(<span class="keyword">select</span> <span class="built_in">avg</span>(b.degree) <span class="keyword">from</span> score b <span class="keyword">group</span> <span class="keyword">by</span> cno);</span><br><span class="line"><span class="comment">-- 以上的代码会报错，以cno分组会出现多个avg（degree），会导致第一个where 无法选中目标。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 容易理解的版本：</span></span><br><span class="line"><span class="keyword">select</span> Score.courseNo,Score.studentNo </span><br><span class="line"><span class="keyword">from</span> (<span class="keyword">select</span> <span class="built_in">avg</span>(Score.score) <span class="keyword">as</span> avgScore,courseNo</span><br><span class="line">	  <span class="keyword">from</span> Score</span><br><span class="line">      <span class="keyword">group</span> <span class="keyword">by</span> courseNo</span><br><span class="line">      ) a</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> Score <span class="keyword">on</span> a.courseNo <span class="operator">=</span> Score.courseNo</span><br><span class="line"><span class="keyword">where</span> score <span class="operator">&lt;</span> avgScore</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> Score.courseNo,Score.studentNo</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> score a <span class="keyword">where</span> degree <span class="operator">&gt;</span> (<span class="keyword">select</span> <span class="built_in">avg</span>(degree) <span class="keyword">from</span> score b <span class="keyword">where</span> b.cno<span class="operator">=</span>a.cno );</span><br><span class="line"><span class="comment">-- 以上代码解读： </span></span><br><span class="line"><span class="comment">-- 先明确优先级是 from &gt; where &gt; group by &gt; order by &gt; limit &gt; select &gt; having ; 程序读完已经有了a、b表只是还没用到。select b.cno, a.cno from score a,score b; 实际效果如下：</span></span><br><span class="line"><span class="comment">-- b.cno    a.cno</span></span><br><span class="line"><span class="comment">-- 数学			 数学</span></span><br><span class="line"><span class="comment">-- 数学			 数学</span></span><br><span class="line"><span class="comment">-- 数学			 数学</span></span><br><span class="line"><span class="comment">-- 语文      语文</span></span><br><span class="line"><span class="comment">-- 语文      语文</span></span><br><span class="line"><span class="comment">-- 英语      英语       (cno已经排好序了。)</span></span><br><span class="line"><span class="comment">-- 这是 相关子查询（由于子查询中用到了主查询的东西）。</span></span><br><span class="line"><span class="comment">-- 要遍历完 表中所有元素，由于子查询中用到了主查询的东西，并不是先彻底完成子查询再去彻底完成主查询，而是先进行子查询，用掉调用的主查询的from的一部分值，回到主查询，再接着主查询from后面的继续，子查询，用掉调用的主查询的from的一部分值，回到主查询... 知道主查询的from 遍历完毕。</span></span><br><span class="line"><span class="comment">-- 子查询中（ 首先明确：子查询中用到的主查询的任何值都是固定的！相当于固定了主查询中的一些对应的行。 固定a.cno字段其中一种元素,找到b表中与选中的a.cno元素等值的b.cno元素（事实上形成了一个分组），去算b.cno满足条件元素组成的分组 对应的平均值，）</span></span><br><span class="line"><span class="comment">-- 主查询中（ 再去拿a表cno之前固定的那些行 去与b表此cno平均值比较。）</span></span><br><span class="line"><span class="comment">-- 此处不要group by 是因为，&quot; Subquery returns more than 1 row&quot;子查询是不允许返回多个列的。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 32、查询所有任课教师的tname和depart</span></span><br><span class="line"><span class="keyword">select</span> tname,depart <span class="keyword">from</span> teacher <span class="keyword">where</span> tno <span class="keyword">in</span> (<span class="keyword">select</span> tno <span class="keyword">from</span> course);</span><br><span class="line"><span class="comment">-- 课程表中要有课程</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 33、查询至少有2名男生的班号。</span></span><br><span class="line"><span class="keyword">select</span> class,<span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> <span class="string">&#x27;男生数量&#x27;</span> <span class="keyword">from</span> student <span class="keyword">where</span> ssex<span class="operator">=</span><span class="string">&#x27;男&#x27;</span> <span class="keyword">group</span> <span class="keyword">by</span> class <span class="keyword">having</span> <span class="built_in">count</span>(<span class="operator">*</span>)<span class="operator">&gt;=</span><span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 34、查询student表中不姓王的同学记录。</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student <span class="keyword">where</span> sname <span class="keyword">not</span> <span class="keyword">like</span> <span class="string">&#x27;王%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 35、 查询student 表中每个学生的姓名和年龄。</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">year</span>(now());</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">year</span>(sbirthday) <span class="keyword">from</span> student;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">year</span>(now())<span class="operator">-</span><span class="keyword">year</span>(sbirthday),sname <span class="keyword">from</span> student;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 36、 查询student 表中最大和最小的sbirthday的日期值。</span></span><br><span class="line"><span class="keyword">select</span> sbirthday <span class="keyword">from</span> student <span class="keyword">order</span> <span class="keyword">by</span> sbirthday;</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">max</span>(sbirthday) <span class="keyword">as</span> <span class="string">&#x27;最小&#x27;</span>, <span class="built_in">min</span>(sbirthday) <span class="keyword">as</span> <span class="string">&#x27;最大&#x27;</span> <span class="keyword">from</span> student;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 37、以班号和年龄从大到小的顺序查询student表中的全部记录。</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student <span class="keyword">order</span> <span class="keyword">by</span> class <span class="keyword">desc</span>,sbirthday;</span><br><span class="line"><span class="comment">-- 优先把班级按降序排列，然后在每个班级内按生日升序排列，年龄小生日数值大。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 38、查询男教师及其所上的课程。</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> teacher <span class="keyword">where</span> tsex<span class="operator">=</span><span class="string">&#x27;男&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> cname <span class="keyword">from</span> course <span class="keyword">where</span> tno <span class="keyword">in</span> (<span class="keyword">select</span> tno <span class="keyword">from</span> teacher <span class="keyword">where</span> tsex<span class="operator">=</span><span class="string">&#x27;男&#x27;</span>);</span><br><span class="line"><span class="keyword">select</span> cname,tname,tsex <span class="keyword">from</span> course,teacher <span class="keyword">where</span> course.tno<span class="operator">=</span>teacher.tno <span class="keyword">and</span> tsex<span class="operator">=</span><span class="string">&#x27;男&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 39、查询最高分同学的sno、cno、和degree列。</span></span><br><span class="line"><span class="keyword">select</span> sno,cno,degree <span class="keyword">from</span> score <span class="keyword">where</span> degree <span class="operator">=</span> (<span class="keyword">select</span> <span class="built_in">max</span>(degree) <span class="keyword">from</span> score);</span><br><span class="line"># 按学科分</span><br><span class="line"><span class="keyword">select</span> sno,cno,degree <span class="keyword">from</span> score a <span class="keyword">where</span> degree<span class="operator">=</span>(<span class="keyword">select</span> <span class="built_in">max</span>(degree) <span class="keyword">from</span> score b <span class="keyword">where</span> b.cno<span class="operator">=</span>a.cno);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 40、查询和陈宇韶同性别的所有同学的sname。</span></span><br><span class="line"><span class="keyword">select</span> ssex <span class="keyword">from</span> student <span class="keyword">where</span> sname<span class="operator">=</span><span class="string">&#x27;陈宇韶&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> sname,ssex <span class="keyword">from</span> student <span class="keyword">where</span> ssex <span class="operator">=</span> (<span class="keyword">select</span> ssex <span class="keyword">from</span> student <span class="keyword">where</span> sname<span class="operator">=</span><span class="string">&#x27;陈宇韶&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 41、查询和陈宇韶同性别并且同班的同学sname。</span></span><br><span class="line"><span class="keyword">select</span> sname,ssex <span class="keyword">from</span> student <span class="keyword">where</span> ssex <span class="operator">=</span> (<span class="keyword">select</span> ssex <span class="keyword">from</span> student <span class="keyword">where</span> sname<span class="operator">=</span><span class="string">&#x27;陈宇韶&#x27;</span>)</span><br><span class="line"><span class="keyword">and</span> class <span class="operator">=</span> (<span class="keyword">select</span> class <span class="keyword">from</span>  student <span class="keyword">where</span> sname<span class="operator">=</span><span class="string">&#x27;陈宇韶&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 42、查询所有选修数学的男同学的成绩。</span></span><br><span class="line"><span class="keyword">select</span> cno <span class="keyword">from</span> course <span class="keyword">where</span> cname <span class="operator">=</span> <span class="string">&#x27;数学&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> degree ,sname <span class="keyword">from</span>  score,student <span class="keyword">where</span> ssex<span class="operator">=</span><span class="string">&#x27;男&#x27;</span></span><br><span class="line"><span class="keyword">and</span> cno<span class="operator">=</span>(<span class="keyword">select</span> cno <span class="keyword">from</span> course <span class="keyword">where</span> cname <span class="operator">=</span> <span class="string">&#x27;数学&#x27;</span>);</span><br><span class="line"><span class="keyword">select</span> student.sno,ssex,degree,cname <span class="keyword">from</span> score,student,course <span class="keyword">where</span> score.sno<span class="operator">=</span>student.sno <span class="keyword">and</span> score.cno<span class="operator">=</span>course.cno <span class="keyword">and</span> ssex<span class="operator">=</span><span class="string">&#x27;男&#x27;</span><span class="keyword">and</span> cname<span class="operator">=</span><span class="string">&#x27;数学&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 43、假设使用如下命令建立一个grade表。grade意思是等级。</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> grade(</span><br><span class="line">low <span class="type">int</span>(<span class="number">3</span>),</span><br><span class="line">upp <span class="type">int</span>(<span class="number">3</span>),</span><br><span class="line">grade <span class="type">char</span>(<span class="number">1</span>)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> grade <span class="keyword">values</span> (<span class="number">90</span>,<span class="number">100</span>,<span class="string">&#x27;A&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> grade <span class="keyword">values</span> (<span class="number">80</span>,<span class="number">89</span>,<span class="string">&#x27;B&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> grade <span class="keyword">values</span> (<span class="number">70</span>,<span class="number">79</span>,<span class="string">&#x27;C&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> grade <span class="keyword">values</span> (<span class="number">60</span>,<span class="number">69</span>,<span class="string">&#x27;D&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> grade <span class="keyword">values</span> (<span class="number">0</span>,<span class="number">59</span>,<span class="string">&#x27;E&#x27;</span>);</span><br><span class="line"><span class="comment">-- 查询所有同学的sno、cno和grade列。</span></span><br><span class="line"><span class="keyword">select</span>  sno ,cno,degree,grade <span class="keyword">from</span> score,grade <span class="keyword">where</span> (degree <span class="keyword">between</span> low <span class="keyword">and</span> upp) ;</span><br><span class="line"># 这里相当于用另一种方法进行了多表的粘合。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 查看分组的内部信息。group_concat(字段)</span><br><span class="line"><span class="keyword">select</span> sell_date,<span class="built_in">count</span>(<span class="keyword">distinct</span>(product))<span class="keyword">as</span> num_sold,group_concat(<span class="keyword">distinct</span>(product))<span class="keyword">as</span> products <span class="keyword">from</span> Activities <span class="keyword">group</span> <span class="keyword">by</span> sell_date <span class="keyword">order</span> <span class="keyword">by</span> sell_date;</span><br><span class="line">输入：</span><br><span class="line">Activities 表：</span><br><span class="line"><span class="operator">+</span><span class="comment">------------+-------------+</span></span><br><span class="line"><span class="operator">|</span> sell_date  <span class="operator">|</span> product     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+-------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2020</span><span class="number">-05</span><span class="number">-30</span> <span class="operator">|</span> Headphone   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2020</span><span class="number">-06</span><span class="number">-01</span> <span class="operator">|</span> Pencil      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2020</span><span class="number">-06</span><span class="number">-02</span> <span class="operator">|</span> Mask        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2020</span><span class="number">-05</span><span class="number">-30</span> <span class="operator">|</span> Basketball  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2020</span><span class="number">-06</span><span class="number">-01</span> <span class="operator">|</span> Bible       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2020</span><span class="number">-06</span><span class="number">-02</span> <span class="operator">|</span> Mask        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2020</span><span class="number">-05</span><span class="number">-30</span> <span class="operator">|</span> T<span class="operator">-</span>Shirt     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+-------------+</span></span><br><span class="line">输出：</span><br><span class="line"><span class="operator">+</span><span class="comment">------------+----------+------------------------------+</span></span><br><span class="line"><span class="operator">|</span> sell_date  <span class="operator">|</span> num_sold <span class="operator">|</span> products                     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+----------+------------------------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2020</span><span class="number">-05</span><span class="number">-30</span> <span class="operator">|</span> <span class="number">3</span>        <span class="operator">|</span> Basketball,Headphone,T<span class="operator">-</span>shirt <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2020</span><span class="number">-06</span><span class="number">-01</span> <span class="operator">|</span> <span class="number">2</span>        <span class="operator">|</span> Bible,Pencil                 <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2020</span><span class="number">-06</span><span class="number">-02</span> <span class="operator">|</span> <span class="number">1</span>        <span class="operator">|</span> Mask                         <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+----------+------------------------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--  ～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～</span></span><br><span class="line"><span class="comment">-- ～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SQL</span> 的四种连接查询</span><br><span class="line"></span><br><span class="line">内连接</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> 或者 <span class="keyword">join</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">外连接</span><br><span class="line"><span class="number">1.</span>左连接 <span class="keyword">left</span> <span class="keyword">join</span> 或者 <span class="keyword">left</span> <span class="keyword">outer</span> <span class="keyword">join</span></span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>右连接 <span class="keyword">right</span> <span class="keyword">join</span> 或者 <span class="keyword">right</span> <span class="keyword">outer</span> <span class="keyword">join</span></span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>完全外连接 <span class="keyword">full</span> <span class="keyword">join</span> 或者 <span class="keyword">full</span> <span class="keyword">outer</span> <span class="keyword">join</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建testjoin数据库</span></span><br><span class="line"><span class="keyword">create</span> database testJoin;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建表</span></span><br><span class="line"><span class="comment">-- person 表</span></span><br><span class="line"><span class="comment">-- id,</span></span><br><span class="line"><span class="comment">-- name,</span></span><br><span class="line"><span class="comment">-- cardId</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> person(</span><br><span class="line">id <span class="type">int</span>,</span><br><span class="line">name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">cardId <span class="type">int</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- card 表</span></span><br><span class="line"><span class="comment">-- id,</span></span><br><span class="line"><span class="comment">-- name</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> card(</span><br><span class="line">id <span class="type">int</span>,</span><br><span class="line">name <span class="type">varchar</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> card <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;工行卡&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> card <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">&#x27;建行卡&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> card <span class="keyword">values</span>(<span class="number">3</span>,<span class="string">&#x27;农行卡&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> card <span class="keyword">values</span>(<span class="number">4</span>,<span class="string">&#x27;中行卡&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> card <span class="keyword">values</span>(<span class="number">5</span>,<span class="string">&#x27;交行卡&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> card <span class="keyword">values</span>(<span class="number">6</span>,<span class="string">&#x27;饭卡&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> person <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;陈宇韶&#x27;</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> person <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">&#x27;周建宇&#x27;</span>,<span class="number">3</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> person <span class="keyword">values</span>(<span class="number">3</span>,<span class="string">&#x27;罗志康&#x27;</span>,<span class="number">6</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 并没有创建外键，</span></span><br><span class="line"><span class="comment">-- (内连接)inner join 查询</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> person <span class="keyword">inner</span> <span class="keyword">join</span> card <span class="keyword">on</span> person.cardId<span class="operator">=</span>card.id;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+--------+------+-----------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name      <span class="operator">|</span> cardId <span class="operator">|</span> id   <span class="operator">|</span> name      <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+--------+------+-----------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> 陈宇韶    <span class="operator">|</span>      <span class="number">1</span> <span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> 工行卡    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> 周建宇    <span class="operator">|</span>      <span class="number">3</span> <span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> 农行卡    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+--------+------+-----------+</span></span><br><span class="line"><span class="comment">-- 内连接查询，其实就是数据表中的数据，通过某个字段相对，查询相关数据(就是查询都有的部分)。</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> person <span class="keyword">join</span> card <span class="keyword">on</span> person.cardId<span class="operator">=</span>card.id; <span class="comment">-- 和上面式子等价。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- (左外连接)left join</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> person <span class="keyword">left</span> <span class="keyword">join</span> card <span class="keyword">on</span> person.cardId<span class="operator">=</span>card.id;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+--------+------+-----------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name      <span class="operator">|</span> cardId <span class="operator">|</span> id   <span class="operator">|</span> name      <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+--------+------+-----------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> 陈宇韶    <span class="operator">|</span>      <span class="number">1</span> <span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> 工行卡    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> 周建宇    <span class="operator">|</span>      <span class="number">3</span> <span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> 农行卡    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> 罗志康    <span class="operator">|</span>      <span class="number">7</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>      <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+--------+------+-----------+</span></span><br><span class="line"><span class="comment">-- 左外连接会把左边表里面的所有数据都取出来，而右边表中的数据，如果有相等的，就显示出来</span></span><br><span class="line"><span class="comment">-- 如果没有就补null。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- (右外连接)right join</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> person <span class="keyword">right</span> <span class="keyword">join</span> card <span class="keyword">on</span> person.cardId<span class="operator">=</span>card.id;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+--------+------+-----------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name      <span class="operator">|</span> cardId <span class="operator">|</span> id   <span class="operator">|</span> name      <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+--------+------+-----------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> 陈宇韶    <span class="operator">|</span>      <span class="number">1</span> <span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> 工行卡    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> 周建宇    <span class="operator">|</span>      <span class="number">3</span> <span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> 农行卡    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>      <span class="operator">|</span>   <span class="keyword">NULL</span> <span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> 建行卡    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>      <span class="operator">|</span>   <span class="keyword">NULL</span> <span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> 中行卡    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>      <span class="operator">|</span>   <span class="keyword">NULL</span> <span class="operator">|</span>    <span class="number">5</span> <span class="operator">|</span> 交行卡    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>      <span class="operator">|</span>   <span class="keyword">NULL</span> <span class="operator">|</span>    <span class="number">6</span> <span class="operator">|</span> 饭卡      <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+--------+------+-----------+</span></span><br><span class="line"><span class="comment">-- 右外连接会把右边表里面的所有数据都取出来，而左边表中的数据，如果有相等的，就显示出来</span></span><br><span class="line"><span class="comment">-- 如果没有就补null。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- （全外连接）full join</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> person <span class="keyword">full</span> <span class="keyword">join</span> card <span class="keyword">on</span> person.cardId<span class="operator">=</span>card.id;</span><br><span class="line"><span class="comment">-- mysql 不支持 full join ，智能写成以下形式。</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> person <span class="keyword">left</span> <span class="keyword">join</span> card <span class="keyword">on</span> person.cardId<span class="operator">=</span>card.id</span><br><span class="line"><span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> person <span class="keyword">right</span> <span class="keyword">join</span> card <span class="keyword">on</span> person.cardId<span class="operator">=</span>card.id;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+--------+------+-----------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name      <span class="operator">|</span> cardId <span class="operator">|</span> id   <span class="operator">|</span> name      <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+--------+------+-----------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> 陈宇韶    <span class="operator">|</span>      <span class="number">1</span> <span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> 工行卡    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> 周建宇    <span class="operator">|</span>      <span class="number">3</span> <span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> 农行卡    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> 罗志康    <span class="operator">|</span>      <span class="number">7</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>      <span class="operator">|</span>   <span class="keyword">NULL</span> <span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> 建行卡    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>      <span class="operator">|</span>   <span class="keyword">NULL</span> <span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> 中行卡    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>      <span class="operator">|</span>   <span class="keyword">NULL</span> <span class="operator">|</span>    <span class="number">5</span> <span class="operator">|</span> 交行卡    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>      <span class="operator">|</span>   <span class="keyword">NULL</span> <span class="operator">|</span>    <span class="number">6</span> <span class="operator">|</span> 饭卡      <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+--------+------+-----------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 连接的好处是我们不用创建外键，在利用某个字段相等的条件来求表之间的交集、并集相关关系。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～</span></span><br><span class="line"><span class="comment">-- ～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～·</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- mysql 事务</span></span><br><span class="line">mysql 中，事务其实是一个最小的不可分割的工作单元。事务能保证一个业务的完整性。</span><br><span class="line">比如 银行转账。a转给b <span class="number">1000</span>元钱。</span><br><span class="line">a <span class="operator">-</span><span class="operator">&gt;</span> <span class="number">1000</span></span><br><span class="line"><span class="keyword">update</span> <span class="keyword">user</span> <span class="keyword">set</span> money<span class="operator">=</span>money<span class="number">-1000</span> <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;a&#x27;</span>;</span><br><span class="line"></span><br><span class="line">b</span><br><span class="line"><span class="keyword">update</span> <span class="keyword">user</span> <span class="keyword">set</span> money<span class="operator">=</span>money<span class="operator">+</span><span class="number">1000</span> <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;a&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 若实际程序中，以上语句只有一条执行成功</span></span><br><span class="line"><span class="comment">-- 出现数据前后不一致。</span></span><br><span class="line"><span class="comment">-- 多条sql语句，可能会有同时成功的要求，要么就同时失败。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- mysql中如何控制事务？</span></span><br><span class="line"><span class="number">1</span>、mysql是默认开启事务的。autocommit （自动提交）</span><br><span class="line"> <span class="keyword">select</span> @<span class="variable">@autocommit</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------+</span></span><br><span class="line"><span class="operator">|</span> @<span class="variable">@autocommit</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------+</span></span><br><span class="line"><span class="operator">|</span>            <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------+</span></span><br><span class="line"><span class="comment">-- 默认事务开启的作用是什么？</span></span><br><span class="line"><span class="comment">-- 当我们去执行一个sql语句时，效果会立刻体现出来，不能回滚。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> database bank;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">user</span>(</span><br><span class="line">    id  <span class="type">int</span> <span class="keyword">primary</span> key,</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">    money <span class="type">int</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span> <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;陈宇韶&#x27;</span>,<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 事务回滚：撤销sql语句执行效果（提交了就没法回滚了，回滚是在本地的操作！,一次回滚直接是把一整个事务全部撤销了！）。</span></span><br><span class="line"><span class="keyword">rollback</span>;</span><br><span class="line"><span class="keyword">rollback</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name      <span class="operator">|</span> money <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> 陈宇韶    <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)    <span class="comment">-- 虽然显示rollback生效了，但是数据却还是有在里面。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置mysql 自动提交为false。</span></span><br><span class="line"><span class="keyword">set</span> autocommit<span class="operator">=</span><span class="number">0</span>;<span class="keyword">select</span> @<span class="variable">@autocommit</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------+</span></span><br><span class="line"><span class="operator">|</span> @<span class="variable">@autocommit</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------+</span></span><br><span class="line"><span class="operator">|</span>            <span class="number">0</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"><span class="comment">-- 以上关闭了mysql的自动提交。</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span> <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">&#x27;陈文君&#x27;</span>,<span class="number">1</span>);</span><br><span class="line"> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name      <span class="operator">|</span> money <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> 陈宇韶    <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> 陈文君    <span class="operator">|</span>     <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="keyword">rollback</span> ;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name      <span class="operator">|</span> money <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> 陈宇韶    <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"><span class="comment">-- 可见被撤销了。</span></span><br><span class="line"><span class="comment">-- 但是 手动commit提交，就不可撤销（事务回滚）了。</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span> <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">&#x27;陈文君&#x27;</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"><span class="keyword">rollback</span> ;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name      <span class="operator">|</span> money <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> 陈宇韶    <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> 陈文君    <span class="operator">|</span>     <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 自动提交 @@commit</span></span><br><span class="line"><span class="comment">-- 手动提交 commit</span></span><br><span class="line"><span class="comment">-- 事务回滚 rollback</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 如果发现事件A 发生 而事件B不发生，可以事务回滚。确认没问题则 手动提交commit。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- begin</span></span><br><span class="line"><span class="comment">-- 或者</span></span><br><span class="line"><span class="comment">-- start transaction</span></span><br><span class="line"><span class="comment">-- 都可以手动开启事务。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span> autocommit<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"><span class="keyword">update</span> <span class="keyword">user</span> <span class="keyword">set</span> money<span class="operator">=</span>money<span class="number">-1000</span> <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;陈宇韶&#x27;</span>;</span><br><span class="line"><span class="keyword">update</span> <span class="keyword">user</span> <span class="keyword">set</span> money<span class="operator">=</span>money<span class="operator">+</span><span class="number">1000</span> <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;陈文君&#x27;</span>;</span><br><span class="line"><span class="keyword">rollback</span> ; <span class="comment">-- 发现没有被撤销。</span></span><br><span class="line"><span class="comment">-- 但是以下三条语句一起执行的话。是可以被事务回滚的（撤销）。</span></span><br><span class="line"><span class="keyword">begin</span>; <span class="comment">-- 手动开启事务。 或者用start transaction</span></span><br><span class="line"><span class="keyword">update</span> <span class="keyword">user</span> <span class="keyword">set</span> money<span class="operator">=</span>money<span class="number">-1000</span> <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;陈宇韶&#x27;</span>;</span><br><span class="line"><span class="keyword">update</span> <span class="keyword">user</span> <span class="keyword">set</span> money<span class="operator">=</span>money<span class="operator">+</span><span class="number">1000</span> <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;陈文君&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 事务开启之后，一旦commit,就不可回滚.因为commit 后，事务就结束了。</span></span><br><span class="line"></span><br><span class="line">事务的四大特征：</span><br><span class="line">A 原子性：事务是最小单位，不可再分。</span><br><span class="line">C 一致性：事务要求，同一事务中的<span class="keyword">sql</span>语句，必须保证同时成功或者同时失败。</span><br><span class="line">I 隔离性：事务<span class="number">1</span> 和事务<span class="number">2</span> 之间是具有隔离性的。</span><br><span class="line">D 持久性：事务一旦结束（<span class="keyword">commit</span>，<span class="keyword">rollback</span>），就不可以返回。</span><br><span class="line"></span><br><span class="line">事务开启：</span><br><span class="line">    <span class="number">1</span>、修改默认不提交 <span class="keyword">set</span> autocommit<span class="operator">=</span><span class="number">0</span>;</span><br><span class="line">    <span class="number">2</span>、<span class="keyword">begin</span>;</span><br><span class="line">    <span class="number">3</span>、<span class="keyword">start</span> transaction ;</span><br><span class="line">事务手动提交（只对增删改有效，对查无效。）：</span><br><span class="line">    <span class="keyword">commit</span>;</span><br><span class="line">事务回滚：</span><br><span class="line">    <span class="keyword">rollback</span>;</span><br><span class="line"></span><br><span class="line">事务的隔离性（以下为隔离级别）：</span><br><span class="line"><span class="number">1</span>、read uncommitted;    <span class="comment">-- 读未提交的</span></span><br><span class="line"><span class="number">2</span>、read committed;       <span class="comment">-- 读已经提交的</span></span><br><span class="line"><span class="number">3</span>、repeatable read ;    <span class="comment">-- 可以重复读</span></span><br><span class="line"><span class="number">4</span>、serializable;      <span class="comment">-- 串行化</span></span><br><span class="line"></span><br><span class="line"><span class="number">1</span>、read uncommitted;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 脏读</span></span><br><span class="line">如果有事务a，和事务b，</span><br><span class="line">a 事务对数据进行操作，在操作的过程中，事务没有被提交，但是b 可以看见a 的操作结果。这样导致了脏读。</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span> <span class="keyword">values</span>(<span class="number">3</span>,<span class="string">&#x27;邓建楚&#x27;</span>,<span class="number">1000</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span> <span class="keyword">values</span>(<span class="number">4</span>,<span class="string">&#x27;淘宝店&#x27;</span>,<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 如何查看数据库的隔离级别？</span></span><br><span class="line">mysql <span class="number">8.0</span>:</span><br><span class="line"><span class="comment">-- 系统级别</span></span><br><span class="line"><span class="keyword">select</span> @<span class="variable">@global</span>.transaction_isolation;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话级别</span></span><br><span class="line"><span class="keyword">select</span> @<span class="variable">@transaction</span>_isolation</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改隔离级别</span></span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> transaction isolation level read uncommitted;</span><br><span class="line"><span class="keyword">select</span> @<span class="variable">@global</span>.transaction_isolation;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------------+</span></span><br><span class="line"><span class="operator">|</span> @<span class="variable">@global</span>.transaction_isolation <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------------+</span></span><br><span class="line"><span class="operator">|</span> READ<span class="operator">-</span>UNCOMMITTED               <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 转账：邓建楚在淘宝买鞋子500元。</span></span><br><span class="line"><span class="keyword">start</span> transaction;</span><br><span class="line"><span class="keyword">update</span> <span class="keyword">user</span> <span class="keyword">set</span> money<span class="operator">=</span>money<span class="number">-500</span> <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;邓建楚&#x27;</span>;</span><br><span class="line"><span class="keyword">update</span> <span class="keyword">user</span> <span class="keyword">set</span> money<span class="operator">=</span>money<span class="operator">+</span><span class="number">500</span> <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;淘宝店&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 给淘宝店打电话说你去查一下，是不是到账了。</span></span><br><span class="line"> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name      <span class="operator">|</span> money <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> 陈宇韶    <span class="operator">|</span>     <span class="number">0</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> 陈文君    <span class="operator">|</span>  <span class="number">1001</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> 邓建楚    <span class="operator">|</span>   <span class="number">500</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span> 淘宝店    <span class="operator">|</span>  <span class="number">1500</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 发货</span></span><br><span class="line"><span class="comment">-- 晚上请女朋友吃好吃的</span></span><br><span class="line"><span class="comment">-- 1000元</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 结账的时候发现钱不够</span></span><br><span class="line"><span class="keyword">rollback</span>; <span class="comment">-- 撤销买鞋的事务。</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name      <span class="operator">|</span> money <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> 陈宇韶    <span class="operator">|</span>     <span class="number">0</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> 陈文君    <span class="operator">|</span>  <span class="number">1001</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> 邓建楚    <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span> 淘宝店    <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 淘宝店主默认开启事务</span></span><br><span class="line"><span class="comment">-- select * from user;</span></span><br><span class="line"><span class="comment">-- 发现没钱过来了，</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 如果两个不同的地方，都在进行操作，如果事务a 开启之后，他的数据可以被其他事务读取到。</span></span><br><span class="line"><span class="comment">-- 这样就会出现（脏读）</span></span><br><span class="line"><span class="comment">-- 脏读：一个事务读到了另外一个事务没有提交的数据，就叫作脏读。</span></span><br><span class="line"><span class="comment">-- 实际开发是不允许脏读出现的。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">2</span>、read committed;  <span class="comment">-- 读已经提交的</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> transaction isolation level read committed;</span><br><span class="line"><span class="keyword">select</span> @<span class="variable">@global</span>.transaction_isolation;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------------+</span></span><br><span class="line"><span class="operator">|</span> @<span class="variable">@global</span>.transaction_isolation <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------------+</span></span><br><span class="line"><span class="operator">|</span> READ<span class="operator">-</span>COMMITTED                 <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------------+</span></span><br><span class="line"></span><br><span class="line">bank 数据库 <span class="keyword">user</span> 表</span><br><span class="line">小陈：银行员工</span><br><span class="line"><span class="keyword">start</span> transaction;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span>;</span><br><span class="line"></span><br><span class="line">小陈 去厕所</span><br><span class="line">小王：在小王这终端打开<span class="keyword">user</span>表 ，新建事务。</span><br><span class="line"><span class="keyword">start</span> transaction;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span> <span class="keyword">values</span>(<span class="number">5</span>,<span class="string">&#x27;罗志康&#x27;</span>,<span class="number">100</span>);</span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name      <span class="operator">|</span> money <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> 陈宇韶    <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> 陈文君    <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> 邓建楚    <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span> 淘宝店    <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span> 罗志康    <span class="operator">|</span>   <span class="number">100</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"></span><br><span class="line">小陈上完厕所回来。算了以下<span class="keyword">user</span>表的平均数。此时由于终端还停留着以下显示：</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name      <span class="operator">|</span> money <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> 陈宇韶    <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> 陈文君    <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> 邓建楚    <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span> 淘宝店    <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">avg</span>(money) <span class="keyword">from</span> <span class="keyword">user</span>; <span class="comment">-- 小陈却发现平均值变化了</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="built_in">avg</span>(money) <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">820.0000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 虽然我只能读到你提交的数据，但是还是会出现问题。</span></span><br><span class="line"><span class="comment">-- 读取同一表的数据还是会前后不一致。</span></span><br><span class="line"><span class="comment">-- 这就是不可重复读现象：read committed</span></span><br><span class="line"></span><br><span class="line"><span class="number">3</span>、repeatable read     <span class="comment">-- 可以重复读</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> transaction isolation level repeatable read;</span><br><span class="line"> <span class="keyword">select</span> @<span class="variable">@global</span>.transaction_isolation;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------------+</span></span><br><span class="line"><span class="operator">|</span> @<span class="variable">@global</span>.transaction_isolation <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------------+</span></span><br><span class="line"><span class="operator">|</span> READ<span class="operator">-</span>COMMITTED                 <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 在REPEATABLE-READ 隔离级别下又会出现什么问题？</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 王尼玛 -北京</span></span><br><span class="line"><span class="keyword">begin</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name      <span class="operator">|</span> money <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> 陈宇韶    <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> 陈文君    <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> 邓建楚    <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span> 淘宝店    <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span> 罗志康    <span class="operator">|</span>   <span class="number">100</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 张全蛋 -成都</span></span><br><span class="line"><span class="keyword">begin</span>;</span><br><span class="line"><span class="comment">-- 张全蛋-成都</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span> <span class="keyword">values</span>(<span class="number">6</span>,<span class="string">&#x27;暴走&#x27;</span>,<span class="number">1000</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name      <span class="operator">|</span> money <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> 陈宇韶    <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> 陈文君    <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> 邓建楚    <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span> 淘宝店    <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span> 罗志康    <span class="operator">|</span>   <span class="number">100</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">6</span> <span class="operator">|</span> 暴走      <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 王尼玛-北京  由于终端显示还停留在以下显示上：</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name      <span class="operator">|</span> money <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> 陈宇韶    <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> 陈文君    <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> 邓建楚    <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span> 淘宝店    <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span> 罗志康    <span class="operator">|</span>   <span class="number">100</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"><span class="comment">-- 王发现 插入下行显示已经存在，无法插入。</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span> <span class="keyword">values</span>(<span class="number">6</span>,<span class="string">&#x27;暴走&#x27;</span>,<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 这种现象叫做幻读。</span></span><br><span class="line"><span class="comment">-- 事务a 和事务b 同时操作一张表，事务a提交的数据，也不能被事务b读到，就可以造成幻读。</span></span><br><span class="line"></span><br><span class="line"><span class="number">4</span>、serializable;   串行化</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> transaction isolation level serializable;</span><br><span class="line"><span class="keyword">select</span> @<span class="variable">@global</span>.transaction_isolation;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 张全蛋- 成都</span></span><br><span class="line"><span class="keyword">start</span> transaction;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span> <span class="keyword">values</span>(<span class="number">7</span>,<span class="string">&#x27;李铁柱&#x27;</span>,<span class="number">1000</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span> <span class="keyword">values</span>(<span class="number">8</span>,<span class="string">&#x27;王小花&#x27;</span>,<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 王尼玛- 北京</span></span><br><span class="line"><span class="keyword">start</span> transaction;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span> <span class="keyword">values</span>(<span class="number">8</span>,<span class="string">&#x27;王小花&#x27;</span>,<span class="number">1000</span>); <span class="comment">-- 一直运行，不会出结果</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 张全蛋- 成都</span></span><br><span class="line"><span class="keyword">commit</span>; <span class="comment">-- 张全蛋提交瞬即，王尼玛那边的插入操作出结果————报错提示重复插入。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 当user 表被另外一个事务操作的时候，其他事务里面的写操作是不可以进行的。</span></span><br><span class="line"><span class="comment">-- 进入排队状态（串行化），指导王尼玛那边的事务结束之后，张全蛋这个写入操作才会被执行。</span></span><br><span class="line"><span class="comment">-- 在没有等待超时的情况下。</span></span><br><span class="line"><span class="comment">-- 串行化的问题是，性能特别差。</span></span><br><span class="line"></span><br><span class="line">read<span class="operator">-</span>uncommitted <span class="operator">&gt;</span> read<span class="operator">-</span>committed <span class="operator">&gt;</span> repeatable<span class="operator">-</span>read <span class="operator">&gt;</span> serializable;</span><br><span class="line"><span class="comment">-- 隔离级别越高，性能越差。</span></span><br><span class="line"><span class="comment">-- mysql的默认隔离级别是repeatable-read。</span></span><br></pre></td></tr></table></figure>

<h1 id="以下为补充："><a href="#以下为补充：" class="headerlink" title="以下为补充："></a>以下为补充：</h1><p>小提示：mysql清屏 ctrl + L ;</p>
<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-16%2016.41.48.jpg" alt="截屏2022-02-16 16.41.48"></p>
<h2 id="脏读"><a href="#脏读" class="headerlink" title="脏读"></a>脏读</h2><p>​		如下图所示，有 emails 和 mailboxes 两张表，emails 表中 unread_flag 字段表示是否已读，mailboxes 表中 unread 字段则是未读的email数量。</p>
<p>当用户1执行 insert 操作和 update 操作中间，用户2进行了读取，这时会获得一个矛盾的结果，明明有1封未读的 email，但是 unread 计数器却是0。</p>
<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/51EB2AC5-758D-42CD-947E-6CDE8D1A7654_1_105_c-20221029171307386.jpeg" alt="img"></p>
<p>​		防止保证：读数据库的时候，只能看到已成功提交的数据。</p>
<h2 id="更新丢失"><a href="#更新丢失" class="headerlink" title="更新丢失"></a>更新丢失</h2><p>​		如下图所示，用户1和用户2都分别尝试获取 counter，然后对 counter 进行加1并保存，理论结果应该是44，但是实际上结果为43。</p>
<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/077E886C-0AE1-4A76-9B4F-3C7F69A5EB72_1_105_c-20221029171307492.jpeg" alt="img"></p>
<p>​		防止保证：通过原子化写操作、加锁等方式。</p>
<h2 id="脏写"><a href="#脏写" class="headerlink" title="脏写"></a>脏写</h2><p>​		Alice 和 Bob 同时购买一辆车，买车同时也会更新发票，下图的场景中会出现， Bob 买到了车，但是 Alice 收到了发票的情况。</p>
<p>​		注意，这种情况和 <strong>丢失更新</strong> 不一样，丢失更新中第二次写入是在第一个事务提交后才执行的。</p>
<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/F51A6AD6-9621-44BB-909F-23752F7CC9CD_1_105_c-20221029171307600.jpeg" alt="img"></p>
<p>​		防止保证：写数据库的时候，只能覆盖已经成功提交的数据。</p>
<h2 id="不可重复读（读倾斜）"><a href="#不可重复读（读倾斜）" class="headerlink" title="不可重复读（读倾斜）"></a>不可重复读（读倾斜）</h2><p>​		不可重复读是指一个事务先后执行同一条 SQL，，虽然只读提交的，但两次读取到的数据还是不同，就是不可重复读。</p>
<p>​		“读取到了其他事物提交的数据，针对 update 、delete。”</p>
<p>​		Alice有两个子账户，分别有500，一共有1000，转账者从账户2转了100到账户1，转账有两个SQL操作，两个操作在同一个事务中。如果 Alice 在同一个事务中读取了多次账户1，最初读取到了账户1是500，而后面会读取到600，两次读取数据不一致。</p>
<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/2070BC05-6770-4BE7-BAA3-5C88761D03C3_1_105_c-20221029171307786.jpeg" alt="img"></p>
<p>​		防止保证：读数据库的时候，只能看到已成功提交的数据。</p>
<h2 id="幻读（写倾斜）"><a href="#幻读（写倾斜）" class="headerlink" title="幻读（写倾斜）"></a>幻读（写倾斜）</h2><p>​		“读取了其他并发事务提交的数据，针对 insert。”</p>
<p>​		下图中的表是一个 oncall 排班系统，如果有两个医生 oncall 的情况下，允许一个医生退出 oncall。Alice 和 Bob 分别读取了 oncall 的人数，判断当前 oncall 的人数多于两人，然后分别退出了 oncall，导致这个时间段无人 oncall。</p>
<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/76024979-5358-4E84-AE98-6CEB66AB4ECE_1_105_c-20221029171307875.jpeg" alt="img"></p>
<p>​		事务再去读取表时,发现表中还有没有修改的数据行，就好象发生了幻觉一样。</p>
<p>​		防止保证：如果只有在事务完全提交后才能读取数据，则可以避免该问题。</p>
<h2 id="事务隔离如何通过锁来实现？"><a href="#事务隔离如何通过锁来实现？" class="headerlink" title="事务隔离如何通过锁来实现？"></a>事务隔离如何通过锁来实现？</h2><p>读写锁、范围锁。</p>
<h3 id="serializable"><a href="#serializable" class="headerlink" title="serializable"></a>serializable</h3><p>​		有两种方式：</p>
<ul>
<li>使用基于锁的并发控制实现，可串行性要求在事务结束时释放读写锁（在选定数据上获取）。此外，当SELECT查询使用带范围的WHERE子句时，必须获取范围锁，尤其是要避免幻像读取现象。</li>
<li>当使用基于非锁的并发控制时，不会获取任何锁。但是，如果系统在多个并发事务中检测到写冲突，则仅允许其中之一提交。这种方式称之为快照隔离。</li>
</ul>
<h3 id="repeatable-read"><a href="#repeatable-read" class="headerlink" title="repeatable-read"></a>repeatable-read</h3><p>​		基于锁的并发控制实现将保持读写锁（在选定数据上获取），直到事务结束为止。但是，范围锁不受管理，因此可能发生幻像读取。</p>
<h3 id="read-commited"><a href="#read-commited" class="headerlink" title="read-commited"></a>read-commited</h3><p>​		基于锁的并发控制实现将写锁（在选定数据上获取）保持到事务结束，但是一旦执行SELECT操作，就会释放读锁（因此出现不可重复的读现象）。与重复读取一样，不管理范围锁。</p>
<h3 id="read-uncommited"><a href="#read-uncommited" class="headerlink" title="read-uncommited"></a>read-uncommited</h3><p>​		这是最低的隔离级别。在此级别，允许进行脏读取，因此一个事务可能会看到其他事务尚未提交的更改。</p>
<h1 id="mysql-提高"><a href="#mysql-提高" class="headerlink" title="mysql 提高"></a>mysql 提高</h1><p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/image-20220217164752601.png" alt="image-20220217164752601"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variable <span class="keyword">like</span> <span class="string">&#x27;%char&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> engines;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 指定引擎为 myisam（性能优先）</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tb(</span><br><span class="line">id <span class="type">int</span>(<span class="number">4</span>) auto_increment,</span><br><span class="line">name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line"><span class="keyword">primary</span> key(id)</span><br><span class="line">)</span><br><span class="line">engine<span class="operator">=</span>MyISAM AUTO_INCREMENT<span class="operator">=</span><span class="number">1</span></span><br><span class="line"><span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><p>​		sql的优化主要就是优化索引。</p>
<p>​		索引就是一个树的数据结构，index来帮助提高效率。可以回顾一下算法与数据结构。</p>
<p>​		可以加索引搜索，也可以不加索引搜索。索引最好建立在 空间占用小的字段上。 </p>
<h3 id="分类："><a href="#分类：" class="headerlink" title="分类："></a>分类：</h3><p>​		聚集索引（数据完整存放在叶结点）、非聚集索引；</p>
<p>​		主键索引、辅助索引（二级索引）；</p>
<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-13%2012.08.27.jpg" alt="截屏2022-10-13 12.08.27"></p>
<p>​	</p>
<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-13%2012.09.46.jpg" alt="截屏2022-10-13 12.09.46"></p>
<p>​		联合索引（覆盖索引）</p>
<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-13%2012.34.01.jpg" alt="截屏2022-10-13 12.34.01"></p>
<h3 id="索引下推-icp-："><a href="#索引下推-icp-：" class="headerlink" title="索引下推(icp)："></a>索引下推(icp)：</h3><p>​		ICP（index condition pushdown）5.6版本加入。explain 的extra 可查。</p>
<p>​		<img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-13%2012.54.53.jpg" alt="截屏2022-10-13 12.54.53"></p>
<p>​		原本 在二级索引中，不会 有取交并这样的过滤行为，只会都查出来 主键index ，然后一股脑都去回表查询，icp索引下推之后，在二级索引中就会直接进行过滤，过滤出的 主键索引index ，一次回表查询即可。</p>
<p>​		因此，多建立联合索引，可以提高效率！</p>
<p>​		ICP，只存在于二级索引中；</p>
<p>​		一旦 引用了子查询的条件，就不能索引下推了。</p>
<h3 id="索引失效："><a href="#索引失效：" class="headerlink" title="索引失效："></a>索引失效：</h3><p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-14%2011.52.30.jpg" alt="截屏2022-10-14 11.52.30"></p>
<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-14%2011.54.40.jpg" alt="截屏2022-10-14 11.54.40"></p>
<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-14%2012.25.38.jpg" alt="截屏2022-10-14 12.25.38"></p>
<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-14%2012.34.30.jpg" alt="截屏2022-10-14 12.34.30"></p>
<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-14%2012.54.57.jpg" alt="截屏2022-10-14 12.54.57"></p>
<p>​		mysql 默认一页 是 16kb（也就是b+ 树的一个结点 16kb）。以页为单位（<code>Data_length</code> ）从内存读取。</p>
<p>​		上面的 io 是写进 内存的消耗 ，和<code>Data_length</code> 有关，默认是 1.0，cpu 是cpu读取内存并计算的消耗，和记录数量 <code>Rows</code>有关，默认0.2； </p>
<p>​		1、如果是走 聚集索引的 全表查询：</p>
<p>​		通过 <code>show table status like &#39;表名&#39;</code> 可以 查看到 <code>Data_length</code>， 如果是20512768，则 为20512768&#x2F;1024&#x3D; X kb，X kb&#x2F;16 &#x3D; 1252 页。</p>
<p>​		通过 <code>show table status like &#39;表名&#39;</code> 可以 查看到 <code>Rows</code>，如果是442486，则 直接为 4482486 条数据。</p>
<p>​		2、如果是走二级索引，包括可能回表查询的情况：</p>
<p>​		通过b+树的 查询到叶结点的 时间复杂度是 常数级别，查询两头可以定位出区间，我们这里直接就用 1 来代表定位区间 的内存消耗；</p>
<p>​		通过 二级索引中定位区间 ，io 消耗 为 1；</p>
<p>​		通过二级索引 树的回溯 可以查出 一共有多少个 记录。每一个记录都要回一次表。  假如 走二级索引 查出 范围内有100个叶子结点，要把 100个记录 的页 加载进内存 中，然后去回表，io消耗 是 100 * 1；</p>
<p>​		通过 cpu 从 二级索引中查询出的 区间 把 id 读取出来，为cpu消耗，100条数据就是 100 * 0.2；</p>
<p>​		通过 cpu 回表查询还要读一次。消耗为 100 * 0.2；</p>
<p>​		可见，如果 通过索引查询，查询出的记录 太大，有10000条， 索引查询开销 &gt; 全表查询，mysql 的优化器 就会自动选择 全表查询！！！</p>
<h3 id="索引优化-："><a href="#索引优化-：" class="headerlink" title="索引优化 ："></a>索引优化 ：</h3><p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-14%2012.01.15.jpg" alt="截屏2022-10-14 12.01.15"></p>
<p>​		解释：</p>
<p>​		bool 字段 会变成二叉树，分叉太少，深度会很深。</p>
<p>​		char(1) 就比 archer(20) 小多了，更加适合作index。</p>
<p>​		<img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-14%2012.10.51.jpg" alt="截屏2022-10-14 12.10.51"></p>
<p>​		<img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-14%2012.17.47.jpg" alt="截屏2022-10-14 12.17.47"></p>
<p>​	</p>
<p>​	</p>
<h3 id="索引缺点："><a href="#索引缺点：" class="headerlink" title="索引缺点："></a>索引缺点：</h3><p>​		1、树结构本身可能很大；</p>
<p>​		2、索引适用场景少，针对少量数据、频繁更新、很少使用的字段，都不适用索引；</p>
<p>​		3、索引会降低增、删、改的效率，可以回顾算法与数据结构里树改结构的时间复杂度。</p>
<h3 id="索引优点："><a href="#索引优点：" class="headerlink" title="索引优点："></a>索引优点：</h3><p>​		1、提高查询效率；</p>
<p>​	    2、降低CPU使用率，如order by 排序，搜索树本身就是排好序的。</p>
<h3 id="B树"><a href="#B树" class="headerlink" title="B树"></a>B树</h3><p>​		数据都放在叶子结点。</p>
<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-18%2016.10.15.jpg" alt="截屏2022-02-18 16.10.15"></p>
<h3 id="索引创建、显示与删除"><a href="#索引创建、显示与删除" class="headerlink" title="索引创建、显示与删除"></a>索引创建、显示与删除</h3><p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-18%2016.17.46.jpg" alt="截屏2022-02-18 16.17.46"></p>
<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-18%2016.21.58.jpg" alt="截屏2022-02-18 16.21.58"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 删除索引</span></span><br><span class="line"><span class="keyword">drop</span> index name_index <span class="keyword">on</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="keyword">drop</span> index id_index <span class="keyword">on</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="comment">-- 显示索引（主键会被识别为索引）</span></span><br><span class="line"><span class="keyword">show</span> index <span class="keyword">from</span> <span class="keyword">user</span>;</span><br></pre></td></tr></table></figure>



<h2 id="sql性能问题"><a href="#sql性能问题" class="headerlink" title="sql性能问题"></a>sql性能问题</h2><p>​		1、分析sql执行计划：explain 来模拟sql优化器执行sql语句。</p>
<p>​		2、优化器会干扰我们的优化。</p>
<p>​		在mysql官网对应版本的手动参考 reference manual 中找到 优化optimization。<img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-18%2017.04.16.jpg" alt="截屏2022-02-18 17.04.16"></p>
<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-18%2017.06.43.jpg" alt="截屏2022-02-18 17.06.43"></p>
<h3 id="（id）"><a href="#（id）" class="headerlink" title="（id）"></a>（id）</h3><p>​		explain结果里 id 相同，从上往下顺序执行。</p>
<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-18%2017.19.24.jpg" alt="截屏2022-02-18 17.19.24"></p>
<p>​		数据小的优先查询（因为笛卡尔积，中间的乘积尽可能小）。</p>
<p>​		explain结果里id不同的话，id越大越优先。</p>
<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-18%2017.36.10.jpg" alt="截屏2022-02-18 17.36.10"></p>
<p>​		其本质就是 嵌套子查询时，先查最内层，再查最外层，类似于括号嵌套的数学运算。</p>
<p>​		explain结果里id有相同也有不同，id大的优先，然后在id值相同的从上往下顺序执行。</p>
<h3 id="（select-type）"><a href="#（select-type）" class="headerlink" title="（select_type）"></a>（select_type）</h3><p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-18%2018.00.33.jpg" alt="截屏2022-02-18 18.00.33"></p>
<p>以上截图有没截图到的地方：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> cr.name <span class="keyword">from</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> course <span class="keyword">where</span> tid <span class="keyword">in</span> (<span class="number">1</span>,<span class="number">2</span>)) cr;</span><br><span class="line">explain <span class="keyword">select</span> cr.name <span class="keyword">from</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> course <span class="keyword">where</span> tid<span class="operator">=</span><span class="number">1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> course <span class="keyword">where</span> tid<span class="operator">=</span><span class="number">2</span>) cr;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-18%2018.10.49.jpg" alt="截屏2022-02-18 18.10.49"></p>
<h3 id="（type）索引类型、类型"><a href="#（type）索引类型、类型" class="headerlink" title="（type）索引类型、类型"></a>（type）索引类型、类型</h3><p>​		<img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-18%2018.24.19.jpg" alt="截屏2022-02-18 18.24.19"></p>
<p>const : 仅仅能够查到一条数据，用于primary key 或者 unique索引。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> test01(</span><br><span class="line">    tid <span class="type">int</span>(<span class="number">3</span>),</span><br><span class="line">    tname <span class="type">varchar</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> test01 <span class="keyword">value</span>(<span class="number">1</span>,<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> test01 <span class="keyword">add</span> <span class="keyword">constraint</span> tid_pk <span class="keyword">primary</span> key(tid);</span><br><span class="line"></span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test01) t <span class="keyword">where</span> t.tid<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line">explain <span class="keyword">select</span> tid <span class="keyword">from</span> test01 <span class="keyword">where</span> tid<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"># 都会显示 type 是 const</span><br></pre></td></tr></table></figure>

<p>eq_ref: 唯一性索引，对于每一个索引键的查询，返回匹配唯一行数据。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 对于每一个索引键的查询，返回匹配唯一行数据。</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> teacherCard <span class="keyword">add</span> <span class="keyword">primary</span> key(tcid);</span><br><span class="line"><span class="keyword">alter</span> talbe teacher <span class="keyword">add</span> <span class="keyword">unique</span> index (tcid);</span><br><span class="line"></span><br><span class="line">explain <span class="keyword">select</span> t.tcid <span class="keyword">from</span> teacher t,teacherCard tc <span class="keyword">where</span> t.tcid<span class="operator">=</span>tc.tcid;</span><br><span class="line"># 在teacher和teacherCard 数量一致且不为零的时候，才有可能是eq_ref。（例如 teacher和teacherCard两个表的 根据tcid索引字段匹配后，对应的元素个数都是<span class="number">3</span>，且都没有重复的，实际是很难保证这样。如：甲的索引id是<span class="number">1</span>，<span class="number">2</span>，乙的索引id是<span class="number">1</span>，<span class="number">2</span>，正好可以匹配上，且不重复。）</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ref: 非唯一性索引，对于每个“索引键”的查询，返回匹配的所有行 （0或者多个）。 </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 接上上面代码框</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> test01 <span class="keyword">drop</span> <span class="keyword">primary</span> key ;</span><br><span class="line"><span class="keyword">create</span> index test01_index <span class="keyword">on</span> test01(tid);</span><br><span class="line"># <span class="keyword">alter</span> <span class="keyword">table</span> test01 <span class="keyword">add</span> index tid_index(tid);</span><br><span class="line">explain <span class="keyword">select</span> tid <span class="keyword">from</span> test01 <span class="keyword">where</span> tid<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"># 会显示是<span class="keyword">ref</span>索引类型。</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> test01 <span class="keyword">value</span>(<span class="number">1</span>,<span class="string">&#x27;b&#x27;</span>);</span><br><span class="line">explain <span class="keyword">select</span> tid <span class="keyword">from</span> test01 <span class="keyword">where</span> tid<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"># 还是会显示是<span class="keyword">ref</span>索引类型。</span><br><span class="line"># 如：甲的索引id是<span class="number">1</span>，<span class="number">2</span>，乙的索引id是<span class="number">1</span>，<span class="number">1</span>，乙的索引有重复。）</span><br></pre></td></tr></table></figure>

<p>range：检索指定范围的行，where后面是一个范围查询（between、&lt;、&gt;、in有时候会失效转为无索引情况。）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> teacher t <span class="keyword">where</span> t.tid <span class="keyword">in</span> (<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> teacher t <span class="keyword">where</span> t.tid<span class="operator">&lt;</span><span class="number">3</span>;</span><br></pre></td></tr></table></figure>

<p>index:把所有索引都查一遍。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> cid <span class="keyword">from</span> course ; </span><br><span class="line"><span class="comment">-- cid 是索引，只需要扫描索引表。</span></span><br></pre></td></tr></table></figure>

<p>all:把所有字段都查一遍。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> cid <span class="keyword">from</span> course;</span><br><span class="line"><span class="comment">-- cid 不是索引，需要扫描全部表。</span></span><br></pre></td></tr></table></figure>

<h3 id="（possible-keys）可能用到的索引"><a href="#（possible-keys）可能用到的索引" class="headerlink" title="（possible_keys）可能用到的索引"></a>（possible_keys）可能用到的索引</h3><h3 id="（key）实际用到的索引"><a href="#（key）实际用到的索引" class="headerlink" title="（key）实际用到的索引"></a>（key）实际用到的索引</h3><h3 id="（key-len）索引的长度，用于判断复合索引是否被完全使用。"><a href="#（key-len）索引的长度，用于判断复合索引是否被完全使用。" class="headerlink" title="（key_len）索引的长度，用于判断复合索引是否被完全使用。"></a>（key_len）索引的长度，用于判断复合索引是否被完全使用。</h3><p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-19%2022.12.35.jpg" alt="截屏2022-02-19 22.12.35"></p>
<p>​		复合索引一级一查，就是说复合索引的后面一个索引被查的时候也会用到前面一个索引，计算后面一个索引长度时，要加两个索引的长度来算。如下：</p>
<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-19%2022.17.41-7034786.jpg" alt="截屏2022-02-19 22.17.41"></p>
<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-19%2022.21.55.jpg" alt="截屏2022-02-19 22.21.55"></p>
<p>int（4） 这样的 就不用 4*3&#x3D;12 了，直接用 4 就行 。不用考虑  一个字符 3字节，这是对char 和varchar 来说的。</p>
<h3 id="（ref）表明当前表所参照的字段。"><a href="#（ref）表明当前表所参照的字段。" class="headerlink" title="（ref）表明当前表所参照的字段。"></a>（ref）表明当前表所参照的字段。</h3><p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-19%2022.29.30.jpg" alt="截屏2022-02-19 22.29.30"></p>
<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-19%2022.30.14.jpg" alt="截屏2022-02-19 22.30.14"></p>
<h3 id="（rows）实际通过索引扫描的-数据个数。"><a href="#（rows）实际通过索引扫描的-数据个数。" class="headerlink" title="（rows）实际通过索引扫描的 数据个数。"></a>（rows）实际通过索引扫描的 数据个数。</h3><p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-19%2022.33.47.jpg" alt="截屏2022-02-19 22.33.47"></p>
<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-19%2022.34.22.jpg" alt="截屏2022-02-19 22.34.22"></p>
<p>c 是2个 但是 t 是1。</p>
<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-19%2022.35.03.jpg" alt="截屏2022-02-19 22.35.03"></p>
<p>​		rows用来表示在SQL执行过程中会被扫描的行数。</p>
<p>​		举个例子来说，假如有一个语句 select * from t where column_a &#x3D; 1 and column_b &#x3D; 2;<br>全表假设有100条记录，column_a字段有索引（非联合索引），column_b没有索引。<br>column_a &#x3D; 1 的记录有20条， column_a &#x3D; 1 and column_b &#x3D; 2 的记录有5条。</p>
<p>那么最终查询结果应该显示5条记录。 explain结果中的rows应该是20. 因为这20条记录mysql引擎必须逐行检查是否满足where条件。</p>
<h3 id="（Extra）"><a href="#（Extra）" class="headerlink" title="（Extra）"></a>（Extra）</h3><h4 id="1、using-filesort："><a href="#1、using-filesort：" class="headerlink" title="1、using filesort："></a>1、using filesort：</h4><p>​		 性能消耗大，需要“额外”一次排序（或者 查找），常见于order by 出现时。</p>
<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-19%2022.45.15.jpg" alt="截屏2022-02-19 22.45.15"></p>
<p>单索引避免file sort：where哪些字段，就order by 哪些字段。</p>
<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-19%2022.51.31.jpg" alt="截屏2022-02-19 22.51.31"></p>
<p>​		复合索引避免file sort：where和order by 按照复合索引顺序使用，不要跨列或者无序使用。</p>
<p>​		<strong>注意：1、where 后的 索引&#x3D;常量 才会算，索引&#x3D;范围 是不被记入 最佳左前缀的；2、WHERE子句中必须包含索引中最左的字段！但不一定是常量，因为最左前缀可以只出现在order by子句中，where只是起到一个选择索引的作用。</strong></p>
<p>​		可以参考 ：<code>https://blog.csdn.net/Bronze5/article/details/113817719?spm=1001.2101.3001.6650.1&amp;utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-1-113817719-blog-125004353.pc_relevant_3mothn_strategy_recovery&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-1-113817719-blog-125004353.pc_relevant_3mothn_strategy_recovery&amp;utm_relevant_index=2</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"># 举例说明。</span><br><span class="line"># 联合索引 （<span class="number">1</span>，<span class="number">2</span>，<span class="number">3</span>，<span class="number">4</span>） 以下是 符合最佳左前缀 不会触发 <span class="keyword">using</span> filesort 文件重排序的 组合：</span><br><span class="line"></span><br><span class="line"># 自己到自己不会触发；</span><br><span class="line"><span class="keyword">where</span> <span class="number">1</span><span class="operator">=</span><span class="string">&#x27;&#x27;</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">where</span> <span class="number">2</span><span class="operator">=</span><span class="string">&#x27;&#x27;</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">2</span></span><br><span class="line"><span class="keyword">where</span> <span class="number">3</span><span class="operator">=</span><span class="string">&#x27;&#x27;</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">3</span></span><br><span class="line"><span class="keyword">where</span> <span class="number">4</span><span class="operator">=</span><span class="string">&#x27;&#x27;</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">4</span></span><br><span class="line"># 最佳左前缀不会触发；</span><br><span class="line"><span class="keyword">where</span> <span class="number">1</span><span class="operator">=</span><span class="string">&#x27;&#x27;</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">2</span></span><br><span class="line"><span class="keyword">where</span> <span class="number">2</span><span class="operator">=</span><span class="string">&#x27;&#x27;</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">where</span> <span class="number">3</span><span class="operator">=</span><span class="string">&#x27;&#x27;</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">where</span> <span class="number">4</span><span class="operator">=</span><span class="string">&#x27;&#x27;</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line">	↑ →→ ↓</span><br><span class="line">  <span class="number">1</span>  	 <span class="number">2</span>	 	<span class="number">3</span>		 <span class="number">4</span></span><br><span class="line">  ↑ ←← ↓    ↓    ↓</span><br><span class="line">  ↑         ↓    ↓</span><br><span class="line">  ↑ ←←←←←←  ↓    ↓</span><br><span class="line">  ↑              ↓</span><br><span class="line">  ↑  ←←←←←←←←←←  ↓</span><br><span class="line"> </span><br><span class="line"># 保证最左的 往后走一个，其他的都汇聚到最左的一个。</span><br><span class="line">(<span class="number">3</span>,<span class="number">4</span>,<span class="number">2</span>)<span class="number">1</span> </span><br><span class="line">(<span class="number">4</span>,<span class="number">2</span>)<span class="number">1</span></span><br><span class="line"># 这些也会优化好。</span><br><span class="line">(<span class="number">1</span>,<span class="number">4</span>)<span class="number">4</span></span><br><span class="line">(<span class="number">1</span>,<span class="number">3</span>)<span class="number">3</span></span><br><span class="line">(<span class="number">1</span>,<span class="number">2</span>)<span class="number">2</span></span><br><span class="line">(<span class="number">1</span>,<span class="number">3</span>)<span class="number">1</span></span><br><span class="line"># 就连 （<span class="number">1</span>，<span class="number">3</span>）<span class="number">2</span> 也会被优化.</span><br><span class="line"># a1 不需要回表查询，a3出现了跨列，导致了a3索引失效，需要回表查询</span><br><span class="line"># 因为 把<span class="keyword">where</span> 和 <span class="keyword">order</span> <span class="keyword">by</span>涉及的索引拼接，（a3索引因为跨列已经失效了）剩下的顺序是a1、a2，是索引顺序，所以不需要额外一次排序filesort。</span><br><span class="line">(<span class="number">1</span>,<span class="number">3</span>)<span class="number">2</span></span><br><span class="line">(<span class="number">1</span>,<span class="number">4</span>)<span class="number">2</span></span><br><span class="line">(<span class="number">2</span>,<span class="number">4</span>)<span class="number">1</span></span><br><span class="line">(<span class="number">2</span>,<span class="number">3</span>)<span class="number">1</span></span><br><span class="line">(<span class="number">2</span>,<span class="number">3</span>)<span class="number">2</span>   # 我还 不明白下面这些为什么会被优化 的不需要 filesort。</span><br><span class="line">(<span class="number">2</span>,<span class="number">3</span>)<span class="number">3</span></span><br><span class="line">(<span class="number">4</span>,<span class="number">3</span>)<span class="number">3</span></span><br><span class="line">(<span class="number">3</span>,<span class="number">4</span>)<span class="number">3</span></span><br><span class="line">(<span class="number">3</span>,<span class="number">4</span>)<span class="number">4</span></span><br><span class="line">... </span><br><span class="line">都是会被 优化为 不触发 filesort 。</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="2、using-temporary："><a href="#2、using-temporary：" class="headerlink" title="2、using temporary："></a>2、using temporary：</h4><p>​		性能损耗大，用到了临时表。常见于 group by 出现时。</p>
<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-20%2013.16.12.jpg" alt="截屏2022-02-20 13.16.12"></p>
<p>​		需要额外再多用一张表，已经有了，但是不适用，必须再来一张表，就会using temporary。</p>
<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-20%2013.24.22.jpg" alt="截屏2022-02-20 13.24.22"></p>
<h4 id="3、using-index"><a href="#3、using-index" class="headerlink" title="3、using index"></a>3、using index</h4><p>​		性能提升。索引覆盖。（不读区原文件，只从索引中获取数据，不需要回表查询。）只要使用到的列 全部都在索引中，就是索引覆盖using index。</p>
<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-20%2013.27.58.jpg" alt="截屏2022-02-20 13.27.58"></p>
<p>​		<img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-20%2013.30.27.jpg" alt="截屏2022-02-20 13.30.27"></p>
<p>​		<img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-20%2013.34.32.jpg" alt="截屏2022-02-20 13.34.32"></p>
<h4 id="4、using-where"><a href="#4、using-where" class="headerlink" title="4、using where"></a>4、using where</h4><p>​		需要回表查询</p>
<p>​		<img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-20%2013.36.59.jpg" alt="截屏2022-02-20 13.36.59"></p>
<h4 id="5、impossible-where"><a href="#5、impossible-where" class="headerlink" title="5、impossible where"></a>5、impossible where</h4><p>​		不可能出现的情况。</p>
<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-20%2013.38.19.jpg" alt="截屏2022-02-20 13.38.19"></p>
<h3 id="优化事例"><a href="#优化事例" class="headerlink" title="优化事例"></a>优化事例</h3><p>​		SQL的优化是一种概率层面的优化，至于是否实际使用了我们的优化，需要通过explain 配合结果的possible key、key 、extra等来推测。</p>
<h4 id="（一）复合索引"><a href="#（一）复合索引" class="headerlink" title="（一）复合索引"></a>（一）复合索引</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> test03(</span><br><span class="line">    a1 <span class="type">int</span>(<span class="number">4</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    a2 <span class="type">int</span>(<span class="number">4</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    a3 <span class="type">int</span>(<span class="number">4</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    a4 <span class="type">int</span>(<span class="number">4</span>) <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> test03 <span class="keyword">add</span> index idx_a1_a2_a3_a4(a1,a2,a3,a4);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 推荐写法，索引的使用顺序和索引的顺序一致。</span><br><span class="line">explain <span class="keyword">select</span> a1,a2,a3,a4 <span class="keyword">from</span> test03 <span class="keyword">where</span> a1<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> a2<span class="operator">=</span><span class="number">2</span> <span class="keyword">and</span> a3<span class="operator">=</span><span class="number">3</span> <span class="keyword">and</span> a4<span class="operator">=</span><span class="number">4</span>;</span><br><span class="line"># 但是改一下顺序，由于mysql服务层的优化器自动优化，也会时一样的结果。</span><br><span class="line">explain <span class="keyword">select</span> a1,a2,a3,a4 <span class="keyword">from</span> test03 <span class="keyword">where</span> a4<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> a3<span class="operator">=</span><span class="number">2</span> <span class="keyword">and</span> a2<span class="operator">=</span><span class="number">3</span> <span class="keyword">and</span> a1<span class="operator">=</span><span class="number">4</span>;</span><br></pre></td></tr></table></figure>

<p>​		<img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-20%2014.00.51.jpg" alt="截屏2022-02-20 14.00.51"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> a1,a2,a3,a4 <span class="keyword">from</span> test03 <span class="keyword">where</span> a1<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> a2<span class="operator">=</span><span class="number">2</span> <span class="keyword">and</span> a4<span class="operator">=</span><span class="number">4</span> <span class="keyword">order</span> <span class="keyword">by</span> a3;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-20%2014.01.56.jpg" alt="截屏2022-02-20 14.01.56"></p>
<p>​		可见有一部分需要where回表查询了。a1、a2 不需要回表查询，a4出现了跨列，导致了a4索引失效，需要回表查询，因此using where ，可以通过key_len 验证。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> a1,a2,a3,a4 <span class="keyword">from</span> test03 <span class="keyword">where</span> a1<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> a4<span class="operator">=</span><span class="number">4</span> <span class="keyword">order</span> <span class="keyword">by</span> a3;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-20%2014.08.44.jpg" alt="截屏2022-02-20 14.08.44"></p>
<p>​		出现file sort，多了一次额外排序&#x2F;查询。因为 把where 和 order by涉及的索引拼接，（a4索引因为跨列已经失效了）剩下的顺序是a1、a3，一样不是索引顺序，所以需要额外一次排序filesort。</p>
<p>​		总结：</p>
<p>​		复合索引（a、b、c）从左往右，一个失效会引起后面都失效。</p>
<p>​		复合索引如果在全部使用时顺序与定义时一致，且不跨列使用，则复合索引全部使用；如果部分一致，且不夸列使用，则使用部分索引。</p>
<p>​		原则：</p>
<p>​		a.不要夸列或者无序使用；</p>
<p>​		b. 尽量使用全索引匹配；</p>
<p>​		</p>
<h4 id="（二）单表优化"><a href="#（二）单表优化" class="headerlink" title="（二）单表优化"></a>（二）单表优化</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> book(</span><br><span class="line">    bid <span class="type">int</span>(<span class="number">4</span>) <span class="keyword">primary</span> key,</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>, </span><br><span class="line">    authorid <span class="type">int</span>(<span class="number">4</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    publicid <span class="type">int</span>(<span class="number">4</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    typeid <span class="type">int</span>(<span class="number">4</span>) <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> book <span class="keyword">value</span>(<span class="number">1</span>,<span class="string">&#x27;tjava&#x27;</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> book <span class="keyword">value</span>(<span class="number">2</span>,<span class="string">&#x27;tc&#x27;</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> book <span class="keyword">value</span>(<span class="number">3</span>,<span class="string">&#x27;wx&#x27;</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> book <span class="keyword">value</span>(<span class="number">4</span>,<span class="string">&#x27;math&#x27;</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">3</span>);</span><br><span class="line"><span class="keyword">commit</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> bid <span class="keyword">from</span> book <span class="keyword">where</span> typeid <span class="keyword">in</span> (<span class="number">2</span>,<span class="number">3</span>) <span class="keyword">and</span> authorid<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"># <span class="keyword">where</span> 后的条件，实际会锁定 <span class="number">4</span>行，只是之后取了交集，所以 <span class="keyword">rows</span><span class="operator">=</span><span class="number">4</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-20%2020.16.59.jpg" alt="截屏2022-02-20 20.16.59"></p>
<p>查询优化，加上索引。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> book <span class="keyword">add</span> index idx_bta(bid,typeid,authorid);</span><br><span class="line"></span><br><span class="line">explain <span class="keyword">select</span> bid <span class="keyword">from</span> book <span class="keyword">where</span> typeid <span class="keyword">in</span> (<span class="number">2</span>,<span class="number">3</span>) <span class="keyword">and</span> authorid<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"># 用到了 <span class="number">2</span>号、<span class="number">3</span>号索引，而索引像 一二三级 目录一样，所以一定会使用到 <span class="number">1</span>号 索引，所以 key_len<span class="operator">=</span><span class="number">4</span><span class="operator">*</span><span class="number">3</span><span class="operator">=</span><span class="number">12</span> 。</span><br><span class="line"># 而 typeid 用了<span class="keyword">in</span> 而不是 <span class="operator">=</span>‘常数’，我们就忽略它。</span><br><span class="line"> explain <span class="keyword">select</span> bid <span class="keyword">from</span> book <span class="keyword">where</span> typeid <span class="keyword">in</span> (<span class="number">2</span>,<span class="number">3</span>) <span class="keyword">and</span> authorid<span class="operator">=</span><span class="number">1</span> <span class="keyword">order</span> <span class="keyword">by</span> typeid <span class="keyword">desc</span>;</span><br><span class="line"> # 而 typeid 用了<span class="keyword">in</span> 而不是 <span class="operator">=</span>‘常数’，我们就忽略它。</span><br><span class="line"> # <span class="number">3</span>号位到和<span class="number">2</span>号位 ，不符合 最佳左前缀，触发 文件再排序。</span><br><span class="line"> # 这里如果是 typeid<span class="operator">=</span><span class="number">1</span> 而不是 用<span class="keyword">in</span>， 就不会出现 <span class="keyword">using</span> filesort。</span><br></pre></td></tr></table></figure>

<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-20%2020.17.17.jpg" alt="截屏2022-02-20 20.17.17"></p>
<p>​		<img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-20%2020.20.03.jpg" alt="截屏2022-02-20 20.20.03"></p>
<p>根据查询的实际顺序，定义一个新顺序的复合索引。（原索引记的删除，以免干扰）。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 虽然bid不在<span class="keyword">where</span>和<span class="keyword">order</span> <span class="keyword">by</span>后，可以回表查询bid，但是bid放入索引中可以提升索引使用率，所以我们在复合索引中依然保留bid。</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> book <span class="keyword">add</span> index idx_tab(typeid,authorid,bid);</span><br><span class="line"># 原索引记的删除，以免干扰）。</span><br><span class="line"><span class="keyword">drop</span> index idx_bta <span class="keyword">on</span> book;</span><br><span class="line"></span><br><span class="line">explain <span class="keyword">select</span> bid <span class="keyword">from</span> book <span class="keyword">where</span> typeid <span class="keyword">in</span> (<span class="number">2</span>,<span class="number">3</span>) <span class="keyword">and</span> authorid<span class="operator">=</span><span class="number">1</span> ;</span><br><span class="line"># 只用到了 联合索引 目录的前两级 ，所以 key_len<span class="operator">=</span><span class="number">2</span><span class="operator">*</span><span class="number">4</span><span class="operator">=</span><span class="number">8</span>。而 联合索引中<span class="number">1</span>号索引 typeid 限定了扫描范围只有两个，所以 <span class="keyword">rows</span><span class="operator">=</span><span class="number">2</span>。</span><br><span class="line"></span><br><span class="line"># Backward index scan 是 MySQL<span class="number">-8.0</span>.x 针对性的一个专用优化项，它可以从索引的后面往前面读，性能上比加索引提示要好的多。</span><br><span class="line">explain <span class="keyword">select</span> bid <span class="keyword">from</span> book <span class="keyword">where</span> typeid <span class="keyword">in</span> (<span class="number">2</span>,<span class="number">3</span>) <span class="keyword">and</span> authorid<span class="operator">=</span><span class="number">1</span> <span class="keyword">order</span> <span class="keyword">by</span> typeid <span class="keyword">desc</span>;</span><br><span class="line"># 因为 <span class="keyword">desc</span> 降序，自动 用上了Backward index scan。</span><br></pre></td></tr></table></figure>

<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-20%2020.28.57.jpg" alt="截屏2022-02-20 20.28.57"></p>
<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-20%2020.39.47.jpg" alt="截屏2022-02-20 20.39.47"></p>
<p>由于in 可以会失效使得索引类型直接变为all，而复合索引中typeid是第一个索引一旦它失效了后面跟着失效，所以我们改变where后查询顺序，并且相应改变复合索引顺序，。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> index idx_tab <span class="keyword">on</span> book;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> book <span class="keyword">add</span> index idx_atb(authorid,typeid,bid);</span><br><span class="line"></span><br><span class="line">explain <span class="keyword">select</span> bid <span class="keyword">from</span> book <span class="keyword">where</span> authorid<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> typeid <span class="keyword">in</span> (<span class="number">2</span>,<span class="number">3</span>) <span class="keyword">order</span> <span class="keyword">by</span> typeid <span class="keyword">desc</span>;</span><br><span class="line"></span><br><span class="line"># 试一试去掉<span class="keyword">in</span>。达到了效果最好。</span><br><span class="line">explain <span class="keyword">select</span> bid <span class="keyword">from</span> book <span class="keyword">where</span> authorid<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> typeid<span class="operator">=</span><span class="number">3</span> <span class="keyword">order</span> <span class="keyword">by</span> typeid <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-20%2021.23.14.jpg" alt="截屏2022-02-20 21.23.14"></p>
<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-20%2021.32.18.jpg" alt="截屏2022-02-20 21.32.18"></p>
<p>总结：</p>
<p>​		a.尽量保持 索引的定义和使用的顺序一致性。</p>
<p>​		b.索引逐步优化。</p>
<p>​		c.将含有in的范围查询 放到where条件的最后。 </p>
<h4 id="（三）两表优化"><a href="#（三）两表优化" class="headerlink" title="（三）两表优化"></a>（三）两表优化</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> teacher2(</span><br><span class="line">    tid <span class="type">int</span>(<span class="number">4</span>) <span class="keyword">primary</span> key,</span><br><span class="line">    cid <span class="type">int</span>(<span class="number">4</span>) <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> teacher2 <span class="keyword">values</span>(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> teacher2 <span class="keyword">values</span>(<span class="number">2</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> teacher2 <span class="keyword">values</span>(<span class="number">3</span>,<span class="number">3</span>);</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> course2(</span><br><span class="line">    cid <span class="type">int</span>(<span class="number">4</span>) ,</span><br><span class="line">    cname <span class="type">varchar</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> course2 <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;java&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> course2 <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">&#x27;python&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> course2 <span class="keyword">values</span>(<span class="number">3</span>,<span class="string">&#x27;kotlin&#x27;</span>);</span><br><span class="line"><span class="keyword">commit</span>;</span><br></pre></td></tr></table></figure>

<p>左连接查询</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> teacher2 t <span class="keyword">left</span> <span class="keyword">join</span> course2 c <span class="keyword">on</span> t.cid<span class="operator">=</span>c.cid <span class="keyword">where</span> c.cname<span class="operator">=</span><span class="string">&#x27;java&#x27;</span>; </span><br></pre></td></tr></table></figure>

<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-20%2022.11.02.jpg" alt="截屏2022-02-20 22.11.02"></p>
<p>索引往哪张表上加？原则：</p>
<p>​		a.数据量小的表驱动数据量大的表；（程序设计中，小的循环套大的循环效率&gt;大的循环套小的循环效率）</p>
<p>​		b.索引建立在经常使用的字段上；（左链接是以满足左表为根本，左表必然使用频繁，索引加在左表对应的链接字段上。同理右链接，右表使用频繁，索引加在右表对应的链接字段上。）本题 t.cid&#x3D;c.cid , t.cid 被设定为索引。	</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> teacher2 <span class="keyword">add</span> index index_teacher2_cid(cid);</span><br><span class="line"></span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> teacher2 t <span class="keyword">left</span> <span class="keyword">join</span> course2 c <span class="keyword">on</span> t.cid<span class="operator">=</span>c.cid <span class="keyword">where</span> c.cname<span class="operator">=</span><span class="string">&#x27;java&#x27;</span>; </span><br></pre></td></tr></table></figure>

<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-20%2022.11.32.jpg" alt="截屏2022-02-20 22.11.32"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 给剩下的查找字段加上索引。</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> course2 <span class="keyword">add</span> index index_course2_cname(cname);</span><br><span class="line"></span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> teacher2 t <span class="keyword">left</span> <span class="keyword">join</span> course2 c <span class="keyword">on</span> t.cid<span class="operator">=</span>c.cid <span class="keyword">where</span> c.cname<span class="operator">=</span><span class="string">&#x27;java&#x27;</span>; </span><br></pre></td></tr></table></figure>

<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-20%2022.12.58.jpg" alt="截屏2022-02-20 22.12.58"></p>
<p>补充：</p>
<p>using join buffer : extra 中一个选项，mysql引擎 使用了链接缓存来优化。</p>
<h4 id="（四）三表查询"><a href="#（四）三表查询" class="headerlink" title="（四）三表查询"></a>（四）三表查询</h4><p>原则：</p>
<p>​		a.小表驱动大表；</p>
<p>​		b.索引建立在经常查询的字段上；</p>
<h4 id="（避免索引失效）"><a href="#（避免索引失效）" class="headerlink" title="（避免索引失效）"></a>（避免索引失效）</h4><p>​		1、复合索引情况：</p>
<p>​				复合索引（a、b、c）从左往右，一个失效可能会引起后面都失效。而且，如果索引使用了 !&#x3D;  、&lt;&gt; 、 is null、 is not null 也“可能”会使得索引失效。</p>
<p>​				a.不要夸列或者无序使用；</p>
<p>​				b. 尽量使用全索引匹配；</p>
<p>​		2、不要在索引上进行任何操作（计算、函数、类型转换），否则索引失效。  如：select .. where A.x*3&#x3D; .. 。</p>
<p>​		3、尽量索引覆盖，让索引要用到的字段。</p>
<p>​		4、like尽量以常量开头，不要以%开头。 select * from xx where name like ‘%x’;  name如果是索引，那name就可能失效了。挽救措施是：尽量索引覆盖，查询的字段不要出现回表查询，效果会好一些，比如 select tname from teacher where name like ‘%x’; </p>
<p>​		5、尽量不要用类型转换（显示、隐式），否则索引可能失效。</p>
<p>​		6、尽量不要用or，or的出现可能连左边的索引也一起弄失效了。</p>
<h4 id="（其它优化方法）"><a href="#（其它优化方法）" class="headerlink" title="（其它优化方法）"></a>（其它优化方法）</h4><h5 id="1、exists和-in"><a href="#1、exists和-in" class="headerlink" title="1、exists和 in"></a>1、exists和 in</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> .. <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">where</span> <span class="keyword">exists</span> 子查询;</span><br><span class="line"># <span class="keyword">exists</span> 是把主查询的结果放到子查询中校验，相当于先遍历了主循环。由于小包大的循环嵌套性能更好，所以主查询大就用<span class="keyword">exists</span>。</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> .. <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">where</span> 字段 <span class="keyword">in</span> 子查询;</span><br></pre></td></tr></table></figure>

<p>​		如果主查询的数据集大，则使用In；</p>
<p>​		如果子查询的数据集大，则使用exist；</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">1</span> <span class="keyword">SELECT</span></span><br><span class="line"> <span class="number">2</span>     `<span class="keyword">user</span>`.<span class="operator">*</span></span><br><span class="line"> <span class="number">3</span> <span class="keyword">FROM</span></span><br><span class="line"> <span class="number">4</span>     `<span class="keyword">user</span>`</span><br><span class="line"> <span class="number">5</span> <span class="keyword">WHERE</span></span><br><span class="line"> <span class="number">6</span>     <span class="keyword">EXISTS</span> (</span><br><span class="line"> <span class="number">7</span>         <span class="keyword">SELECT</span></span><br><span class="line"> <span class="number">8</span>             `<span class="keyword">order</span>`.user_id</span><br><span class="line"> <span class="number">9</span>         <span class="keyword">FROM</span></span><br><span class="line"><span class="number">10</span>             `<span class="keyword">order</span>`</span><br><span class="line"><span class="number">11</span>         <span class="keyword">WHERE</span></span><br><span class="line"><span class="number">12</span>             `<span class="keyword">user</span>`.id <span class="operator">=</span> `<span class="keyword">order</span>`.user_id</span><br><span class="line"><span class="number">13</span>     )</span><br></pre></td></tr></table></figure>



<h5 id="2、order-by-优化"><a href="#2、order-by-优化" class="headerlink" title="2、order by 优化"></a>2、order by 优化</h5><p>​		using filesort 有两种算法：双路排序、单路排序（根据IO的次数）。 </p>
<p>​		双路排序：</p>
<p>​				1、磁盘先读取排序字段，对排序字段排序（在buffer中进行排序）；2、扫描其它字段。</p>
<p>​		单路排序：</p>
<p>​				一次性扫描所有字段，在buffer中排序，但是单路排序不一定真的是“单路”。 </p>
<p>​		双路排序io用的多，消耗资源，就有了单路排序。但是单路排序不一定真的是“单路”，因为数据量太大了，无法一次性读取全部数据，就会“分片读取”也就会多次io读取了，同时单路排序一次性读完字段会使得buffer更大。 可以如下调整buffer大小：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> max_length_for_sort_data<span class="operator">=</span><span class="number">1024</span>;</span><br><span class="line"># <span class="number">1024</span>单位是byte，可以自己调。</span><br><span class="line"># max_length_for_sort_data值太低，mysql会自动从 单路变双路。</span><br></pre></td></tr></table></figure>

<p>order by 查询优化：</p>
<p>​		a、选择单双路；调整buffer大小；</p>
<p>​		b、避免select * ；* 难以被索引覆盖；</p>
<p>​		c、避免复合索引夸列使用；</p>
<p>​		d、保证都是升序或者降序；order by a asc，c desc； 这样就不可取；		</p>
<p>​		</p>
<h2 id="慢日志查询"><a href="#慢日志查询" class="headerlink" title="慢日志查询"></a>慢日志查询</h2><p>​		默认10秒都没有查出来就属于慢查询了。慢查询日志默认关闭，建议开发时打开，最终部署时关闭。	</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 检查是否开启了慢查询日志。</span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%slow_query_log%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"># 临时开启(内存中开启,重启mysql服务失效。)</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> slow_query_log<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"># Linux中永久开启 (可以回顾一下Linux学习笔记。)</span><br><span class="line"><span class="operator">/</span>etc<span class="operator">/</span>my.cnf </span><br><span class="line">【mysqld】# 追加 slow_query_log<span class="operator">=</span><span class="number">1</span></span><br><span class="line">slow_query_log_file<span class="operator">=</span>想要存放的位置 如 <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>localhost<span class="operator">-</span>slow.log</span><br></pre></td></tr></table></figure>

<p>​		设置慢查询阈值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 临时设置阈值，重新登录mysql即可起效，无需重启服务。</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> long_query_time<span class="operator">=</span><span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"># Linux中永久设置</span><br><span class="line"><span class="operator">/</span>etc<span class="operator">/</span>my.cnf </span><br><span class="line">【mysqld】# 追加 </span><br><span class="line">long_query_time<span class="operator">=</span><span class="number">3</span></span><br><span class="line"># 以上是设置为<span class="number">5</span>秒，可以自己定。</span><br><span class="line"></span><br><span class="line"># 用主动延时来检查</span><br><span class="line"><span class="keyword">select</span> sleep(<span class="number">4</span>);</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> status <span class="keyword">like</span> <span class="string">&#x27;%slow_queries%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>​		用Linux的各种工具cat等查看慢日志文件，或者用mysql自带的慢查询工具，专业的应该更方便一些。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cat <span class="operator">/</span>usr<span class="operator">/</span><span class="keyword">local</span><span class="operator">/</span>mysql<span class="operator">/</span>data<span class="operator">/</span>MacBook<span class="operator">-</span>Pro<span class="operator">-</span>slow.log </span><br><span class="line"># 我这里用的是Mac，和Linux的默认慢日志位置不一样。</span><br><span class="line"></span><br><span class="line"># 用mysql内的工具来看,按提示操作,记得退出mysql界面在Linux命令框里操作。</span><br><span class="line">mysqldumpslow <span class="comment">--help</span></span><br><span class="line"></span><br><span class="line"># 获取返回记录最多的<span class="number">3</span>个<span class="keyword">sql</span></span><br><span class="line">mysqldumpslow <span class="operator">-</span>s r <span class="operator">-</span>t <span class="number">3</span> <span class="operator">/</span>usr<span class="operator">/</span><span class="keyword">local</span><span class="operator">/</span>mysql<span class="operator">/</span>data<span class="operator">/</span>MacBook<span class="operator">-</span>Pro<span class="operator">-</span>slow.log</span><br><span class="line"># 获取访问次数最多的<span class="number">3</span>个<span class="keyword">sql</span></span><br><span class="line">mysqldumpslow <span class="operator">-</span>s c <span class="operator">-</span>t <span class="number">3</span> <span class="operator">/</span>usr<span class="operator">/</span><span class="keyword">local</span><span class="operator">/</span>mysql<span class="operator">/</span>data<span class="operator">/</span>MacBook<span class="operator">-</span>Pro<span class="operator">-</span>slow.log</span><br><span class="line"># 按照时间排序，前<span class="number">10</span>条包含<span class="keyword">left</span> <span class="keyword">join</span> 查询语句的<span class="keyword">sql</span></span><br><span class="line">mysqldumpslow <span class="operator">-</span>s t <span class="operator">-</span>t <span class="number">10</span> <span class="operator">-</span>g <span class="string">&#x27;left join&#x27;</span> <span class="operator">/</span>usr<span class="operator">/</span><span class="keyword">local</span><span class="operator">/</span>mysql<span class="operator">/</span>data<span class="operator">/</span>MacBook<span class="operator">-</span>Pro<span class="operator">-</span>slow.log</span><br></pre></td></tr></table></figure>

<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-21%2015.51.22.jpg" alt="截屏2022-02-21 15.51.22"></p>
<h2 id="模拟海量数据优化"><a href="#模拟海量数据优化" class="headerlink" title="模拟海量数据优化"></a>模拟海量数据优化</h2><h3 id="插入海量数据"><a href="#插入海量数据" class="headerlink" title="插入海量数据"></a>插入海量数据</h3><p>​		存储过程（无return）存储函数（有return）。	</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> database testdata;</span><br><span class="line">use testdata;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> dept(</span><br><span class="line">    dno <span class="type">int</span>(<span class="number">5</span>) <span class="keyword">primary</span> key <span class="keyword">default</span> <span class="number">0</span>,</span><br><span class="line">    dname <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">default</span> <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    loc <span class="type">varchar</span>(<span class="number">30</span>) <span class="keyword">default</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">)engine<span class="operator">=</span>innodb <span class="keyword">default</span> charset<span class="operator">=</span>utf8;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> emp(</span><br><span class="line">    eid <span class="type">int</span>(<span class="number">5</span>) <span class="keyword">primary</span> key,</span><br><span class="line">    ename <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">default</span> <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    job <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">default</span> <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    deptno <span class="type">int</span>(<span class="number">5</span>) <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">default</span> <span class="number">0</span></span><br><span class="line">)engine<span class="operator">=</span>innodb <span class="keyword">default</span> charset<span class="operator">=</span>utf8;</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> emp;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>​		通过存储函数插入海量数据。</p>
<p>​		创建存储函数：</p>
<p>​				randstring(6) 用于模拟员工名字，由5个字母组成。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"># 在mysql中创建函数有几个注意的点。</span><br><span class="line"># <span class="number">1</span>、用 delimiter $ ... $ 来让  # ; 不再是语句终点，让两个$包裹的中间部分成为一个整体。</span><br><span class="line"># delimiter $</span><br><span class="line"># ...</span><br><span class="line"># $</span><br><span class="line"># <span class="number">2</span>、定义函数的形参 要定义形参类型，以及返回值的类型，注意不要 ；。中间的函数体用<span class="keyword">begin</span> 和 <span class="keyword">end</span> 包裹。</span><br><span class="line"># <span class="keyword">create</span> <span class="keyword">function</span> randstring(n <span class="type">int</span>) <span class="keyword">return</span> <span class="type">varchar</span>(<span class="number">255</span>)</span><br><span class="line"># <span class="keyword">begin</span></span><br><span class="line"># ...</span><br><span class="line"># <span class="keyword">end</span></span><br><span class="line">#	<span class="number">3</span>、定义变量 用<span class="keyword">declare</span> ，需要声明类型，以及默认值。</span><br><span class="line"># <span class="number">4</span>、mysql的字符串索引不同于其它语言，是从<span class="number">1</span>开始的。</span><br><span class="line"># <span class="number">5</span>、rand()随机函数是【<span class="number">0</span>，<span class="number">1</span>）的闭开区间；<span class="built_in">FLOOR</span>() 向下取整；<span class="built_in">substring</span>(目标，索引，取的个数)切片；concat(stringA,stringB)粘合两个字符串;</span><br><span class="line"># <span class="number">6</span>、赋值语句需要<span class="keyword">set</span>开头 。<span class="keyword">set</span> i<span class="operator">=</span>i<span class="operator">+</span><span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"># 以防<span class="keyword">none</span> <span class="keyword">of</span> <span class="keyword">deterministic</span> 报错。</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> log_bin_trust_function_creators<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">delimiter $</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">function</span> randstring(n <span class="type">int</span>) <span class="keyword">returns</span> <span class="type">varchar</span>(<span class="number">255</span>)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"><span class="keyword">declare</span> all_str <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">default</span> <span class="string">&#x27;abcdefghijklmn&#x27;</span>;</span><br><span class="line"><span class="keyword">declare</span> return_str <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">default</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">declare</span> i <span class="type">int</span> <span class="keyword">default</span> <span class="number">0</span>;</span><br><span class="line">while i<span class="operator">&lt;</span>n</span><br><span class="line">do</span><br><span class="line"><span class="keyword">set</span> return_str <span class="operator">=</span> concat(return_str,<span class="built_in">substring</span>(all_str,<span class="built_in">floor</span>(rand()<span class="operator">*</span><span class="number">14</span><span class="operator">+</span><span class="number">1</span>),<span class="number">1</span> ));</span><br><span class="line"><span class="keyword">set</span> i <span class="operator">=</span> i<span class="operator">+</span><span class="number">1</span>;</span><br><span class="line"><span class="keyword">end</span> while;</span><br><span class="line"><span class="keyword">return</span> return_str;</span><br><span class="line"><span class="keyword">end</span> $</span><br></pre></td></tr></table></figure>

<p>​		产生随机整数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">delimiter $</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">function</span> ran_num() <span class="keyword">returns</span> <span class="type">int</span>(<span class="number">5</span>)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"><span class="keyword">declare</span> i <span class="type">int</span> <span class="keyword">default</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">set</span> i <span class="operator">=</span> <span class="built_in">floor</span>(rand()<span class="operator">*</span><span class="number">100</span>);</span><br><span class="line"><span class="keyword">return</span> i;</span><br><span class="line"><span class="keyword">end</span> </span><br><span class="line">$</span><br></pre></td></tr></table></figure>

<p>​		通过存储过程插入海量数据：emp表中。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># 利用存储过程海量插入需要提前注意：</span><br><span class="line"># 存储过程参数要 <span class="keyword">in</span> 表示输入类型还是什么类型；关闭自动提交，不然io浪费过大；repeat ... until ... <span class="keyword">end</span> repeat 中until后无; ； </span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> insert_dept(<span class="keyword">in</span> dno_start <span class="type">int</span>(<span class="number">10</span>),<span class="keyword">in</span> data_time <span class="type">int</span>(<span class="number">10</span>))</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">declare</span> i <span class="type">int</span> <span class="keyword">default</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">set</span> autocommit <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    repeat</span><br><span class="line">        <span class="keyword">insert</span> <span class="keyword">into</span> dept <span class="keyword">values</span>(dno_start<span class="operator">+</span>i,randstring(<span class="number">6</span>),randstring(<span class="number">8</span>));</span><br><span class="line">        <span class="keyword">set</span> i <span class="operator">=</span> i<span class="operator">+</span><span class="number">1</span>;</span><br><span class="line">    until i<span class="operator">=</span>data_time <span class="keyword">end</span> repeat;</span><br><span class="line">    <span class="keyword">commit</span>;</span><br><span class="line"><span class="keyword">end</span> $</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> insert_emp(<span class="keyword">in</span> eid_start <span class="type">int</span>(<span class="number">10</span>),<span class="keyword">in</span> data_times <span class="type">int</span>(<span class="number">10</span>))</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">declare</span> i <span class="type">int</span> <span class="keyword">default</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">set</span> autocommit<span class="operator">=</span><span class="number">0</span>;</span><br><span class="line">    repeat</span><br><span class="line">        <span class="keyword">insert</span> <span class="keyword">into</span> emp <span class="keyword">values</span>(eid_start<span class="operator">+</span>i,randstring(<span class="number">5</span>),<span class="string">&#x27;other&#x27;</span>,ran_num());</span><br><span class="line">        <span class="keyword">set</span> i <span class="operator">=</span> i<span class="operator">+</span><span class="number">1</span>;</span><br><span class="line">    until i<span class="operator">=</span>data_times <span class="keyword">end</span> repeat;</span><br><span class="line">    <span class="keyword">commit</span>;</span><br><span class="line"><span class="keyword">end</span> $</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>​		调用存储过程插入数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 把语句结束符号改回分号</span><br><span class="line">delimiter ;</span><br><span class="line"><span class="keyword">call</span> insert_emp(<span class="number">1000</span>,<span class="number">800000</span>);</span><br><span class="line"><span class="keyword">call</span> insert_dept(<span class="number">10</span>,<span class="number">30</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> emp;</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> dept;</span><br><span class="line"># 可以看见已经成功插入<span class="number">80</span>万条员工数据和<span class="number">30</span>条部门数据。慢日志中可见插入<span class="number">80</span>万条数据耗时了<span class="number">58</span>秒。</span><br></pre></td></tr></table></figure>

<h3 id="分析海量数据"><a href="#分析海量数据" class="headerlink" title="分析海量数据"></a>分析海量数据</h3><p>​		用profiles	</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%profiling%&#x27;</span>;</span><br><span class="line"><span class="keyword">set</span> profiling <span class="operator">=</span> <span class="keyword">on</span>; # 开启</span><br><span class="line"># <span class="keyword">show</span> profiles; 可以记录开启 profiles 后所有操作的时间。但是只能看见总共时间，看不见cpu、io各自的耗时。</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 1、总的检查</span></span><br><span class="line"><span class="keyword">show</span> profiles;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2、精确分析 sql诊断。</span></span><br><span class="line"><span class="keyword">show</span> profile <span class="keyword">all</span> <span class="keyword">for</span> query <span class="number">2</span>;</span><br><span class="line"># 查看详细耗时。</span><br><span class="line"><span class="keyword">show</span> profile cpu,block io <span class="keyword">for</span> query 上一步查询的query_id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3、查全局日志（调优开发时用，实际部署关闭。）不关会浪费大量存储空间。</span></span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%general_log%&#x27;</span>;</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> general_log<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> log_output<span class="operator">=</span><span class="string">&#x27;table&#x27;</span>;</span><br><span class="line"># 以上将记录导入mysql自带的mysql库的general_log表中。也可以自己定地方存日志文件。</span><br><span class="line"># <span class="keyword">set</span> <span class="keyword">global</span> log_output<span class="operator">=</span><span class="string">&#x27;file&#x27;</span>;</span><br><span class="line"># <span class="keyword">set</span> <span class="keyword">global</span> general_log<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"># <span class="keyword">set</span> <span class="keyword">global</span> general_log_file<span class="operator">=</span><span class="string">&#x27;自己想放的地方/general.log&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> mysql.general_log; # 在全局日志里取查。</span><br></pre></td></tr></table></figure>



<h2 id="MySQL的锁"><a href="#MySQL的锁" class="headerlink" title="MySQL的锁"></a>MySQL的锁</h2><p>操作类型：</p>
<p>​		a、读锁（共享锁）：对同一个数据，多个读操作可以同时进行，互不干扰；</p>
<p>​		b、写锁（互斥锁）：如果当前写操作没有完毕，则无法进行其它的读操作、写操作；</p>
<p>操作范围：</p>
<p>​		a、表锁，MyISAM引擎就是用表锁，开销小，加锁快，无死锁，但是范围大容易发生锁冲突，并发低；</p>
<p>​		b、行锁，一次性对一条数据加锁，InnoDB引擎就是用行锁。开销大，加锁慢，容易死锁，锁范围小不容易冲突，不容易高并发问题如（脏读、幻读、不可重复、丢失更新）；</p>
<p>​		c、页锁 </p>
<h3 id="表锁示例"><a href="#表锁示例" class="headerlink" title="表锁示例"></a>表锁示例</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 会话0</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tablelock(</span><br><span class="line">id <span class="type">int</span> <span class="keyword">primary</span> key auto_increment,</span><br><span class="line">name <span class="type">varchar</span>(<span class="number">20</span>)</span><br><span class="line">)engine myisam;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tablelock(name) <span class="keyword">values</span>(<span class="string">&#x27;a1&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tablelock(name) <span class="keyword">values</span>(<span class="string">&#x27;a2&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tablelock(name) <span class="keyword">values</span>(<span class="string">&#x27;a3&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tablelock(name) <span class="keyword">values</span>(<span class="string">&#x27;a4&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tablelock(name) <span class="keyword">values</span>(<span class="string">&#x27;a5&#x27;</span>);</span><br><span class="line"><span class="keyword">commit</span>;</span><br></pre></td></tr></table></figure>

<p>​		上锁用法：</p>
<p>​		lock  tables 表名1  read&#x2F;write，表名2 … read&#x2F;write …</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">查锁：</span><br></pre></td></tr></table></figure>

<p>​		show  open  tables;  </p>
<p>​		释放锁：</p>
<p>​		unlock tables;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 会话0</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">open</span> tables;</span><br><span class="line">lock tables tablelock read;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tablelock <span class="keyword">where</span> id <span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> tablelock <span class="keyword">where</span> id <span class="operator">=</span><span class="number">2</span>; # <span class="keyword">Table</span> <span class="string">&#x27;tablelock&#x27;</span> was locked <span class="keyword">with</span> a READ lock <span class="keyword">and</span> can<span class="string">&#x27;t be updated</span></span><br><span class="line"><span class="string">select * from emp; # Table &#x27;</span>emp<span class="string">&#x27; was not locked with LOCK TABLES</span></span><br><span class="line"><span class="string">delete from emp where eid =1; # Table &#x27;</span>emp<span class="string">&#x27; was not locked with LOCK TABLES</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">-- 会话1</span></span><br><span class="line"><span class="string">select * from dept;</span></span><br><span class="line"><span class="string">delete from dept where dno=16;# Query OK, 1 row affected (0.01 sec)</span></span><br><span class="line"><span class="string">select * from tablelock;</span></span><br><span class="line"><span class="string">delete from tablelock where id=1; # 一直等待会话0释放read锁，释放后才会写操作。</span></span><br></pre></td></tr></table></figure>

<h4 id="read锁总结："><a href="#read锁总结：" class="headerlink" title="read锁总结："></a>read锁总结：</h4><p>（一）</p>
<p>​		会话0对a表加了read锁，则该会话只能对a表进行读操作、不能写操作；该会话对其它表既不能读也不能写。（ 加锁的本会话仅保留了对a表读操作的能力。）</p>
<p>（二）</p>
<p>​		会话0 给a表加了read锁，其它会话：1、可以读、写其它表；2、对a表只能读，写则需要等待会话0释放read锁。</p>
<p>write锁的实验类似，这里略去。</p>
<h4 id="write锁总结："><a href="#write锁总结：" class="headerlink" title="write锁总结："></a>write锁总结：</h4><p>（一）</p>
<p>​		会话0对a表加的write锁，则可以对a表进行任何操作（增删改查）；不能对其它表进行任何操作（增删改查）。</p>
<p>（二）</p>
<p>​		其它会话对会话0设置write锁的a表，可以增删改查的前提，是要等会话0释放write锁。</p>
<p>补充：MySQL表级锁MyISAM引擎的工作模式如下。</p>
<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-22%2022.08.13.jpg" alt="截屏2022-02-22 22.08.13"></p>
<h4 id="分析表锁："><a href="#分析表锁：" class="headerlink" title="分析表锁："></a>分析表锁：</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 查看枷锁情况</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">open</span> talbes; # <span class="number">1</span>是加锁。</span><br><span class="line"># 查看表锁严重程度：</span><br><span class="line"><span class="keyword">show</span> status <span class="keyword">like</span> <span class="string">&#x27;table%&#x27;</span>; # table_locks_immediate 是立即能获得的锁的数量；table_locks_waited 是需要等待的表锁数量（数值越大锁竞争越激烈）；</span><br></pre></td></tr></table></figure>

<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-22%2022.22.03.jpg" alt="截屏2022-02-22 22.22.03"></p>
<h3 id="行锁示例"><a href="#行锁示例" class="headerlink" title="行锁示例"></a>行锁示例</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 会话0</span></span><br><span class="line"><span class="keyword">set</span> autocommit<span class="operator">=</span><span class="number">0</span>; # 关闭自动提交。用<span class="keyword">begin</span> 或者 transaction 手动声明也是可以的。</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> linelock(</span><br><span class="line">    id <span class="type">int</span>(<span class="number">5</span>) <span class="keyword">primary</span> key auto_increment,</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">20</span>)</span><br><span class="line">)engine<span class="operator">=</span>innodb;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> linelock(name) <span class="keyword">values</span>(<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> linelock(name) <span class="keyword">values</span>(<span class="string">&#x27;2&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> linelock(name) <span class="keyword">values</span>(<span class="string">&#x27;3&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> linelock(name) <span class="keyword">values</span>(<span class="string">&#x27;4&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> linelock(name) <span class="keyword">values</span>(<span class="string">&#x27;5&#x27;</span>);</span><br><span class="line"><span class="keyword">commit</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 会话0</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> linelock(name) <span class="keyword">values</span>(<span class="string">&#x27;a6&#x27;</span>);</span><br><span class="line"><span class="comment">-- 会话1（此时会话0关闭了自动提交，会话1还是自动提交的。）</span></span><br><span class="line"><span class="keyword">update</span> linelock <span class="keyword">set</span> name<span class="operator">=</span><span class="string">&#x27;ax&#x27;</span> <span class="keyword">where</span> id<span class="operator">=</span><span class="number">6</span>;</span><br><span class="line"># 此时会话<span class="number">1</span>会进入等待，等会话<span class="number">0</span>释放锁。</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话0</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> linelock <span class="keyword">value</span>(<span class="number">7</span>,<span class="string">&#x27;a7&#x27;</span>);</span><br><span class="line"><span class="comment">-- 会话1</span></span><br><span class="line"><span class="keyword">update</span> linelock <span class="keyword">set</span> name<span class="operator">=</span><span class="string">&#x27;ax&#x27;</span> <span class="keyword">where</span> id<span class="operator">=</span><span class="number">5</span>;</span><br><span class="line"># 行级锁，一次锁一行，操作不同行数据，互不不干扰。</span><br><span class="line"># 此时，会话<span class="number">0</span>因为事务还没有结束，因为没有被<span class="keyword">commit</span>，还是只能看见原表到自己这步操作，看不见会话<span class="number">1</span>已经提交的改动；会话<span class="number">1</span>自动提交了，能看见原表到自己这的改动，但是由于会话<span class="number">0</span>的事务还没有结束，看不见会话<span class="number">0</span>还未提交的改动。如下：</span><br></pre></td></tr></table></figure>

<p>会话1</p>
<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-10%2023.36.58.jpg" alt="截屏2022-10-10 23.36.58"></p>
<p>会话0</p>
<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-10%2023.39.38.jpg" alt="截屏2022-10-10 23.39.38"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 会话0 </span></span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"># 会话<span class="number">0</span>提交后结束事务，便可查询到会话<span class="number">1</span>所做的改动。</span><br></pre></td></tr></table></figure>

<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-23%2017.47.03.jpg" alt="截屏2022-02-23 17.47.03"></p>
<h4 id="行锁总结（关闭了自动提交）："><a href="#行锁总结（关闭了自动提交）：" class="headerlink" title="行锁总结（关闭了自动提交）："></a>行锁总结（关闭了自动提交）：</h4><p>​		1、如果会话x对某条数据a进行增删改(DML)操作，则其它会话必须等待会话x 结束事务（commit&#x2F;rollback）后，才能对a操作。</p>
<p>​		2、表锁通过unlock tables或者结束事物；行锁只能通过结束事务解锁。</p>
<h4 id="行锁注意事项："><a href="#行锁注意事项：" class="headerlink" title="行锁注意事项："></a>行锁注意事项：</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 会话0</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> linelock <span class="keyword">add</span> index idx_linelock_name(name);</span><br><span class="line"><span class="keyword">update</span> linelock <span class="keyword">set</span> name<span class="operator">=</span><span class="string">&#x27;ai&#x27;</span> <span class="keyword">where</span> name <span class="operator">=</span><span class="string">&#x27;3&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话1 </span></span><br><span class="line"><span class="keyword">update</span> linelock <span class="keyword">set</span> name<span class="operator">=</span><span class="string">&#x27;aix&#x27;</span> <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;4&#x27;</span>;</span><br><span class="line"># 改不同数据行不受影响。</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话0</span></span><br><span class="line"><span class="keyword">update</span> linelock <span class="keyword">set</span> name<span class="operator">=</span><span class="number">11</span> <span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">&#x27;%1%&#x27;</span> ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话1 </span></span><br><span class="line"><span class="keyword">update</span> linelock <span class="keyword">set</span> name<span class="operator">=</span><span class="number">22</span> <span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">&#x27;%2&#x27;</span>;</span><br><span class="line"># 发现会话<span class="number">1</span>的操作被阻塞了，直到会话<span class="number">0</span><span class="keyword">commit</span>结束会话才执行。这是因为name用了模糊搜索，导致了name索引失效了，行锁自动转换为了表锁！！！</span><br><span class="line"># 而由行锁放大而来的表锁把整个linelock表都锁住了，依然遵守行锁规范只是范围变大了，可以参考前文表锁，只要上了表锁，不管是read锁还是write锁，都是别的会话不能DML(增删改)此表，直到释放锁，或者结束事务<span class="keyword">commit</span>；</span><br></pre></td></tr></table></figure>

<p>​		a、如果没有索引，则行锁会转为表锁（主键也是一个索引，别忘了）；可以show index from 表 去查看一下索引情况。</p>
<p>​		b、开了一堆会话，有时候种种原因导致了互相锁，也分不清了，一些表连删都删不掉，可以关闭一些会话，只保留一个会话再操作。</p>
<p>​		c、行锁的特殊情况——间隙锁、临键锁。本题如id&#x3D;1～9之间 7号位置是个空缺，–会话0 输入 update linelock set name&#x3D;’x’ where id&gt;1 and id&lt;9  但是不提交，mysql会自动给id&#x3D;7的数据加临键锁（行锁）下面有说到，此时会话1若要DML id&#x3D;7的数据要等待临键锁锁释放。       可以理解为：（如果有where，实际加锁范围  就是where后面的范围，而不是实际的值。）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 会话0</span></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> linelock <span class="keyword">where</span> id <span class="operator">=</span><span class="number">7</span>;</span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"><span class="keyword">update</span> linelock <span class="keyword">set</span> name<span class="operator">=</span><span class="string">&#x27;x&#x27;</span> <span class="keyword">where</span> id<span class="operator">&gt;</span><span class="number">1</span> <span class="keyword">and</span> id<span class="operator">&lt;</span><span class="number">9</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话1</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> linelock <span class="keyword">values</span>(<span class="number">7</span>,<span class="string">&#x27;y&#x27;</span>);</span><br><span class="line"># 由于会话<span class="number">0</span>没<span class="keyword">commit</span>，间隙行锁没有被释放，会话<span class="number">1</span>被迫等待。</span><br></pre></td></tr></table></figure>

<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-23%2019.06.04.jpg" alt="截屏2022-02-23 19.06.04">	</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 行锁分析</span><br><span class="line"><span class="keyword">show</span> status <span class="keyword">like</span> <span class="string">&#x27;%innodb_row_lock%&#x27;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>​		<img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-23%2019.08.42.jpg" alt="截屏2022-02-23 19.08.42"></p>
<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-02-23%2019.10.55.jpg" alt="截屏2022-02-23 19.10.55"></p>
<p>补充：</p>
<p>​		在select时，在select语句末尾加for update，可以一样实现加行锁的目的。一下是 读锁（共享锁）锁一行的案例。但是这个不会只能读这锁住的一行，本表它表都能读，只是此行不能增改删。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 会话0</span></span><br><span class="line"><span class="keyword">select</span> name <span class="keyword">from</span> linelock <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">2</span> <span class="keyword">for</span> <span class="keyword">update</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话1</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> linelock <span class="keyword">where</span> id<span class="operator">=</span><span class="number">2</span>; # 会话<span class="number">1</span>查询时没有问题的。</span><br><span class="line"><span class="keyword">update</span> linelock <span class="keyword">set</span> name<span class="operator">=</span><span class="string">&#x27;y&#x27;</span> <span class="keyword">where</span> id<span class="operator">=</span><span class="number">2</span>; # dml增删改 就要等会话<span class="number">0</span>释放行锁了。</span><br></pre></td></tr></table></figure>



<h3 id="意向锁"><a href="#意向锁" class="headerlink" title="意向锁"></a>意向锁</h3><p>​		意向 共享锁、意向 排它锁。</p>
<p>​		<img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-10%2017.34.11.jpg" alt="截屏2022-10-10 17.34.11"></p>
<p>​		目的： 告诉你 这个表是否已经加锁了，加了什么锁。 不必再去每一个行去试了。</p>
<p>​		innodb 引擎有个问题，在 表没设置 主键的情况下， update 原本这样的自动上 排它锁的 操作，innodb引擎会自动 将 行锁 变成 表锁，此时对其他行 update 是无法操作。所以要加主键。</p>
<p>​		innodb 引擎 用模糊搜索 也会让 行锁升级表锁。</p>
<h3 id="行锁的区间"><a href="#行锁的区间" class="headerlink" title="行锁的区间"></a>行锁的区间</h3><p>​		假设表中的 id &#x3D; 1、5、9、11 四个位置储存有数据。</p>
<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-10%2017.45.47.jpg" alt="截屏2022-10-10 17.45.47"></p>
<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-10%2017.48.12.jpg" alt="截屏2022-10-10 17.48.12"></p>
<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-10%2017.54.04.jpg" alt="截屏2022-10-10 17.54.04"></p>
<p>​		间隙锁 一个非常易错的点： </p>
<p>​				如果 <code>where</code> 后面 书写的范围是 （13，正无穷） 那实际触发的间隙锁 还是 （11，正无穷） 这段间隙！！！</p>
<p>​		<img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-10%2017.59.03.jpg" alt="截屏2022-10-10 17.59.03"></p>
<p>​		</p>
<h2 id="MVCC-快照读（不用锁）实现隔离"><a href="#MVCC-快照读（不用锁）实现隔离" class="headerlink" title="MVCC 快照读（不用锁）实现隔离"></a>MVCC 快照读（不用锁）实现隔离</h2><p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-10%2018.16.26.jpg" alt="截屏2022-10-10 18.16.26"></p>
<p>​		不是给整个库 快照，而是对修改的数据 快照，以后挑最大的transaction_id 组成一套数据 来读。</p>
<p>​		但是 开始了事务以后，开启事务 时候的 transaction_id 分界，比它大的我们就不读了！！！</p>
<h3 id="“快照读”-结合-“当前读”"><a href="#“快照读”-结合-“当前读”" class="headerlink" title="“快照读” 结合 “当前读”"></a>“快照读” 结合 “当前读”</h3><p>​		<img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-10%2018.29.15.jpg" alt="截屏2022-10-10 18.29.15"></p>
<p>​		innodb默认 可重复读，所以 事务a 读两次都是 18；</p>
<p>​		<img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-10%2018.37.47.jpg" alt="截屏2022-10-10 18.37.47"></p>
<p>​		每一个事务开启时就要 确定已经提交的 最大 快照号，三个事务都是 999;</p>
<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-10%2018.38.37.jpg" alt="截屏2022-10-10 18.38.37"></p>
<p>​		事务c 修改了数据，记录新的事务号 row_trx_id &#x3D; 1002，age 的最新版本是1002 版本的19 了;</p>
<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-10%2018.42.02.jpg" alt="截屏2022-10-10 18.42.02"></p>
<p>​		事务b 要修改 age 数据时，又会去 数据库中找 最新版本的 age，找到 最新的age 对应 row_trx_id 版本号是 1002，所以用 1002 版本的age 数据。</p>
<p>​		事务b 修改完 age 数据后，会给自己的新的age数据 打上自己 1001版本 的标记 row_trx_id&#x3D;1001，此时1001版本的age 是最新的age 了；</p>
<p><img src="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2022-10-10%2018.49.58.jpg" alt="截屏2022-10-10 18.49.58"></p>
<p>​		事务b 读 age 时 看见 最新的age 对应的版本是1001，正好 自己的 trx_id&#x3D;1001 ，1001没有大于 1001，所以 事务b 读的age 就是 20。</p>
<p>​		事务a 读age， 因为事务a 没有对age 进行修改， 所以  读 一堆age版本时，用自己的 up_limit_id &#x3D;999 来划分，从新到旧，遇到小于等于999版本的age 读取，所以还是 18。</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/mysql/" rel="tag"># mysql</a>
              <a href="/tags/%E7%B4%A2%E5%BC%95/" rel="tag"># 索引</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2020/09/05/Hexo%E9%85%8D%E5%90%88GitHub%E7%AE%80%E6%98%93%E5%BB%BA%E7%AB%8B%E5%8D%9A%E5%AE%A2/Hexo%E9%85%8D%E5%90%88GitHub%E7%AE%80%E6%98%93%E5%BB%BA%E7%AB%8B%E5%8D%9A%E5%AE%A2/" rel="prev" title="Hexo配合GitHub简易建立博客">
                  <i class="fa fa-chevron-left"></i> Hexo配合GitHub简易建立博客
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2020/11/12/mysql%E5%AD%A6%E4%B9%A0/mysql%E8%80%83%E7%82%B9/" rel="next" title="mysql考点">
                  mysql考点 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">陈宇韶chenyushao</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
