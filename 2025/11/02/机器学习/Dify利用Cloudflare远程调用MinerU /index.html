<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha256-AbA177XfpSnFEvgpYu1jMygiLabzPCJCRIBtR5jGc0k=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.13.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="这是文章开头，显示在主页面，详情请点击此处。">
<meta property="og:type" content="article">
<meta property="og:title" content="Dify利用Cloudflare远程调用MinerU">
<meta property="og:url" content="http://example.com/2025/11/02/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/Dify%E5%88%A9%E7%94%A8Cloudflare%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8MinerU%20/index.html">
<meta property="og:site_name" content="Tiger_pop&#39;s Blog">
<meta property="og:description" content="这是文章开头，显示在主页面，详情请点击此处。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-11-02T05:18:18.000Z">
<meta property="article:modified_time" content="2025-11-02T05:50:50.150Z">
<meta property="article:author" content="陈宇韶chenyushao">
<meta property="article:tag" content="docker">
<meta property="article:tag" content="Dify">
<meta property="article:tag" content="MinerU">
<meta property="article:tag" content="OCR">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/2025/11/02/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/Dify%E5%88%A9%E7%94%A8Cloudflare%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8MinerU%20/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://example.com/2025/11/02/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/Dify%E5%88%A9%E7%94%A8Cloudflare%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8MinerU%20/","path":"2025/11/02/机器学习/Dify利用Cloudflare远程调用MinerU /","title":"Dify利用Cloudflare远程调用MinerU"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Dify利用Cloudflare远程调用MinerU | Tiger_pop's Blog</title>
  






  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="Tiger_pop's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Tiger_pop's Blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">tiger_pop 的博客</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#MinerU-%E9%83%A8%E7%BD%B2%EF%BC%88docker%E7%89%88%E6%9C%AC%EF%BC%89%E5%A4%B1%E8%B4%A5%E4%BA%86%EF%BC%81"><span class="nav-number">1.</span> <span class="nav-text">MinerU 部署（docker版本）失败了！</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9yaml%E6%96%87%E4%BB%B6"><span class="nav-number">1.1.</span> <span class="nav-text">修改yaml文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C"><span class="nav-number">1.2.</span> <span class="nav-text">运行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%84%E7%90%86docker%E5%A2%99%E5%86%85%E9%97%AE%E9%A2%98"><span class="nav-number">1.3.</span> <span class="nav-text">处理docker墙内问题</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#MinerU%E9%83%A8%E7%BD%B2%EF%BC%88from-source-code%EF%BC%89-%E4%BA%B2%E6%B5%8B%E5%8F%AF%E7%94%A8"><span class="nav-number">2.</span> <span class="nav-text">MinerU部署（from source code） 亲测可用</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85"><span class="nav-number">2.1.</span> <span class="nav-text">安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E4%BB%85%E4%BB%85%E8%B0%83%E7%94%A8CPU%E6%A8%A1%E5%BC%8F"><span class="nav-number">2.1.1.</span> <span class="nav-text">一、仅仅调用CPU模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8C%E3%80%81GPU%E5%8A%A0%E9%80%9F%E6%A8%A1%E5%BC%8F%EF%BC%88%E8%A1%A5%E5%85%85%EF%BC%89"><span class="nav-number">2.1.2.</span> <span class="nav-text">二、GPU加速模式（补充）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8"><span class="nav-number">2.2.</span> <span class="nav-text">使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9B%86%E6%88%90%E8%BF%9BDify%EF%BC%88%E9%87%8D%E7%82%B9%EF%BC%89"><span class="nav-number">2.3.</span> <span class="nav-text">集成进Dify（重点）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F"><span class="nav-number">2.3.1.</span> <span class="nav-text">构建镜像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8-mineru-api-%E6%9C%8D%E5%8A%A1"><span class="nav-number">2.3.2.</span> <span class="nav-text">启动 mineru-api 服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9Dify%E9%85%8D%E7%BD%AE"><span class="nav-number">2.3.3.</span> <span class="nav-text">修改Dify配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Dify%E9%A1%B5%E9%9D%A2%E9%85%8D%E7%BD%AE"><span class="nav-number">2.3.4.</span> <span class="nav-text">Dify页面配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Dify-MinerU%E6%B5%8B%E8%AF%95"><span class="nav-number">2.3.5.</span> <span class="nav-text">Dify+MinerU测试</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%88%A9%E7%94%A8Cloudflare%E8%BF%9C%E7%A8%8B%E8%AE%BF%E9%97%AE"><span class="nav-number">3.</span> <span class="nav-text">利用Cloudflare远程访问</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="陈宇韶chenyushao"
      src="/images/my.jpg">
  <p class="site-author-name" itemprop="name">陈宇韶chenyushao</p>
  <div class="site-description" itemprop="description">爱学习、爱工作、爱生活;         微信号: Tiger_and_master;         手机号码:18515678348 </div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">429</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">26</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">205</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/11/02/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/Dify%E5%88%A9%E7%94%A8Cloudflare%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8MinerU%20/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/my.jpg">
      <meta itemprop="name" content="陈宇韶chenyushao">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tiger_pop's Blog">
      <meta itemprop="description" content="爱学习、爱工作、爱生活;         微信号: Tiger_and_master;         手机号码:18515678348 ">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Dify利用Cloudflare远程调用MinerU | Tiger_pop's Blog">
      <meta itemprop="description" content="这是文章开头，显示在主页面，详情请点击此处。">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Dify利用Cloudflare远程调用MinerU
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-11-02 13:18:18 / 修改时间：13:50:50" itemprop="dateCreated datePublished" datetime="2025-11-02T13:18:18+08:00">2025-11-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">机器学习</span></a>
        </span>
    </span>

  
</div>

            <div class="post-description">这是文章开头，显示在主页面，详情请点击此处。</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="MinerU-部署（docker版本）失败了！"><a href="#MinerU-部署（docker版本）失败了！" class="headerlink" title="MinerU 部署（docker版本）失败了！"></a>MinerU 部署（docker版本）失败了！</h1><p>我的 【使用 Dockerfile 构建 Docker 镜像 】这一步总是失败，最后放弃了docker版本的MinerU的安装。</p>
<p>参考MinerU官网：</p>
<p><a target="_blank" rel="noopener" href="https://opendatalab.github.io/MinerU/quick_start/docker_deployment/#start-docker-container">https://opendatalab.github.io/MinerU/quick_start/docker_deployment/#start-docker-container</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Download compose.yaml file</span></span><br><span class="line">wget https://gcore.jsdelivr.net/gh/opendatalab/MinerU@master/docker/compose.yaml</span><br></pre></td></tr></table></figure>

<p>MinerU 的结构本质上是「两部分组成」</p>
<ol>
<li>OCR &#x2F; 文档内容识别本体（MinerU Engine）</li>
<li>语言模型（vLLM Server）</li>
</ol>
<p>也就是说：</p>
<ul>
<li><strong>MinerU 可以只做 OCR 纯识别，不依赖大模型</strong></li>
<li>如果你 <strong>希望得到结构化、可读性很强的段落&#x2F;表格&#x2F;语义文档</strong> → 那就需要 <strong>vLLM Server</strong>（也就是将大模型挂载给 MinerU 做后处理）</li>
</ul>
<p><strong>注意：</strong></p>
<p>由于 我用 vllm ray 集群部署大模型和dify的是两台机器甲、乙，而 两台机器中的每一张卡的显存 都已经22879MiB &#x2F;  24564MiB，快要满了，同时 MinerU 推荐 使用单卡的 gpu 来做OCR 识别，所以我上面的 MinerU 是部署到了第三台机器中，以下涉及到MinerU的都是在第三台机器中运行的。</p>
<p>然后我在 dify 中掉用这集群外的机器的 MinerU。</p>
<h2 id="修改yaml文件"><a href="#修改yaml文件" class="headerlink" title="修改yaml文件"></a>修改yaml文件</h2><p>看看 yaml 内容,稍微修改，这里不建议 用多卡 做 OCR ，还是推荐它默认的 gpu 0 单卡。我换了一个17777端口。<code> compose.yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">mineru-vllm-server:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mineru-vllm:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">mineru-vllm-server</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">profiles:</span> [<span class="string">&quot;vllm-server&quot;</span>]</span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">30000</span><span class="string">:30000</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">MINERU_MODEL_SOURCE:</span> <span class="string">local</span></span><br><span class="line">    <span class="attr">entrypoint:</span> <span class="string">mineru-vllm-server</span></span><br><span class="line">    <span class="attr">command:</span></span><br><span class="line">      <span class="string">--host</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">      <span class="string">--port</span> <span class="number">30000</span></span><br><span class="line">      <span class="comment"># --data-parallel-size 2  # If using multiple GPUs, increase throughput using vllm&#x27;s multi-GPU parallel mode</span></span><br><span class="line">      <span class="comment"># --gpu-memory-utilization 0.5  # If running on a single GPU and encountering VRAM shortage, reduce the KV cache size by this parameter, if VRAM issues persist, try lowering it further to `0.4` or below.</span></span><br><span class="line">    <span class="attr">ulimits:</span></span><br><span class="line">      <span class="attr">memlock:</span> <span class="number">-1</span></span><br><span class="line">      <span class="attr">stack:</span> <span class="number">67108864</span></span><br><span class="line">    <span class="attr">ipc:</span> <span class="string">host</span></span><br><span class="line">    <span class="attr">healthcheck:</span></span><br><span class="line">      <span class="attr">test:</span> [<span class="string">&quot;CMD-SHELL&quot;</span>, <span class="string">&quot;curl -f http://localhost:30000/health || exit 1&quot;</span>]</span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">resources:</span></span><br><span class="line">        <span class="attr">reservations:</span></span><br><span class="line">          <span class="attr">devices:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">driver:</span> <span class="string">nvidia</span></span><br><span class="line">              <span class="attr">device_ids:</span> [<span class="string">&quot;0&quot;</span>]</span><br><span class="line">              <span class="attr">capabilities:</span> [<span class="string">gpu</span>]</span><br><span class="line"></span><br><span class="line">  <span class="attr">mineru-api:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mineru-vllm:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">mineru-api</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">profiles:</span> [<span class="string">&quot;api&quot;</span>]</span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">17777</span><span class="string">:8000</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">MINERU_MODEL_SOURCE:</span> <span class="string">local</span></span><br><span class="line">    <span class="attr">entrypoint:</span> <span class="string">mineru-api</span></span><br><span class="line">    <span class="attr">command:</span></span><br><span class="line">      <span class="string">--host</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">      <span class="string">--port</span> <span class="number">8000</span></span><br><span class="line">      <span class="comment"># parameters for vllm-engine</span></span><br><span class="line">      <span class="comment"># --data-parallel-size 2  # If using multiple GPUs, increase throughput using vllm&#x27;s multi-GPU parallel mode</span></span><br><span class="line">      <span class="comment"># --gpu-memory-utilization 0.5  # If running on a single GPU and encountering VRAM shortage, reduce the KV cache size by this parameter, if VRAM issues persist, try lowering it further to `0.4` or below.</span></span><br><span class="line">    <span class="attr">ulimits:</span></span><br><span class="line">      <span class="attr">memlock:</span> <span class="number">-1</span></span><br><span class="line">      <span class="attr">stack:</span> <span class="number">67108864</span></span><br><span class="line">    <span class="attr">ipc:</span> <span class="string">host</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">resources:</span></span><br><span class="line">        <span class="attr">reservations:</span></span><br><span class="line">          <span class="attr">devices:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">driver:</span> <span class="string">nvidia</span></span><br><span class="line">              <span class="attr">device_ids:</span> [ <span class="string">&quot;0&quot;</span> ]</span><br><span class="line">              <span class="attr">capabilities:</span> [ <span class="string">gpu</span> ]</span><br><span class="line"></span><br><span class="line">  <span class="attr">mineru-gradio:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mineru-vllm:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">mineru-gradio</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">profiles:</span> [<span class="string">&quot;gradio&quot;</span>]</span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">7860</span><span class="string">:7860</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">MINERU_MODEL_SOURCE:</span> <span class="string">local</span></span><br><span class="line">    <span class="attr">entrypoint:</span> <span class="string">mineru-gradio</span></span><br><span class="line">    <span class="attr">command:</span></span><br><span class="line">      <span class="string">--server-name</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">      <span class="string">--server-port</span> <span class="number">7860</span></span><br><span class="line">      <span class="string">--enable-vllm-engine</span> <span class="literal">true</span>  <span class="comment"># Enable the vllm engine for Gradio</span></span><br><span class="line">      <span class="comment"># --enable-api false  # If you want to disable the API, set this to false</span></span><br><span class="line">      <span class="comment"># --max-convert-pages 20  # If you want to limit the number of pages for conversion, set this to a specific number</span></span><br><span class="line">      <span class="comment"># parameters for vllm-engine</span></span><br><span class="line">      <span class="comment"># --data-parallel-size 2  # If using multiple GPUs, increase throughput using vllm&#x27;s multi-GPU parallel mode</span></span><br><span class="line">      <span class="comment"># --gpu-memory-utilization 0.5  # If running on a single GPU and encountering VRAM shortage, reduce the KV cache size by this parameter, if VRAM issues persist, try lowering it further to `0.4` or below.</span></span><br><span class="line">    <span class="attr">ulimits:</span></span><br><span class="line">      <span class="attr">memlock:</span> <span class="number">-1</span></span><br><span class="line">      <span class="attr">stack:</span> <span class="number">67108864</span></span><br><span class="line">    <span class="attr">ipc:</span> <span class="string">host</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">resources:</span></span><br><span class="line">        <span class="attr">reservations:</span></span><br><span class="line">          <span class="attr">devices:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">driver:</span> <span class="string">nvidia</span></span><br><span class="line">              <span class="attr">device_ids:</span> [ <span class="string">&quot;0&quot;</span> ]</span><br><span class="line">              <span class="attr">capabilities:</span> [ <span class="string">gpu</span> ]</span><br></pre></td></tr></table></figure>



<h2 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h2><p>这里需要注意几个点：</p>
<p>一、</p>
<p>MinerU 的GitHub仓库中写的是 需要 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Build Docker Image using Dockerfile</span></span><br><span class="line"><span class="comment"># 使用 Dockerfile 本地构建 Docker 镜像</span></span><br><span class="line"><span class="comment"># 先运行 </span></span><br><span class="line">docker build -t mineru-vllm:latest -f Dockerfile .</span><br><span class="line"><span class="comment"># 如果容器内部网络配置问题，无法解析和连接到 huggingface.co，在构建时使用宿主机的网络栈，运行：</span></span><br><span class="line">docker build --network=host -t mineru-vllm:latest -f Dockerfile .</span><br></pre></td></tr></table></figure>

<p>而不能直接去 docker compose 从指定的源去拉取，那样会找不到文件。<br>二、</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Due to the pre-allocation of GPU memory by the vllm inference acceleration framework, you may not be able to run multiple vllm services simultaneously on the same machine. Therefore, ensure that other services that might use GPU memory have been stopped before starting the vlm-vllm-server service or using the vlm-vllm-engine backend.</span><br><span class="line">由于 vllm 推理加速框架预先分配了 GPU 内存，您可能无法在同一台机器上同时运行多个 vllm 服务。因此，请确保在启动 vlm-vllm-server 服务或使用 vlm-vllm-engine 后端之前，已停止其他可能使用 GPU 内存的服务。</span><br></pre></td></tr></table></figure>

<p><strong>既然我已经有自己的 vLLM + Ray 推理集群，就不要启 MinerU 的 vLLM-Server。</strong><br> <strong>直接把 MinerU 当 OCR 引擎用，再把结果交给你自己的大模型做处理，是最佳方案。</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 仅仅执行 OCR。</span></span><br><span class="line">docker compose -f compose.yaml --profile api up -d</span><br><span class="line"></span><br><span class="line"><span class="comment"># 而不要执行：MinerU 下 yaml 中的 vllm-server </span></span><br></pre></td></tr></table></figure>

<blockquote>
<table>
<thead>
<tr>
<th>服务名</th>
<th>Profile 名（启动用的）在yaml文件中有写明</th>
</tr>
</thead>
<tbody><tr>
<td>mineru-vllm-server</td>
<td>vllm-server</td>
</tr>
<tr>
<td>mineru-api</td>
<td>api</td>
</tr>
<tr>
<td>mineru-gradio</td>
<td>gradio</td>
</tr>
</tbody></table>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动的是：profiles: [&quot;api&quot;] → mineru-api</span></span><br><span class="line">docker compose -f compose.yaml --profile api up -d</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动的是：mineru-gradio</span></span><br><span class="line"><span class="comment"># docker compose -f compose.yaml --profile gradio up -d</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动的是：mineru-vllm-server</span></span><br><span class="line"><span class="comment"># docker compose -f compose.yaml --profile vllm-server up -d</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="处理docker墙内问题"><a href="#处理docker墙内问题" class="headerlink" title="处理docker墙内问题"></a>处理docker墙内问题</h2><p><code> sudo cat /etc/docker/daemon.json</code></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;registry-mirrors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;https://docker.m.daocloud.io&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;https://mirror.ccs.tencentyun.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;https://func.ink&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;https://proxy.1panel.live&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;https://docker.zhai.cm&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;runtimes&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;nvidia&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;nvidia-container-runtime&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>如果遇到 报错<br><code> [+] Running 1/1 ✘ mineru-api Error Head &quot;https://ghcr.io/v2/open-mmlab/mineru/manifests/latest&quot;: denied                                 1.5sError response from daemon: Head &quot;https://ghcr.io/v2/open-mmlab/mineru/manifests/latest&quot;: denied</code></p>
<p>MinerU 镜像在 <strong>ghcr.io</strong>，它默认需要 Token，否则会出现你看到的 <code>denied</code>。</p>
<blockquote>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/settings/tokens">https://github.com/settings/tokens</a> → 选择 <strong>Classic Tokens</strong> → 打开 <code>read:packages</code> 权限,然后执行</p>
</blockquote>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> YOUR_GITHUB_TOKEN | docker login ghcr.io -u YOUR_GITHUB_USERNAME <span class="params">--password-stdin</span></span><br></pre></td></tr></table></figure>

<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> 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XXXX  | docker login ghcr.io -u  Tigerpop <span class="params">--password-stdin</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>如果还是不行，就直接使用我之前的笔记，Ubuntu上用v2rayA代理的笔记。</p>
<h1 id="MinerU部署（from-source-code）-亲测可用"><a href="#MinerU部署（from-source-code）-亲测可用" class="headerlink" title="MinerU部署（from source code） 亲测可用"></a>MinerU部署（from source code） 亲测可用</h1><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="一、仅仅调用CPU模式"><a href="#一、仅仅调用CPU模式" class="headerlink" title="一、仅仅调用CPU模式"></a>一、仅仅调用CPU模式</h3><p>conda 新建虚拟环境，在 此环境&gt;3.10中运行。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pip install uv</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/opendatalab/MinerU.git</span><br><span class="line"><span class="built_in">cd</span> MinerU</span><br><span class="line">python -m venv .venv <span class="comment"># 创建虚拟运行空间，运行成功后可见一个.venv虚拟运行文件夹</span></span><br><span class="line"><span class="built_in">source</span> .venv/bin/activate <span class="comment"># 激活此新建虚拟空间</span></span><br><span class="line">uv pip install -e .[core] -i https://mirrors.aliyun.com/pypi/simple <span class="comment"># 启动安装命令</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="二、GPU加速模式（补充）"><a href="#二、GPU加速模式（补充）" class="headerlink" title="二、GPU加速模式（补充）"></a>二、GPU加速模式（补充）</h3><p>安装nvidia-cuda-toolkit ，<code>nvcc --version</code> 检查是否安装好了。</p>
<p>torch 官网 <a target="_blank" rel="noopener" href="https://pytorch.org/get-started/locally/">https://pytorch.org/get-started/locally/</a>  ，.venv虚拟环境中安装cuda版本的三件套 <code>torch torchvision torchaudio</code>。可以在 前面 .venv 环境的pip 中先检查是否已经装好。</p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>命令使用<code>mineru</code>，</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 仅使用cpu</span></span><br><span class="line">mineru -p &lt;input_path&gt; -o &lt;output_path&gt;</span><br><span class="line">mineru -p &lt;input_path&gt; -o &lt;output_path&gt; --<span class="built_in">source</span> modelscope <span class="comment"># 国内魔塔源</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用GPU</span></span><br><span class="line">mineru -p &lt;input_path&gt; -o &lt;output_path&gt; -d cuda</span><br><span class="line">mineru -p &lt;input_path&gt; -o &lt;output_path&gt; -d cuda --<span class="built_in">source</span> modelscope <span class="comment"># 国内魔塔源</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 第一次运行的时候会自行下载一些配套工具，稍微等待即可，我GPU做一次A4纸的文件识别大约18秒。</span></span><br></pre></td></tr></table></figure>

<h2 id="集成进Dify（重点）"><a href="#集成进Dify（重点）" class="headerlink" title="集成进Dify（重点）"></a>集成进Dify（重点）</h2><h3 id="构建镜像"><a href="#构建镜像" class="headerlink" title="构建镜像"></a>构建镜像</h3><p>在MinerU文件夹内进入docker文件夹，</p>
<p>进入 china 文件夹，目的是找到 Dockerfile 文件，选取 Dockerfile 中指定服务，来本地构建 Docker 镜像，具体哪些服务可以从 compose.yaml 文件中看。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> docker/china</span><br><span class="line">docker build -t mineru-api . <span class="comment"># 仅仅为这个服务构建镜像。15G 左右等等，可能花3小时时间。</span></span><br></pre></td></tr></table></figure>

<p>效果</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">(.venv) (py3.10) cys@cysserver:/data/MinerU/docker/china$ docker build -t mineru-api .</span><br><span class="line">[+] Building 10267.1s (8/8) FINISHED                                                                                                       docker:default</span><br><span class="line"> =&gt; [internal] load build definition from Dockerfile                                                                                                 0.0s</span><br><span class="line"> =&gt; =&gt; transferring dockerfile: 1.34kB                                                                                                               0.0s</span><br><span class="line"> =&gt; [internal] load metadata <span class="keyword">for</span> docker.m.daocloud.io/vllm/vllm-openai:v0.10.1.1                                                                     0.9s</span><br><span class="line"> =&gt; [internal] load .dockerignore                                                                                                                    0.0s</span><br><span class="line"> =&gt; =&gt; transferring context: 2B                                                                                                                      0.0s</span><br><span class="line"> =&gt; [1/4] FROM docker.m.daocloud.io/vllm/vllm-openai:v0.10.1.1@sha256:d731ee65c044ae0977421eed3d93f931d4b7d79614394184c939db35b8f28fc2               0.0s</span><br><span class="line"> =&gt; CACHED [2/4] RUN apt-get update &amp;&amp;     apt-get install -y         fonts-noto-core         fonts-noto-cjk         fontconfig         libgl1 &amp;&amp;    0.0s</span><br><span class="line"> =&gt; [3/4] RUN python3 -m pip install -U <span class="string">&#x27;mineru[core]&#x27;</span> -i https://mirrors.aliyun.com/pypi/simple --break-system-packages &amp;&amp;     python3 -m pip c  9464.8s</span><br><span class="line"> =&gt; [4/4] RUN /bin/bash -c <span class="string">&quot;mineru-models-download -s modelscope -m all&quot;</span>                                                                           791.6s</span><br><span class="line"> =&gt; exporting to image                                                                                                                               9.6s</span><br><span class="line"> =&gt; =&gt; exporting layers                                                                                                                              9.6s</span><br><span class="line"> =&gt; =&gt; writing image sha256:c808ac45897484d9771d4b1b36e902955fa9ba6867df2f454bac431a3091b18f                                                         0.0s</span><br><span class="line"> =&gt; =&gt; naming to docker.io/library/mineru-api     </span><br><span class="line"> </span><br><span class="line"><span class="comment"># 可见花了我 10267.1s = 2小时51分7.1秒</span></span><br></pre></td></tr></table></figure>

<h3 id="启动-mineru-api-服务"><a href="#启动-mineru-api-服务" class="headerlink" title="启动 mineru-api 服务"></a>启动 mineru-api 服务</h3><p>启动 MinerU-api (内容有哪些可以去官网看，也能从compose.yaml看到)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 开起伪终端，且退出终端自动 rm 销毁容器。</span></span><br><span class="line">docker run --<span class="built_in">rm</span> --gpus all \</span><br><span class="line">  -p 17777:8000 \</span><br><span class="line">  --ipc=host \</span><br><span class="line">  -it mineru-api \</span><br><span class="line">  /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># 容器内开启 web API 服务</span></span><br><span class="line">mineru-api --host 0.0.0.0 --port 8000</span><br><span class="line"><span class="comment"># python -m：以模块方式运行 Python 代码</span></span><br><span class="line"><span class="comment"># mineru.api：运行 MinerU 包中的 API 模块</span></span><br><span class="line"><span class="comment"># 0.0.0.0表示监听所有可用的网络接口</span></span><br><span class="line"><span class="comment"># 8000是容器内部的服务端口</span></span><br><span class="line"><span class="comment"># -------------------- 成功时展现 --------------------</span></span><br><span class="line">2025-11-01 05:14:43.703531494 [W:onnxruntime:Default, device_discovery.cc:164 DiscoverDevicesForPlatform] GPU device discovery failed: device_discovery.cc:89 ReadFileContents Failed to open file: <span class="string">&quot;/sys/class/drm/card0/device/vendor&quot;</span></span><br><span class="line">Start MinerU FastAPI Service: http://0.0.0.0:8000</span><br><span class="line">The API documentation can be accessed at the following address:</span><br><span class="line">- Swagger UI: http://0.0.0.0:8000/docs</span><br><span class="line">- ReDoc: http://0.0.0.0:8000/redoc</span><br><span class="line">INFO:     Started server process [13]</span><br><span class="line">INFO:     Waiting <span class="keyword">for</span> application startup.</span><br><span class="line">INFO:     Application startup complete.</span><br><span class="line">INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)</span><br><span class="line"><span class="comment"># -------------------- 成功时展现 --------------------</span></span><br></pre></td></tr></table></figure>

<p>我们在伪终端和宿主机中检查是否成功，注意伪终端不能exit退出，退出就rm镜像了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在容器内执行</span></span><br><span class="line">nvidia-smi</span><br><span class="line"><span class="comment"># 检查 MinerU 是否安装</span></span><br><span class="line"><span class="built_in">which</span> mineru</span><br><span class="line">mineru --<span class="built_in">help</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在宿主机执行</span></span><br><span class="line">docker ps</span><br><span class="line">docker images</span><br></pre></td></tr></table></figure>

<p>我们读 doc 文档 <code>http://10.5.9.249:17777/docs</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">看见 post 写着 /file_parse  <span class="comment"># parse pdf ,这个意思是 post 需要访问的URL是 http://10.5.9.249:17777/file_parse</span></span><br><span class="line"></span><br><span class="line">看见 Request body 后面写着 multipart/form-data <span class="comment"># </span></span><br><span class="line"><span class="comment"># http协议里</span></span><br><span class="line"><span class="comment"># application/json → 发送 JSON 数据（不能直接传文件）</span></span><br><span class="line"><span class="comment"># multipart/form-data → 发送文件和普通字段混合数据</span></span><br><span class="line"><span class="comment"># Python 的 requests 库专门对 multipart/form-data 做了封装：</span></span><br><span class="line"><span class="comment"># resp = requests.post(url, files=files) 就是固定写法。</span></span><br><span class="line"></span><br><span class="line">下面一堆内容，例如 </span><br><span class="line">files *</span><br><span class="line">array&lt;string&gt;</span><br><span class="line"><span class="comment"># files → 参数名； * → 必填；files 是一个数组，数组内的元素是字符串，在 HTTP 里，上传文件要用 multipart/form-data。比如你用浏览器上传文件：</span></span><br><span class="line"><span class="comment"># 一段解释数据说明它后面是a.jpg</span></span><br><span class="line"><span class="comment"># 一段二进制数据a.jpg</span></span><br><span class="line"><span class="comment"># 一段解释数据说明它后面是b.jpg</span></span><br><span class="line"><span class="comment"># 一段二进制数据b.jpg</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="comment"># 所以这就成了固定的写法：</span></span><br><span class="line"><span class="comment">#  files = [</span></span><br><span class="line"><span class="comment">#     (&#x27;files&#x27;, open(&#x27;file1.pdf&#x27;, &#x27;rb&#x27;)),</span></span><br><span class="line"><span class="comment">#     (&#x27;files&#x27;, open(&#x27;file2.jpg&#x27;, &#x27;rb&#x27;))</span></span><br><span class="line"><span class="comment"># ] </span></span><br><span class="line"><span class="comment"># 对照 HTTP：</span></span><br><span class="line"><span class="comment"># 第一个元素 &#x27;files&#x27; → 对应 name=&quot;files&quot;，所以都写成 files。</span></span><br><span class="line"><span class="comment"># 第二个元素 open(..., &#x27;rb&#x27;) → 文件二进制流，对应 HTTP body</span></span><br><span class="line"><span class="comment"># 数组就直接用 Python list [ ... ] 包裹多个 (name, file) 元组 → 变成数组上传</span></span><br></pre></td></tr></table></figure>

<p>因此 我们用chatgpt生成一个脚本测试</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&quot;http://10.5.9.249:17777/file_parse&quot;</span></span><br><span class="line">files = [</span><br><span class="line">    (<span class="string">&#x27;files&#x27;</span>, <span class="built_in">open</span>(<span class="string">&#x27;test.jpg&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>)),   <span class="comment"># 换成你的文件路径</span></span><br><span class="line">]</span><br><span class="line">resp = requests.post(url, files=files)</span><br><span class="line"><span class="built_in">print</span>(resp.json())</span><br></pre></td></tr></table></figure>

<p>将一个脚本所在文件夹的 test.jpg 文件中的 文字读出来并终端打印了出来。</p>
<h3 id="修改Dify配置"><a href="#修改Dify配置" class="headerlink" title="修改Dify配置"></a>修改Dify配置</h3><p>停下Dify，修改 Dify 的docker 下.env文件。由于 Dify运行在A机器中，MinerU在B机器，这里涉及到了一个通信。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 停下dify</span></span><br><span class="line">docker compose down</span><br><span class="line"></span><br><span class="line">vim .<span class="built_in">env</span> </span><br><span class="line"><span class="comment"># ---------------------------- .env ---------------------------- </span></span><br><span class="line">FILES_URL=http://api:5001 <span class="comment"># 原来是=空的  FILES_URL=</span></span><br><span class="line"><span class="comment"># ---------------------------- .env ---------------------------- </span></span><br><span class="line"></span><br><span class="line">用户上传文件到 A机器(Dify)</span><br><span class="line">    ↓</span><br><span class="line">Dify 存储文件并生成文件链接：http://A_IP:5001/xxx</span><br><span class="line">    ↓  </span><br><span class="line">Dify 调用 B机器(MinerU) 的 API，传递文件链接</span><br><span class="line">    ↓</span><br><span class="line">MinerU 从 http://A_IP:5001/xxx 下载文件进行处理</span><br><span class="line">    ↓</span><br><span class="line">MinerU 返回处理结果给 Dify</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新运行dify</span></span><br><span class="line">docker compose up -d</span><br></pre></td></tr></table></figure>

<h3 id="Dify页面配置"><a href="#Dify页面配置" class="headerlink" title="Dify页面配置"></a>Dify页面配置</h3><ol>
<li><p>下载MinerU插件；</p>
</li>
<li><p>API Key 授权配置；</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://10.5.9.249:17777  <span class="comment"># MinerU服务的Base URL </span></span><br><span class="line">本地部署                  <span class="comment"># 服务类型</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="Dify-MinerU测试"><a href="#Dify-MinerU测试" class="headerlink" title="Dify+MinerU测试"></a>Dify+MinerU测试</h3><p>先开一个工作流；</p>
<p>在【开始】里面设置输入文件，定一个 变量；</p>
<p>下一个节点选【工具】里的【MinerU】；</p>
<p>点击 MinerU 节点下的 Parse File，设置 输入变量、解析方法 、开启 OCR 识别；</p>
<p>下一步直接回答，即可测试。</p>
<h1 id="利用Cloudflare远程访问"><a href="#利用Cloudflare远程访问" class="headerlink" title="利用Cloudflare远程访问"></a>利用Cloudflare远程访问</h1><p>这个以后再做吧，我找同事开启了一个公网的地址，用上了。</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/docker/" rel="tag"># docker</a>
              <a href="/tags/Dify/" rel="tag"># Dify</a>
              <a href="/tags/MinerU/" rel="tag"># MinerU</a>
              <a href="/tags/OCR/" rel="tag"># OCR</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/11/01/%E7%A7%91%E5%AD%A6%E9%82%A3%E4%B8%AA%E4%B8%8A%E7%BD%91/Ubuntu%E4%B8%8A%E7%94%A8v2rayA/" rel="prev" title="Ubuntu上用v2rayA">
                  <i class="fa fa-chevron-left"></i> Ubuntu上用v2rayA
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">陈宇韶chenyushao</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
