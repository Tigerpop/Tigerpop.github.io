<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha256-AbA177XfpSnFEvgpYu1jMygiLabzPCJCRIBtR5jGc0k=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.13.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="这是文章开头，显示在主页面，详情请点击此处。">
<meta property="og:type" content="article">
<meta property="og:title" content="go笔记">
<meta property="og:url" content="http://example.com/2025/01/01/go%E5%AD%A6%E4%B9%A0/go%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="Tiger_pop&#39;s Blog">
<meta property="og:description" content="这是文章开头，显示在主页面，详情请点击此处。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2025/01/01/go%E5%AD%A6%E4%B9%A0/go%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2023-08-22%2011.06.34.jpg">
<meta property="og:image" content="http://example.com/2025/01/01/go%E5%AD%A6%E4%B9%A0/go%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2023-08-22%2011.12.42.jpg">
<meta property="og:image" content="http://example.com/2025/01/01/go%E5%AD%A6%E4%B9%A0/go%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2023-08-25%2011.06.51.jpg">
<meta property="og:image" content="http://example.com/2025/01/01/go%E5%AD%A6%E4%B9%A0/go%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2023-08-25%2016.05.21.jpg">
<meta property="og:image" content="http://example.com/2025/01/01/go%E5%AD%A6%E4%B9%A0/go%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2023-08-25%2016.05.40.jpg">
<meta property="og:image" content="http://example.com/2025/01/01/go%E5%AD%A6%E4%B9%A0/go%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2023-08-25%2016.24.25.jpg">
<meta property="og:image" content="http://example.com/2025/01/01/go%E5%AD%A6%E4%B9%A0/go%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2023-09-02%2010.59.52.jpg">
<meta property="og:image" content="http://example.com/2025/01/01/go%E5%AD%A6%E4%B9%A0/go%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2023-09-02%2011.05.21.jpg">
<meta property="og:image" content="http://example.com/2025/01/01/go%E5%AD%A6%E4%B9%A0/go%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2023-09-02%2016.06.40.jpg">
<meta property="og:image" content="http://example.com/2025/01/01/go%E5%AD%A6%E4%B9%A0/go%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2023-09-04%2011.22.22.jpg">
<meta property="og:image" content="http://example.com/2025/01/01/go%E5%AD%A6%E4%B9%A0/go%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2023-09-06%2010.55.26.jpg">
<meta property="og:image" content="http://example.com/2025/01/01/go%E5%AD%A6%E4%B9%A0/go%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2023-09-06%2011.12.39.jpg">
<meta property="og:image" content="http://example.com/2025/01/01/go%E5%AD%A6%E4%B9%A0/go%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2023-09-07%2010.34.18.jpg">
<meta property="og:image" content="http://example.com/2025/01/01/go%E5%AD%A6%E4%B9%A0/go%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2023-09-07%2022.14.58.jpg">
<meta property="og:image" content="http://example.com/2025/01/01/go%E5%AD%A6%E4%B9%A0/go%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2023-09-09%2010.41.22.jpg">
<meta property="og:image" content="http://example.com/2025/01/01/go%E5%AD%A6%E4%B9%A0/go%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2023-09-09%2010.43.02.jpg">
<meta property="og:image" content="http://example.com/2025/01/01/go%E5%AD%A6%E4%B9%A0/go%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2023-09-09%2010.44.42.jpg">
<meta property="og:image" content="http://example.com/2025/01/01/go%E5%AD%A6%E4%B9%A0/go%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2023-09-10%2011.29.05.jpg">
<meta property="og:image" content="http://example.com/2025/01/01/go%E5%AD%A6%E4%B9%A0/go%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2023-09-10%2012.27.40.jpg">
<meta property="og:image" content="http://example.com/2025/01/01/go%E5%AD%A6%E4%B9%A0/go%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2023-09-18%2010.44.04.jpg">
<meta property="og:image" content="http://example.com/2025/01/01/go%E5%AD%A6%E4%B9%A0/go%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2023-09-19%2011.15.44.jpg">
<meta property="article:published_time" content="2025-01-01T14:16:15.000Z">
<meta property="article:modified_time" content="2025-01-01T14:08:55.016Z">
<meta property="article:author" content="陈宇韶chenyushao">
<meta property="article:tag" content="go">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2025/01/01/go%E5%AD%A6%E4%B9%A0/go%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2023-08-22%2011.06.34.jpg">


<link rel="canonical" href="http://example.com/2025/01/01/go%E5%AD%A6%E4%B9%A0/go%E7%AC%94%E8%AE%B0/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://example.com/2025/01/01/go%E5%AD%A6%E4%B9%A0/go%E7%AC%94%E8%AE%B0/","path":"2025/01/01/go学习/go笔记/","title":"go笔记"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>go笔记 | Tiger_pop's Blog</title>
  






  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="Tiger_pop's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Tiger_pop's Blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">tiger_pop 的博客</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%89%E8%A3%85"><span class="nav-number">1.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9D%82%E9%B1%BC%E7%AC%94%E8%AE%B0"><span class="nav-number">2.</span> <span class="nav-text">杂鱼笔记</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8C%87%E9%92%88"><span class="nav-number">3.</span> <span class="nav-text">指针</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%A0%87%E8%AF%86%E7%AC%A6"><span class="nav-number">4.</span> <span class="nav-text">标识符</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%88%86%E6%94%AF%E7%BB%93%E6%9E%84"><span class="nav-number">5.</span> <span class="nav-text">分支结构</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%87%BD%E6%95%B0"><span class="nav-number">6.</span> <span class="nav-text">函数</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8C%85"><span class="nav-number">7.</span> <span class="nav-text">包</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8C%BF%E5%90%8D%E5%87%BD%E6%95%B0"><span class="nav-number">8.</span> <span class="nav-text">匿名函数</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%97%AD%E5%8C%85"><span class="nav-number">9.</span> <span class="nav-text">闭包</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#defer"><span class="nav-number">10.</span> <span class="nav-text">defer</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-number">11.</span> <span class="nav-text">字符串</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#new"><span class="nav-number">12.</span> <span class="nav-text">new</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7"><span class="nav-number">13.</span> <span class="nav-text">异常捕获</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%95%B0%E7%BB%84"><span class="nav-number">14.</span> <span class="nav-text">数组</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%88%87%E7%89%87"><span class="nav-number">15.</span> <span class="nav-text">切片</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#make"><span class="nav-number">15.1.</span> <span class="nav-text">make</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#map"><span class="nav-number">16.</span> <span class="nav-text">map</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#go%E7%9A%84%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1"><span class="nav-number">17.</span> <span class="nav-text">go的面向对象</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%93%E6%9E%84%E4%BD%93"><span class="nav-number">17.1.</span> <span class="nav-text">结构体</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%96%B9%E6%B3%95"><span class="nav-number">18.</span> <span class="nav-text">方法</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B0%81%E8%A3%85"><span class="nav-number">19.</span> <span class="nav-text">封装</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BB%A7%E6%89%BF"><span class="nav-number">20.</span> <span class="nav-text">继承</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8E%A5%E5%8F%A3%EF%BC%88%E5%80%9F%E5%B0%B8%E8%BF%98%E9%AD%82%EF%BC%89"><span class="nav-number">21.</span> <span class="nav-text">接口（借尸还魂）</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%A4%9A%E6%80%81"><span class="nav-number">22.</span> <span class="nav-text">多态</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%96%AD%E8%A8%80"><span class="nav-number">23.</span> <span class="nav-text">断言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%96%87%E4%BB%B6"><span class="nav-number">24.</span> <span class="nav-text">文件</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%BF%9B%E7%A8%8B%E3%80%81%E7%BA%BF%E7%A8%8B%E3%80%81%E5%8D%8F%E7%A8%8B%E3%80%81%E7%AE%A1%E9%81%93"><span class="nav-number">25.</span> <span class="nav-text">进程、线程、协程、管道</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%A1%E9%81%93"><span class="nav-number">25.1.</span> <span class="nav-text">管道</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#select"><span class="nav-number">25.2.</span> <span class="nav-text">select</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C"><span class="nav-number">26.</span> <span class="nav-text">网络</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BC%A0%E8%BE%93%E5%B1%82%EF%BC%9ATCP-%E5%8D%8F%E8%AE%AE%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%EF%BC%8C%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B"><span class="nav-number">26.1.</span> <span class="nav-text">传输层：TCP 协议三次握手，四次挥手</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BC%A0%E8%BE%93%E5%B1%82%EF%BC%9AUDP-%E5%8D%8F%E8%AE%AE%EF%BC%88%E4%B8%8D%E5%8F%AF%E9%9D%A0%EF%BC%89"><span class="nav-number">26.2.</span> <span class="nav-text">传输层：UDP 协议（不可靠）</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%8D%E5%B0%84"><span class="nav-number">27.</span> <span class="nav-text">反射</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8D%8F%E7%A8%8B%E7%AE%A1%E9%81%93%E7%BB%83%E4%B9%A0"><span class="nav-number">28.</span> <span class="nav-text">协程管道练习</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#label-%E5%92%8C-select-%E7%AE%A1%E9%81%93"><span class="nav-number">28.1.</span> <span class="nav-text">label 和 select 管道</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%A1%E9%81%93%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E5%BA%94%E7%94%A8"><span class="nav-number">28.2.</span> <span class="nav-text">管道定时任务应用</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="陈宇韶chenyushao"
      src="/images/my.jpg">
  <p class="site-author-name" itemprop="name">陈宇韶chenyushao</p>
  <div class="site-description" itemprop="description">爱学习、爱工作、爱生活;         微信号: Tiger_and_master;         手机号码:18515678348 </div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">427</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">26</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">201</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/01/01/go%E5%AD%A6%E4%B9%A0/go%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/my.jpg">
      <meta itemprop="name" content="陈宇韶chenyushao">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tiger_pop's Blog">
      <meta itemprop="description" content="爱学习、爱工作、爱生活;         微信号: Tiger_and_master;         手机号码:18515678348 ">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="go笔记 | Tiger_pop's Blog">
      <meta itemprop="description" content="这是文章开头，显示在主页面，详情请点击此处。">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          go笔记
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-01-01 22:16:15 / 修改时间：22:08:55" itemprop="dateCreated datePublished" datetime="2025-01-01T22:16:15+08:00">2025-01-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/go%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">go笔记</span></a>
        </span>
    </span>

  
</div>

            <div class="post-description">这是文章开头，显示在主页面，详情请点击此处。</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>简介 <span id="more"></span></p>
<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p>1、注意 环境变量中 GOPATH； GOROOT的配置。</p>
<p>2、还要 注意 是 模块模式还是 gopath模式。</p>
<p>3、用vscode编辑器时一定要记得在编辑器中 指定gopath的路径，不然会找不到。</p>
<h1 id="杂鱼笔记"><a href="#杂鱼笔记" class="headerlink" title="杂鱼笔记"></a>杂鱼笔记</h1><p>1、go 一个方法内重复定义 变量非法；</p>
<p>2、go 没有隐式类型转换，变量声明和赋值要一致；</p>
<p>3、go 声明变量 有个默认值；</p>
<p>4、go有类型推断；</p>
<p>5、 用vscode时，注意 go 代码规范是 冗余非法，一定要先在代码块中用到了 某个 库，再写 import，不然直接保存会导致 编辑器 把 冗余import 库直接当写错了删除。</p>
<p>6、uint8 这样的无符号 整型 范围是 2^7 + 2^7-1 &#x3D; 0<del>255 , 整数部分是 int8 -128</del>127的两倍。</p>
<p>7、go 用反引号 &#96;&#96; 输出带特殊符号的原始字符串.</p>
<p>8、go 的 string 转其它类型一定要保证 能够转，不然会按照 目标类型的默认值来 赋值；</p>
<h1 id="指针"><a href="#指针" class="headerlink" title="指针"></a>指针</h1><p>0、指针概念；</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> age <span class="type">int</span> = <span class="number">18</span></span><br><span class="line">	fmt.Println(&amp;age) <span class="comment">//变量内存地址</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> ptr *<span class="type">int</span> = &amp;age <span class="comment">// 可以理解为 一个 指向 int类型的指针类型，里面放的是 指向 int类型 的地址；</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;ptr存储空间的地址为：&quot;</span>, &amp;ptr) <span class="comment">//获取指针本身的内存地址；</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;ptr指向的数值为：&quot;</span>, *ptr) <span class="comment">//获取指针指向的值。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1、可以通过指针来改变指向值；</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> age <span class="type">int</span> = <span class="number">18</span></span><br><span class="line">	<span class="keyword">var</span> ptr *<span class="type">int</span> = &amp;age</span><br><span class="line">	*ptr = <span class="number">20</span></span><br><span class="line">	fmt.Println(age)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、指针变量接收的一定是地址值；</p>
<p>3、指针变量的定义一定要和实际值匹配，例如 *float 类型的指针 就不能和 &amp;num num 是一个 int8 类型的变量地址匹配；</p>
<h1 id="标识符"><a href="#标识符" class="headerlink" title="标识符"></a>标识符</h1><p>‘_’ 只能被当作忽略的标识符，不能单独当作标识符使用。</p>
<p>1、main包 是一个程序的入口包，main函数所在的包，建议定义为main包；</p>
<p>2、<strong>变量名、函数名、常量 首字母大写，则可以被其它包访问，首字母小写则只能本包中使用；</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1、go 默认的模式不是 模块模式，模块模式能 跳出gopath 的影响，但是默认用gopath模式；</span></span><br><span class="line">export GO111MODULE=off </span><br><span class="line"><span class="comment">//2、gopath模式中，包都是从$GOPATH/src 路径后开始计算的，import 后面写相对路径即可；</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;goproject/demo_package/test&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(test.StuNo)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//3、用vscode编辑器时一定要记得在编辑器中 指定gopath的路径，不然会找不到；</span></span><br></pre></td></tr></table></figure>

<p>3、go语言获取控制台输入的 时候，scanln、scanf 传入的是待修改 值的地址 如 <code>&amp;age</code>. </p>
<h1 id="分支结构"><a href="#分支结构" class="headerlink" title="分支结构"></a>分支结构</h1><p>​		go 的 switch case 中 加上 fallthrough 会带来 一层的穿透。</p>
<p>​		goto 到某个标签的 语句最好少用，因为可能导致 逻辑混乱。</p>
<h1 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h1><p>go不支持 函数重载（同一函数 不同形参）</p>
<p>利用指针，实现一个函数内改变函数外的值</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> str <span class="type">string</span> = <span class="string">&quot;abcdefg&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 模拟在一个函数中改变外面的值，利用指针。</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fun</span><span class="params">(args ...*<span class="type">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="keyword">range</span> args &#123;</span><br><span class="line">		*args[i] = <span class="number">30</span></span><br><span class="line">		fmt.Print(<span class="string">&quot;fun=====&quot;</span>, *args[i])</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> age <span class="type">int</span> = <span class="number">10</span></span><br><span class="line">	fun(&amp;age)</span><br><span class="line">	fmt.Print(<span class="string">&quot;main----- &quot;</span>, age)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>函数直接当形参</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fun</span><span class="params">(num <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">	fmt.Println(num)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 把函数当形参</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">(num1 <span class="type">int</span>, num2 <span class="type">float32</span>, testFunc <span class="keyword">func</span>(<span class="type">int</span>)</span></span>) &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;---test&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// var age int = 10</span></span><br><span class="line">	<span class="comment">// fun(&amp;age)</span></span><br><span class="line">	a := fun</span><br><span class="line">	<span class="comment">// fmt.Printf(&quot;main----- %T,%T\n&quot;, a, fun)</span></span><br><span class="line">	<span class="comment">// a(10)</span></span><br><span class="line">	test(<span class="number">1</span>, <span class="number">3.14</span>, a)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>go支持自定义类型</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> myFunc <span class="function"><span class="keyword">func</span><span class="params">(<span class="type">int</span>)</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test01</span><span class="params">(num1 <span class="type">int</span>, num2 <span class="type">float64</span>, testFunc myFunc)</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;---test01&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>go支持对函数返回值命名</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test02</span><span class="params">(num1 <span class="type">int</span>, num2 <span class="type">int</span>)</span></span> (sum <span class="type">int</span>, sub <span class="type">int</span>) &#123;</span><br><span class="line">	sum = num1 + num2 <span class="comment">//sum := num1 + num2由于这两个变量已经在函数签名中声明，你不能再使用短变量声明方式对它们进行赋值。</span></span><br><span class="line">	sub = num1 - num2</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// var age int = 10</span></span><br><span class="line">	<span class="comment">// fun(&amp;age)</span></span><br><span class="line">	a := fun</span><br><span class="line">	<span class="comment">// fmt.Printf(&quot;main----- %T,%T\n&quot;, a, fun)</span></span><br><span class="line">	<span class="comment">// a(10)</span></span><br><span class="line">	test(<span class="number">1</span>, <span class="number">3.14</span>, a)</span><br><span class="line">	test(<span class="number">10</span>, <span class="number">3.14</span>, fun)</span><br><span class="line">	test01(<span class="number">10</span>, <span class="number">3.14</span>, a)</span><br><span class="line">	sub, sum := test02(<span class="number">10</span>, <span class="number">6</span>)</span><br><span class="line">	fmt.Println(sub, sum)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="包"><a href="#包" class="headerlink" title="包"></a>包</h1><p>​		包是一个抽象概念，需要用 package 来声明一下。 导包，import 其实是导入 package 声明包文件所在的文件夹路径。</p>
<p>​		导入另一个包的操作是import 从 gopath 的src 下的路径开始算的，并且只有首字母大写的方法才能被别的包访问。</p>
<p>​		建议1\ package 进行包的声明，建议 声明的包和所在的文件夹同名；建议2\ main包是程序的入口包，一般main函数放在这个包下。</p>
<p>​		是哪一个包 ，要看 package 声明 叫什么名字，包就是什么名字，main函数一定要放在main包下。</p>
<p>​		<strong>一个目录下不能有重复的函数</strong></p>
<p>​		同级别源文件的包的声明，必须一致！也就是说一个包其实对应一个文件夹。</p>
<p>​		<img src="/2025/01/01/go%E5%AD%A6%E4%B9%A0/go%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2023-08-22%2011.06.34.jpg" alt="截屏2023-08-22 11.06.34"></p>
<p><img src="/2025/01/01/go%E5%AD%A6%E4%B9%A0/go%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2023-08-22%2011.12.42.jpg" alt="截屏2023-08-22 11.12.42"></p>
<h1 id="匿名函数"><a href="#匿名函数" class="headerlink" title="匿名函数"></a>匿名函数</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 全局变量形式的匿名函数</span></span><br><span class="line"><span class="keyword">var</span> Fanc = <span class="function"><span class="keyword">func</span><span class="params">(num1 <span class="type">int</span>, num2 <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> num1 * num2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">//匿名函数，定义同时调用</span></span><br><span class="line">	result := <span class="function"><span class="keyword">func</span><span class="params">(num1 <span class="type">int</span>, num2 <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> num1 + num2</span><br><span class="line">	&#125;(<span class="number">10</span>, <span class="number">20</span>)</span><br><span class="line">	<span class="comment">//匿名函数</span></span><br><span class="line">	sub := <span class="function"><span class="keyword">func</span><span class="params">(num1 <span class="type">int</span>, num2 <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> num1 - num2</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println(result)</span><br><span class="line">	fmt.Println(sub(<span class="number">20</span>, <span class="number">10</span>))</span><br><span class="line">	fmt.Println(Fanc(<span class="number">2</span>, <span class="number">3</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 闭包 ，由返回的匿名函数和匿名函数以外的变量组成。</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getSum</span><span class="params">()</span></span> <span class="function"><span class="keyword">func</span><span class="params">(<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	<span class="keyword">var</span> sum <span class="type">int</span> = <span class="number">0</span></span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(num1 <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">		sum = sum + num1</span><br><span class="line">		<span class="keyword">return</span> sum</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	f := getSum()</span><br><span class="line">	fmt.Println(f(<span class="number">1</span>))</span><br><span class="line">	fmt.Println(f(<span class="number">2</span>))</span><br><span class="line">	fmt.Println(f(<span class="number">3</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="defer"><a href="#defer" class="headerlink" title="defer"></a>defer</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	result := add(<span class="number">100</span>, <span class="number">200</span>)</span><br><span class="line">	fmt.Println(result)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(num1 <span class="type">int</span>, num2 <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	<span class="comment">// defer 后面的内容会被压入一个栈中，直到本函数运行完才会运行</span></span><br><span class="line">	<span class="comment">// 由于是压入栈，先进后出。</span></span><br><span class="line">	<span class="comment">// defer语句一般用于 go语言在运行某段代码后释放资源。</span></span><br><span class="line">	<span class="keyword">defer</span> fmt.Println(<span class="string">&quot;num1=&quot;</span>, num1)</span><br><span class="line">	<span class="keyword">defer</span> fmt.Println(<span class="string">&quot;num2=&quot;</span>, num2)</span><br><span class="line">	num1 += <span class="number">10</span></span><br><span class="line">	num2 += <span class="number">20</span></span><br><span class="line">	<span class="keyword">var</span> sum <span class="type">int</span> = num1 + num2</span><br><span class="line">	fmt.Println(sum)</span><br><span class="line">	<span class="keyword">return</span> sum</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;strconv&quot;</span></span><br><span class="line">	<span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// utf-8 一个汉字3个字节</span></span><br><span class="line">	str := <span class="string">&quot;golang你好&quot;</span></span><br><span class="line">	fmt.Println(<span class="built_in">len</span>(str))</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 遍历字符串</span></span><br><span class="line">	<span class="keyword">for</span> i, value := <span class="keyword">range</span> str &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;索引为：%d,值为: %c\n&quot;</span>, i, value)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 遍历字符串 2</span></span><br><span class="line">	r := []<span class="type">rune</span>(str)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(r); i++ &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;%c \n&quot;</span>, r[i])</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//字符串转整数</span></span><br><span class="line">	num1, _ := strconv.Atoi(<span class="string">&quot;888&quot;</span>)</span><br><span class="line">	fmt.Println(num1)</span><br><span class="line">	<span class="comment">//整数转字符串</span></span><br><span class="line">	str1 := strconv.Itoa(<span class="number">88</span>)</span><br><span class="line">	fmt.Println(str1)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//统计子串数量</span></span><br><span class="line">	count := strings.Count(<span class="string">&quot;golangisbestonegolang&quot;</span>, <span class="string">&quot;go&quot;</span>)</span><br><span class="line">	fmt.Println(count)</span><br><span class="line">	<span class="comment">//找子串索引</span></span><br><span class="line">	fmt.Println(strings.Index(<span class="string">&quot;golangisbestonegolang&quot;</span>, <span class="string">&quot;go&quot;</span>))</span><br><span class="line">	<span class="comment">//字符串的替换</span></span><br><span class="line">	str2 := strings.Replace(<span class="string">&quot;golangisbest&quot;</span>, <span class="string">&quot;golang&quot;</span>, <span class="string">&quot;python&quot;</span>, <span class="number">-1</span>)</span><br><span class="line">	str3 := strings.Replace(<span class="string">&quot;golangisbest&quot;</span>, <span class="string">&quot;g&quot;</span>, <span class="string">&quot;python&quot;</span>, <span class="number">2</span>)</span><br><span class="line">	fmt.Println(str2)</span><br><span class="line">	fmt.Println(str3)</span><br><span class="line">	<span class="comment">//切割</span></span><br><span class="line">	arr := strings.Split(<span class="string">&quot;go-python-java&quot;</span>, <span class="string">&quot;-&quot;</span>)</span><br><span class="line">	fmt.Println(arr)</span><br><span class="line">	<span class="comment">// 大小写</span></span><br><span class="line">	fmt.Println(strings.ToLower(<span class="string">&quot;ABC&quot;</span>))</span><br><span class="line">	fmt.Println(strings.ToUpper(<span class="string">&quot;AbC&quot;</span>))</span><br><span class="line">	<span class="comment">// 去除左右两边。</span></span><br><span class="line">	fmt.Println(strings.TrimSpace(<span class="string">&quot; go and java &quot;</span>))</span><br><span class="line">	fmt.Println(strings.Trim(<span class="string">&quot;~go and java~&quot;</span>, <span class="string">&quot;~&quot;</span>))</span><br><span class="line">	<span class="comment">// 判断开头</span></span><br><span class="line">	fmt.Println(strings.HasPrefix(<span class="string">&quot;http://baidu.com&quot;</span>, <span class="string">&quot;http&quot;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="new"><a href="#new" class="headerlink" title="new"></a>new</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// new 分配内存，new返回值时一个对应类型的指针。</span></span><br><span class="line">num := <span class="built_in">new</span>(<span class="type">int</span>)</span><br><span class="line">fmt.Printf(<span class="string">&quot;num type is:%T,num value is:%v,num index is:%v,num指针指向的值是：%v&quot;</span>,</span><br><span class="line">	num, num, &amp;num, *num)</span><br></pre></td></tr></table></figure>

<h1 id="异常捕获"><a href="#异常捕获" class="headerlink" title="异常捕获"></a>异常捕获</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;errors&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	test()</span><br><span class="line">	fmt.Println(<span class="string">&quot;上面执行成功&quot;</span>)</span><br><span class="line">	fmt.Println(<span class="string">&quot;开始执行下面的逻辑&quot;</span>)</span><br><span class="line">	err := test2()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;自定义错误：&quot;</span>, err)</span><br><span class="line">		<span class="built_in">panic</span>(err) <span class="comment">//panic 输出 参数后就不再向下执行了。</span></span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">&quot;test2上面执行成功&quot;</span>)</span><br><span class="line">	fmt.Println(<span class="string">&quot;test2开始执行下面的逻辑&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 利用 defer 和 recover 来捕获异常(实际上是调用一个匿名函数)。</span></span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="comment">//调用 revover 内置函数</span></span><br><span class="line">		err := <span class="built_in">recover</span>()</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			fmt.Println(<span class="string">&quot;异常被捕获&quot;</span>)</span><br><span class="line">			fmt.Println(<span class="string">&quot;err 是:&quot;</span>, err)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line">	num1 := <span class="number">10</span></span><br><span class="line">	num2 := <span class="number">0</span></span><br><span class="line">	result := num1 / num2</span><br><span class="line">	fmt.Println(result)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test2</span><span class="params">()</span></span> (err <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="comment">//自定义异常</span></span><br><span class="line">	num1 := <span class="number">10</span></span><br><span class="line">	num2 := <span class="number">0</span></span><br><span class="line">	<span class="keyword">if</span> num2 == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> errors.New(<span class="string">&quot;除数不能为0&quot;</span>)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		result := num1 / num2</span><br><span class="line">		fmt.Println(result)</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h1><p>定义好的指针，默认值都是0；</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> scores [<span class="number">3</span>]<span class="type">int</span> <span class="comment">// go 这样定义数组。</span></span><br><span class="line">	<span class="comment">/* 	scores[0] = 95</span></span><br><span class="line"><span class="comment">	   	scores[1] = 99</span></span><br><span class="line"><span class="comment">	   	scores[2] = 94 */</span></span><br><span class="line">	<span class="keyword">var</span> sum <span class="type">int</span> = <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(scores); i++ &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;please enter %d_th score\n&quot;</span>, i+<span class="number">1</span>)</span><br><span class="line">		fmt.Scanln(&amp;scores[i]) <span class="comment">// 获取输入,对对应地址的值进行修改。</span></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(scores); i++ &#123;</span><br><span class="line">		sum += scores[i]</span><br><span class="line">	&#125;</span><br><span class="line">	avg := sum / <span class="built_in">len</span>(scores)</span><br><span class="line">	fmt.Println(sum, avg)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2025/01/01/go%E5%AD%A6%E4%B9%A0/go%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2023-08-25%2011.06.51.jpg" alt="截屏2023-08-25 11.06.51"></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> scores [<span class="number">3</span>]<span class="type">int</span> = [<span class="number">3</span>]<span class="type">int</span>&#123;<span class="number">1</span>, <span class="number">3</span>, <span class="number">9</span>&#125;</span><br><span class="line"><span class="keyword">var</span> scores = [<span class="number">3</span>]<span class="type">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line"><span class="keyword">var</span> scores = [...]<span class="type">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line"><span class="keyword">var</span> scores = [...]<span class="type">int</span>&#123;<span class="number">0</span>: <span class="number">99</span>, <span class="number">2</span>: <span class="number">100</span>, <span class="number">1</span>: <span class="number">1</span>&#125;</span><br></pre></td></tr></table></figure>

<p>go 语言中的数组默认是值传递，和python等语言不一样，但是可以通过改变参数为指针，实现和python等语言一样的参数传递；</p>
<p><img src="/2025/01/01/go%E5%AD%A6%E4%B9%A0/go%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2023-08-25%2016.05.21.jpg" alt="截屏2023-08-25 16.05.21"></p>
<p><img src="/2025/01/01/go%E5%AD%A6%E4%B9%A0/go%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2023-08-25%2016.05.40.jpg" alt="截屏2023-08-25 16.05.40"></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> arr1 = [<span class="number">3</span>]<span class="type">int</span>&#123;<span class="number">3</span>, <span class="number">6</span>, <span class="number">9</span>&#125;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;1类型是 %T\n&quot;</span>, arr1) <span class="comment">//1类型是 [3]int</span></span><br><span class="line">	<span class="keyword">var</span> arr2 = [<span class="number">6</span>]<span class="type">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>&#125;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;2类型是 %T\n&quot;</span>, arr2) <span class="comment">//2类型是 [6]int</span></span><br><span class="line">	test(arr1)</span><br><span class="line">	fmt.Println(arr1) <span class="comment">//可见 arr1 的一号位置的值没有被test方法改变；</span></span><br><span class="line">	<span class="comment">// 注意，go和python等语言不通，数组的传递默认是值传递，</span></span><br><span class="line">	<span class="comment">// 而不是地址传递(引用传递)；</span></span><br><span class="line"></span><br><span class="line">	test2(&amp;arr1)</span><br><span class="line">	fmt.Println(arr1)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">(arr [3]<span class="type">int</span>)</span></span> &#123;</span><br><span class="line">	arr[<span class="number">0</span>] = <span class="number">100</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 把函数的参数改为指针，实现和python等语言一样的 数组 地址传递。</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test2</span><span class="params">(arr *[3]<span class="type">int</span>)</span></span> &#123;</span><br><span class="line">	(*arr)[<span class="number">0</span>] = <span class="number">200</span> <span class="comment">// 需要先对 arr指针找到它对应的值，再按照第几个值去改变。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="切片"><a href="#切片" class="headerlink" title="切片"></a>切片</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> intarr = [<span class="number">6</span>]<span class="type">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>&#125;</span><br><span class="line">	<span class="keyword">var</span> slice []<span class="type">int</span> = intarr[:<span class="number">3</span>]</span><br><span class="line">	fmt.Println(slice)</span><br><span class="line">	fmt.Println(<span class="string">&quot;容量is：&quot;</span>, <span class="built_in">cap</span>(slice))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2025/01/01/go%E5%AD%A6%E4%B9%A0/go%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2023-08-25%2016.24.25.jpg" alt="截屏2023-08-25 16.24.25"></p>
<p>注意切片并不是数组，而是一个单独的结构体；</p>
<p>由于 切片 存的是数组的地址，所以改变切片的值，原本数组的值也会跟着变；</p>
<h2 id="make"><a href="#make" class="headerlink" title="make"></a>make</h2><p>用 <strong>make</strong>  方法创建一个切片；</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// make 底层也是创建一个数组，对外不可见，不可以直接操作此数组，只能通过slice间接访问；</span></span><br><span class="line">	slice := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">3</span>, <span class="number">20</span>) <span class="comment">// 切片的类型，长度，容量。</span></span><br><span class="line">	fmt.Println(slice)</span><br><span class="line">	fmt.Println(<span class="string">&quot;len is &quot;</span>, <span class="built_in">len</span>(slice))</span><br><span class="line">	slice[<span class="number">1</span>] = <span class="number">666</span></span><br><span class="line">	fmt.Println(slice)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>切片注意事项</p>
<p>【1】切片不用直接使用，需要引用一个数组 或者make提供一个空间供切片使用；</p>
<p>【2】切片可以继续切片；</p>
<p>【3】切片可以动态增长。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> intarr [<span class="number">3</span>]<span class="type">int</span> = [<span class="number">3</span>]<span class="type">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line">	slice := intarr[<span class="number">1</span>:]</span><br><span class="line">	fmt.Println(slice)</span><br><span class="line">	<span class="comment">// append 会新建一个数组，copy老数组的内容，在新数组上修改；</span></span><br><span class="line">	slice2 := <span class="built_in">append</span>(slice, <span class="number">88</span>, <span class="number">99</span>, <span class="number">100</span>) <span class="comment">//追加三个元素</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;slice2 is :&quot;</span>, slice2)</span><br><span class="line">	fmt.Println(<span class="string">&quot;slice is :&quot;</span>, slice)</span><br><span class="line">	<span class="comment">//如果想要对原始数组进行修改，只能通过重新赋值；</span></span><br><span class="line">	slice = <span class="built_in">append</span>(slice, <span class="number">111</span>, <span class="number">222</span>, <span class="number">333</span>)</span><br><span class="line">	fmt.Println(slice)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> a []<span class="type">int</span> = []<span class="type">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line">	<span class="keyword">var</span> b []<span class="type">int</span> = <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">10</span>)</span><br><span class="line">	<span class="comment">//拷贝a到b</span></span><br><span class="line">	<span class="built_in">copy</span>(b, a)</span><br><span class="line">	fmt.Println(b)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="map"><a href="#map" class="headerlink" title="map"></a>map</h1><p>就是python中的dict</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> a <span class="keyword">map</span>[<span class="type">int</span>]<span class="type">string</span>         <span class="comment">//定义map变量</span></span><br><span class="line">	a = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">int</span>]<span class="type">string</span>, <span class="number">10</span>) <span class="comment">//通过make初始化，不在make中指定size就默认只有一个键值对。</span></span><br><span class="line">	a[<span class="number">123929</span>] = <span class="string">&quot;张三&quot;</span></span><br><span class="line">	a[<span class="number">2234234</span>] = <span class="string">&quot;李四&quot;</span></span><br><span class="line">	fmt.Println(a)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> a <span class="keyword">map</span>[<span class="type">int</span>]<span class="type">string</span> <span class="comment">//定义map变量</span></span><br><span class="line">	<span class="comment">//通过make初始化，不在make中指定size就默认只有一个键值对，但是可以赋值时自动扩充。</span></span><br><span class="line">	a = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">int</span>]<span class="type">string</span>, <span class="number">10</span>)</span><br><span class="line">	a[<span class="number">123929</span>] = <span class="string">&quot;张三&quot;</span></span><br><span class="line">	a[<span class="number">2234234</span>] = <span class="string">&quot;李四&quot;</span></span><br><span class="line">	fmt.Println(a)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 方式2</span></span><br><span class="line">	b := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">int</span>]<span class="type">string</span>)</span><br><span class="line">	b[<span class="number">123123</span>] = <span class="string">&quot;zhansan&quot;</span></span><br><span class="line">	b[<span class="number">32143222</span>] = <span class="string">&quot;liudehua&quot;</span></span><br><span class="line">	b[<span class="number">1231234</span>] = <span class="string">&quot;zhouxinchi&quot;</span></span><br><span class="line">	fmt.Println(b)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 方式3</span></span><br><span class="line">	c := <span class="keyword">map</span>[<span class="type">int</span>]<span class="type">string</span>&#123;</span><br><span class="line">		<span class="number">200200</span>: <span class="string">&quot;张三&quot;</span>,</span><br><span class="line">		<span class="number">899898</span>: <span class="string">&quot;王五&quot;</span>,</span><br><span class="line">	&#125;</span><br><span class="line">	c[<span class="number">123982</span>] = <span class="string">&quot;刘德华&quot;</span></span><br><span class="line">	fmt.Println(c)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//删除(go没有清空，只能遍历删除实现清空，或者make一个新的作它，原来的成为垃圾被回收。)</span></span><br><span class="line">	<span class="built_in">delete</span>(c, <span class="number">200200</span>)</span><br><span class="line">	fmt.Println(c)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//查找</span></span><br><span class="line">	value, flag := b[<span class="number">123123</span>] <span class="comment">//flag 为true or false看找没找到。</span></span><br><span class="line">	fmt.Println(value, flag)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> k, v := <span class="keyword">range</span> a &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;key is :%v, value is :%v \n&quot;</span>, k, v)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	a := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">map</span>[<span class="type">int</span>]<span class="type">string</span>)</span><br><span class="line">	<span class="comment">//赋值</span></span><br><span class="line">	a[<span class="string">&quot;class1&quot;</span>] = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">int</span>]<span class="type">string</span>)</span><br><span class="line">	a[<span class="string">&quot;class1&quot;</span>][<span class="number">200</span>] = <span class="string">&quot;小王&quot;</span></span><br><span class="line">	a[<span class="string">&quot;class1&quot;</span>][<span class="number">300</span>] = <span class="string">&quot;小红&quot;</span></span><br><span class="line"></span><br><span class="line">	a[<span class="string">&quot;class2&quot;</span>] = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">int</span>]<span class="type">string</span>)</span><br><span class="line">	a[<span class="string">&quot;class2&quot;</span>][<span class="number">100</span>] = <span class="string">&quot;李辉&quot;</span></span><br><span class="line">	a[<span class="string">&quot;class2&quot;</span>][<span class="number">200</span>] = <span class="string">&quot;小宁&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> k, v := <span class="keyword">range</span> a &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;班级是:&quot;</span>, k)</span><br><span class="line">		<span class="keyword">for</span> k1, v1 := <span class="keyword">range</span> v &#123;</span><br><span class="line">			fmt.Printf(<span class="string">&quot;学生学号是：%v,学生姓名是：%v\n&quot;</span>, k1, v1)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="go的面向对象"><a href="#go的面向对象" class="headerlink" title="go的面向对象"></a>go的面向对象</h1><p>go 不用类，用结构体。</p>
<h2 id="结构体"><a href="#结构体" class="headerlink" title="结构体"></a>结构体</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义目标结构体</span></span><br><span class="line"><span class="keyword">type</span> Teacher <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name   <span class="type">string</span></span><br><span class="line">	Age    <span class="type">int</span></span><br><span class="line">	School <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 创建老师结构体的实例、对象、变量。</span></span><br><span class="line">	<span class="keyword">var</span> ma Teacher  <span class="comment">// 有点像变量的定义</span></span><br><span class="line">	fmt.Println(ma) <span class="comment">// 在未赋值时 默认是 &#123; 0 &#125; ,每个属性有初始值。</span></span><br><span class="line">	ma.Name = <span class="string">&quot;马云&quot;</span></span><br><span class="line">	ma.Age = <span class="number">59</span></span><br><span class="line">	ma.School = <span class="string">&quot;杭州师范&quot;</span></span><br><span class="line">	fmt.Println(ma)</span><br><span class="line">	fmt.Println(ma.Age + <span class="number">10</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义目标结构体</span></span><br><span class="line"><span class="keyword">type</span> Teacher <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name   <span class="type">string</span></span><br><span class="line">	Age    <span class="type">int</span></span><br><span class="line">	School <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 第二种方法 创建老师结构体的实例、对象、变量。</span></span><br><span class="line">	<span class="keyword">var</span> ma Teacher = Teacher&#123;<span class="string">&quot;赵云&quot;</span>, <span class="number">25</span>, <span class="string">&quot;白马义从&quot;</span>&#125;</span><br><span class="line">	fmt.Println(ma)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义目标结构体</span></span><br><span class="line"><span class="keyword">type</span> Teacher <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name   <span class="type">string</span></span><br><span class="line">	Age    <span class="type">int</span></span><br><span class="line">	School <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 第三种方法 创建老师结构体的实例、对象、变量。</span></span><br><span class="line">	<span class="comment">// 通过new 一个结构体指针的方式。</span></span><br><span class="line">	<span class="keyword">var</span> t *Teacher = <span class="built_in">new</span>(Teacher)</span><br><span class="line">	(*t).Age = <span class="number">100</span></span><br><span class="line">	(*t).Name = <span class="string">&quot;好人&quot;</span></span><br><span class="line">	fmt.Println(*t)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// go 为了简化 写法，可以用一下方法赋值，但是实际上底层还是上面的指针方法。</span></span><br><span class="line">	t.Name = <span class="string">&quot;坏人&quot;</span></span><br><span class="line">	t.Age = <span class="number">95</span></span><br><span class="line">	fmt.Println(*t)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义目标结构体</span></span><br><span class="line"><span class="keyword">type</span> Teacher <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name   <span class="type">string</span></span><br><span class="line">	Age    <span class="type">int</span></span><br><span class="line">	School <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> t *Teacher = &amp;Teacher&#123;&#125;</span><br><span class="line">	<span class="comment">//var t *Teacher = &amp;Teacher&#123;&quot;赵云&quot;,25,&quot;白马义从&quot;&#125;</span></span><br><span class="line">	(*t).Name = <span class="string">&quot;赵云&quot;</span></span><br><span class="line">	(*t).Age = <span class="number">25</span></span><br><span class="line">	t.School = <span class="string">&quot;白马义从&quot;</span></span><br><span class="line">	fmt.Println(*t)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 结构体 和其它类型进行转换，需要有完全相同的字段。（名字，个数，类型）</span></span><br><span class="line"><span class="keyword">type</span> Teacher <span class="keyword">struct</span> &#123;</span><br><span class="line">	Age <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> Tea Teacher</span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">	Age <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> t Teacher = Teacher&#123;<span class="number">10</span>&#125;</span><br><span class="line">	<span class="keyword">var</span> p Person = Person&#123;<span class="number">10</span>&#125;</span><br><span class="line">	t = Teacher(p)</span><br><span class="line">	fmt.Println(t)</span><br><span class="line">	fmt.Println(p)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 结构体重新定义，取别名，只认最新数据类型，相互之间需要强转。</span></span><br><span class="line">	<span class="keyword">var</span> t1 Tea = Tea&#123;<span class="number">100</span>&#125;</span><br><span class="line">	t = Teacher(t1)</span><br><span class="line">	fmt.Println(t1)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Student <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="type">string</span></span><br><span class="line">	Age  <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> s1 Student = Student&#123;<span class="string">&quot;小王&quot;</span>, <span class="number">22</span>&#125;</span><br><span class="line">	fmt.Println(s1)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> s2 Student = Student&#123;</span><br><span class="line">		Name: <span class="string">&quot;小红&quot;</span>,</span><br><span class="line">		Age:  <span class="number">33</span>,</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(s2)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> s3 *Student = &amp;Student&#123;<span class="string">&quot;小明&quot;</span>, <span class="number">30</span>&#125;</span><br><span class="line">	fmt.Println(s3)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">	Age <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法作用在指定的数据类型上。</span></span><br><span class="line"><span class="comment">// 结构体 传递参数给方法也是值传递。</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p Person)</span></span> test() &#123;</span><br><span class="line">	p.Age = <span class="number">111</span></span><br><span class="line">	fmt.Println(p.Age)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> p Person</span><br><span class="line">	p.Age = <span class="number">100</span></span><br><span class="line">	p.test()</span><br><span class="line">	fmt.Println(p.Age)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">	Age <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *Person)</span></span> test() &#123;</span><br><span class="line">	(*p).Age = <span class="number">2333</span> <span class="comment">//也可以用程序员的简写 p.Age 其实底层还是(*p).Age;</span></span><br><span class="line">	fmt.Printf(<span class="string">&quot;test 中p存好的内容是 %p\n&quot;</span>, p)</span><br><span class="line">	fmt.Println(p.Age) <span class="comment">//输出原p的属性</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> p Person</span><br><span class="line">	p.Age = <span class="number">100</span></span><br><span class="line">	fmt.Printf(<span class="string">&quot;main 中p存放的地址是 %p\n&quot;</span>, &amp;p)</span><br><span class="line">	(&amp;p).test()</span><br><span class="line">	fmt.Println(p.Age)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> integer <span class="type">int</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 不用结构体 用其它类型试试。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i integer)</span></span> <span class="built_in">print</span>() &#123;</span><br><span class="line">	i = <span class="number">10</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;print i = &quot;</span>, i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i *integer)</span></span> change() &#123;</span><br><span class="line">	*i = <span class="number">30</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;change i = &quot;</span>, *i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> i integer = <span class="number">20</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;main i = &quot;</span>, i)</span><br><span class="line">	i.<span class="built_in">print</span>()</span><br><span class="line">	fmt.Println(<span class="string">&quot;main i = &quot;</span>, i)</span><br><span class="line">	<span class="comment">// (&amp;i).change()</span></span><br><span class="line">	i.change() <span class="comment">// go语言的简写形式，其实上面才是规范写法。</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;main i = &quot;</span>, i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> student <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="type">string</span></span><br><span class="line">	Age  <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 结构体类型 实现了 String方法 ,print此结构体就是自动输出String方法的返回值。</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *student)</span></span> String() <span class="type">string</span> &#123;</span><br><span class="line">	str := fmt.Sprintf(<span class="string">&quot;Name = %v,Age = %v&quot;</span>, s.Name, s.Age)</span><br><span class="line">	<span class="keyword">return</span> str</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	stu := student&#123;</span><br><span class="line">		Name: <span class="string">&quot;周文王&quot;</span>,</span><br><span class="line">		Age:  <span class="number">20</span>,</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// fmt.Println(stu.Name, stu.Age)</span></span><br><span class="line">	fmt.Println(&amp;stu)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>函数 要严格按照 参数是 值还是指针来区分，但是方法不一样。</p>
<p>方法 接收者为 值类型，可以传入指针类型，接收者是 指针类型，也可以传入值类型。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> student <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="type">string</span></span><br><span class="line">	Age  <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s student)</span></span> test01() &#123;</span><br><span class="line">	fmt.Println(s.Name, s.Age)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *student)</span></span> test02() &#123;</span><br><span class="line">	(*s).Name = <span class="string">&quot;小黄&quot;</span></span><br><span class="line">	fmt.Println((*s).Name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> s student = student&#123;<span class="string">&quot;小红&quot;</span>, <span class="number">100</span>&#125;</span><br><span class="line">	s.test01()</span><br><span class="line">	(&amp;s).test01() <span class="comment">// 虽然使用了指针类型调用，但是还是值传递形式。</span></span><br><span class="line"></span><br><span class="line">	s.test02() <span class="comment">// 虽然使用了值类型调用，但是还是指针传递形式。（会变）</span></span><br><span class="line">	(&amp;s).test02()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>用工厂模式实现非首字母大写的结构体的跨包调用。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 被调用的包写如下</span></span><br><span class="line"><span class="keyword">package</span> model</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Student <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="type">string</span></span><br><span class="line">	Age  <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> student <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="type">string</span></span><br><span class="line">	Age  <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 工厂模式</span></span><br><span class="line"><span class="comment">// 解决首字母小写，还能调用，“工厂模式”</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">New_student</span><span class="params">(n <span class="type">string</span>, a <span class="type">int</span>)</span></span> student &#123;</span><br><span class="line">	<span class="keyword">return</span> student&#123;n, a&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回指针的工厂模式</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">New_student_address</span><span class="params">(n <span class="type">string</span>, a <span class="type">int</span>)</span></span> *student &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;student&#123;n, a&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main包下写如下</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;demo15/model&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 跨包 创建结构体 实例</span></span><br><span class="line">	<span class="comment">// 要求另一个包内的 结构体首字母大写。</span></span><br><span class="line">	<span class="keyword">var</span> s model.Student = model.Student&#123;<span class="string">&quot;张三&quot;</span>, <span class="number">11</span>&#125;</span><br><span class="line">	fmt.Println(s)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//解决首字母小写，还能调用，“工厂模式”</span></span><br><span class="line">	ss := model.New_student(<span class="string">&quot;李四&quot;</span>, <span class="number">12</span>)</span><br><span class="line">	fmt.Println(ss.Name, ss.Age)</span><br><span class="line">	fmt.Printf(<span class="string">&quot;类型是：%T\n&quot;</span>, ss)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 返回指针的工厂模式</span></span><br><span class="line">	sss := model.New_student_address(<span class="string">&quot;王五&quot;</span>, <span class="number">13</span>)</span><br><span class="line">	fmt.Println((*sss).Name, (*sss).Age)</span><br><span class="line">	fmt.Printf(<span class="string">&quot;类型是：%T\n&quot;</span>, sss)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="封装"><a href="#封装" class="headerlink" title="封装"></a>封装</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> model</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> person <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="type">string</span></span><br><span class="line">	age  <span class="type">int</span> <span class="comment">// 不能别的包访问</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义工厂模式（函数） ，相当于构造器。</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewPerson</span><span class="params">(name <span class="type">string</span>)</span></span> *person &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;person&#123;</span><br><span class="line">		Name: name,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 结构体指针的set方法，对age字段封装</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *person)</span></span> SetAge(age <span class="type">int</span>) &#123;</span><br><span class="line">	<span class="keyword">if</span> age &gt; <span class="number">0</span> &amp;&amp; age &lt; <span class="number">150</span> &#123;</span><br><span class="line">		p.age = age</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;范围不正确.&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 结构体指针的get方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *person)</span></span> GetAge() <span class="type">int</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> p.age <span class="comment">//同一个包下 直接访问。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;demo16/model&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	p := model.NewPerson(<span class="string">&quot;丽丽&quot;</span>)</span><br><span class="line">	p.SetAge(<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line">	fmt.Println(p.Name)</span><br><span class="line">	fmt.Println(p.GetAge())</span><br><span class="line">	fmt.Println(p)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义结构体</span></span><br><span class="line"><span class="keyword">type</span> Animal <span class="keyword">struct</span> &#123;</span><br><span class="line">	Age    <span class="type">int</span></span><br><span class="line">	Weight <span class="type">float32</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 给结构体绑定上方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *Animal)</span></span> Shout() &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;wan wan wan &quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义结构体</span></span><br><span class="line"><span class="keyword">type</span> Cat <span class="keyword">struct</span> &#123;</span><br><span class="line">	<span class="comment">// &quot;结构体嵌入&quot;实现继承，加入匿名结构体</span></span><br><span class="line">  <span class="comment">// 当一个结构体内嵌（嵌入）了其他结构体，而不指定字段的名称，这些嵌入的结构体称为匿名结构体。</span></span><br><span class="line">	Animal</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 给结构体绑定上方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Cat)</span></span> scratch() &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;闹人&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">//创建cat结构体的实例</span></span><br><span class="line">	cat := &amp;Cat&#123;&#125;</span><br><span class="line">	cat.Animal.Age = <span class="number">3</span></span><br><span class="line">	cat.Animal.Weight = <span class="number">10.3</span></span><br><span class="line">	cat.Animal.Shout()</span><br><span class="line">	cat.scratch()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>就近原则。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义结构体</span></span><br><span class="line"><span class="keyword">type</span> Animal <span class="keyword">struct</span> &#123;</span><br><span class="line">	Age    <span class="type">int</span></span><br><span class="line">	Weight <span class="type">float32</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 给结构体绑定上方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *Animal)</span></span> Shout() &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;wan wan wan &quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *Animal)</span></span> showInfo() &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;年龄是：&quot;</span>, a.Age)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义结构体</span></span><br><span class="line"><span class="keyword">type</span> Cat <span class="keyword">struct</span> &#123;</span><br><span class="line">	<span class="comment">// &quot;结构体嵌入&quot;实现继承，加入匿名结构体</span></span><br><span class="line">	Animal</span><br><span class="line">	Age <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Cat)</span></span> showInfo() &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;年龄是：&quot;</span>, c.Age)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 给结构体绑定上方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Cat)</span></span> scratch() &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;闹人&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">//创建cat结构体的实例</span></span><br><span class="line">	cat := &amp;Cat&#123;&#125;</span><br><span class="line">	cat.Age = <span class="number">9</span></span><br><span class="line">	cat.Weight = <span class="number">10.3</span></span><br><span class="line">	cat.Animal.Age = <span class="number">20</span></span><br><span class="line">	cat.showInfo() <span class="comment">// 就近原则</span></span><br><span class="line">	cat.Animal.showInfo()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 多重继承,(不推荐)</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> A <span class="keyword">struct</span> &#123;</span><br><span class="line">	a <span class="type">int</span></span><br><span class="line">	b <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> B <span class="keyword">struct</span> &#123;</span><br><span class="line">	c <span class="type">int</span></span><br><span class="line">	d <span class="type">string</span></span><br><span class="line">	a <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> C <span class="keyword">struct</span> &#123;</span><br><span class="line">	A</span><br><span class="line">	B</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	c := C&#123;A&#123;<span class="number">10</span>, <span class="string">&quot;aaa&quot;</span>&#125;, B&#123;<span class="number">20</span>, <span class="string">&quot;bbb&quot;</span>, <span class="number">30</span>&#125;&#125;</span><br><span class="line">	fmt.Println(c)</span><br><span class="line">	fmt.Println(c.b)</span><br><span class="line">	fmt.Println(c.A.a, c.B.a) <span class="comment">// 有同名要区分。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结构体的匿名字段可以是基本数据类型。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> A <span class="keyword">struct</span> &#123;</span><br><span class="line">	a <span class="type">int</span></span><br><span class="line">	b <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> B <span class="keyword">struct</span> &#123;</span><br><span class="line">	c <span class="type">int</span></span><br><span class="line">	d <span class="type">string</span></span><br><span class="line">	a <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> C <span class="keyword">struct</span> &#123;</span><br><span class="line">	A</span><br><span class="line">	B</span><br><span class="line">	<span class="type">int</span> <span class="comment">// 把int 也当成一个匿名结构体，结构体的匿名字段可以是基本数据类型。</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	c := C&#123;A&#123;<span class="number">10</span>, <span class="string">&quot;aaa&quot;</span>&#125;, B&#123;<span class="number">20</span>, <span class="string">&quot;bbb&quot;</span>, <span class="number">30</span>&#125;, <span class="number">888</span>&#125;</span><br><span class="line">	fmt.Println(c)</span><br><span class="line">	fmt.Println(c.b)</span><br><span class="line">	fmt.Println(c.A.a, c.B.a) <span class="comment">// 有同名要区分。</span></span><br><span class="line">	fmt.Println(c.<span class="type">int</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> A <span class="keyword">struct</span> &#123;</span><br><span class="line">	a <span class="type">int</span></span><br><span class="line">	b <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> B <span class="keyword">struct</span> &#123;</span><br><span class="line">	c <span class="type">int</span></span><br><span class="line">	d <span class="type">string</span></span><br><span class="line">	a <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> C <span class="keyword">struct</span> &#123;</span><br><span class="line">	A</span><br><span class="line">	B</span><br><span class="line">	<span class="type">int</span> <span class="comment">// 把int 也当成一个匿名结构体，结构体的匿名字段可以是基本数据类型。</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> C1 <span class="keyword">struct</span> &#123;</span><br><span class="line">	*A <span class="comment">// 传结构体的指针也是可以的。</span></span><br><span class="line">	*B</span><br><span class="line">	<span class="type">int</span> <span class="comment">// 把int 也当成一个匿名结构体，结构体的匿名字段可以是基本数据类型。</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> D <span class="keyword">struct</span> &#123;</span><br><span class="line">	a <span class="type">int</span></span><br><span class="line">	b <span class="type">string</span></span><br><span class="line">	c B <span class="comment">// 组合模式。</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	c := C&#123;A&#123;<span class="number">10</span>, <span class="string">&quot;aaa&quot;</span>&#125;, B&#123;<span class="number">20</span>, <span class="string">&quot;bbb&quot;</span>, <span class="number">30</span>&#125;, <span class="number">888</span>&#125;</span><br><span class="line">	fmt.Println(c)</span><br><span class="line">	fmt.Println(c.b)</span><br><span class="line">	fmt.Println(c.A.a, c.B.a) <span class="comment">// 有同名要区分。</span></span><br><span class="line">	fmt.Println(c.<span class="type">int</span>)</span><br><span class="line"></span><br><span class="line">	c1 := C1&#123;&amp;A&#123;<span class="number">10</span>, <span class="string">&quot;aaa&quot;</span>&#125;, &amp;B&#123;<span class="number">20</span>, <span class="string">&quot;bbb&quot;</span>, <span class="number">30</span>&#125;, <span class="number">888</span>&#125;</span><br><span class="line">	fmt.Println(c1)</span><br><span class="line">	fmt.Println(c1.A)</span><br><span class="line">	fmt.Println(*c1.A)</span><br><span class="line"></span><br><span class="line">	d := D&#123;<span class="number">10</span>, <span class="string">&quot;ooo&quot;</span>, B&#123;<span class="number">10</span>, <span class="string">&quot;bbb&quot;</span>, <span class="number">100</span>&#125;&#125;</span><br><span class="line">	fmt.Println(d)</span><br><span class="line">	fmt.Println(d.c.d)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="接口（借尸还魂）"><a href="#接口（借尸还魂）" class="headerlink" title="接口（借尸还魂）"></a>接口（借尸还魂）</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 接口的定义s</span></span><br><span class="line"><span class="keyword">type</span> SayHello <span class="keyword">interface</span> &#123;</span><br><span class="line">	<span class="comment">// 声明没有实现的方法。</span></span><br><span class="line">	sayHello()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 接口的实现</span></span><br><span class="line"><span class="comment">// 先定义一个结构体</span></span><br><span class="line"><span class="keyword">type</span> Chinese <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 再 用一个绑定结构体的方法来实现 上面的接口。</span></span><br><span class="line"><span class="comment">// 如果想要实现某一个接口，需要把此接口内的所有的方法都实现。</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(person Chinese)</span></span> sayHello() &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;你好&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> American <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(person American)</span></span> sayHello() &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;hi&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个函数，用来接收 具备SayHello接口能力的变量。</span></span><br><span class="line"><span class="comment">// golang 实现接口是基于方法的，而不是基于接口的。</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">greet</span><span class="params">(s SayHello)</span></span> &#123;</span><br><span class="line">	s.sayHello()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	c := Chinese&#123;&#125;</span><br><span class="line">	a := American&#123;&#125;</span><br><span class="line">	greet(c)</span><br><span class="line">	greet(a)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2025/01/01/go%E5%AD%A6%E4%B9%A0/go%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2023-09-02%2010.59.52.jpg" alt="截屏2023-09-02 10.59.52"></p>
<p><img src="/2025/01/01/go%E5%AD%A6%E4%B9%A0/go%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2023-09-02%2011.05.21.jpg" alt="截屏2023-09-02 11.05.21"></p>
<p>一个结构体实现多个接口。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> AInterface <span class="keyword">interface</span> &#123;</span><br><span class="line">	a()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> BInterface <span class="keyword">interface</span> &#123;</span><br><span class="line">	b()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> Stu <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s Stu)</span></span> a() &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;aaaa&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s Stu)</span></span> b() &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;bbbb&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> s Stu</span><br><span class="line">	<span class="keyword">var</span> a AInterface = s</span><br><span class="line">	<span class="keyword">var</span> b BInterface = s</span><br><span class="line">	a.a()</span><br><span class="line">	b.b()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> AInterface <span class="keyword">interface</span> &#123;</span><br><span class="line">	a()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> BInterface <span class="keyword">interface</span> &#123;</span><br><span class="line">	b()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> CInterface <span class="keyword">interface</span> &#123;</span><br><span class="line">	AInterface</span><br><span class="line">	BInterface</span><br><span class="line">	c()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Stu <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s Stu)</span></span> a() &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;aaaa&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s Stu)</span></span> b() &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;bbbb&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s Stu)</span></span> c() &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;ccc&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> s Stu</span><br><span class="line">	<span class="keyword">var</span> a AInterface = s</span><br><span class="line">	<span class="keyword">var</span> b BInterface = s</span><br><span class="line">	a.a()</span><br><span class="line">	b.b()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> c CInterface = s</span><br><span class="line">	c.c( )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>空接口 没有实现任何方法，所以可以视为 任意类型都实现了空接口。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> E <span class="keyword">interface</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> s Stu</span><br><span class="line">	<span class="keyword">var</span> a AInterface = s</span><br><span class="line">	<span class="keyword">var</span> b BInterface = s</span><br><span class="line">	a.a()</span><br><span class="line">	b.b()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> c CInterface = s</span><br><span class="line">	c.c()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> e E = s <span class="comment">// 空接口。</span></span><br><span class="line">	fmt.Println(e)</span><br><span class="line">	<span class="comment">// 另一种空接口 实现。</span></span><br><span class="line">	<span class="keyword">var</span> ee <span class="keyword">interface</span>&#123;&#125; = s</span><br><span class="line">	fmt.Println(ee)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="多态"><a href="#多态" class="headerlink" title="多态"></a>多态</h1><p>golang的多态 也是通过 接口 实现的。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 接口的定义s</span></span><br><span class="line"><span class="keyword">type</span> SayHello <span class="keyword">interface</span> &#123;</span><br><span class="line">	<span class="comment">// 声明没有实现的方法。</span></span><br><span class="line">	sayHello()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 接口的实现</span></span><br><span class="line"><span class="comment">// 先定义一个结构体</span></span><br><span class="line"><span class="keyword">type</span> Chinese <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 再 用一个绑定结构体的方法来实现 上面的接口。</span></span><br><span class="line"><span class="comment">// 如果想要实现某一个接口，需要把此接口内的所有的方法都实现。</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(person Chinese)</span></span> sayHello() &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;你好&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> American <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(person American)</span></span> sayHello() &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;hi&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个函数，用来接收 具备SayHello接口能力的变量。</span></span><br><span class="line"><span class="comment">// golang 实现接口是基于方法的，而不是基于接口的。</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">greet</span><span class="params">(s SayHello)</span></span> &#123;</span><br><span class="line">	s.sayHello()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	c := Chinese&#123;&#125;</span><br><span class="line">	a := American&#123;&#125;</span><br><span class="line">	greet(c)</span><br><span class="line">	greet(a)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2025/01/01/go%E5%AD%A6%E4%B9%A0/go%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2023-09-02%2016.06.40.jpg" alt="截屏2023-09-02 16.06.40"></p>
<h1 id="断言"><a href="#断言" class="headerlink" title="断言"></a>断言</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 接口的定义s</span></span><br><span class="line"><span class="keyword">type</span> SayHello <span class="keyword">interface</span> &#123;</span><br><span class="line">	<span class="comment">// 声明没有实现的方法。</span></span><br><span class="line">	sayHello()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 接口的实现</span></span><br><span class="line"><span class="comment">// 先定义一个结构体</span></span><br><span class="line"><span class="keyword">type</span> Chinese <span class="keyword">struct</span> &#123;</span><br><span class="line">	name <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 再 用一个绑定结构体的方法来实现 上面的接口。</span></span><br><span class="line"><span class="comment">// 如果想要实现某一个接口，需要把此接口内的所有的方法都实现。</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(person Chinese)</span></span> sayHello() &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;你好&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 一个接口外的 方法。</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(person Chinese)</span></span> niu() &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;扭秧歌&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> American <span class="keyword">struct</span> &#123;</span><br><span class="line">	name <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(person American)</span></span> sayHello() &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;hi&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个函数，用来接收 具备SayHello接口能力的变量。</span></span><br><span class="line"><span class="comment">// golang 实现接口是基于方法的，而不是基于接口的。</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">greet</span><span class="params">(s SayHello)</span></span> &#123;</span><br><span class="line">	s.sayHello()</span><br><span class="line">	<span class="comment">// 断言</span></span><br><span class="line">	<span class="keyword">var</span> ch Chinese = s.(Chinese) <span class="comment">// 看s是否能转为Chinese类型，并赋给ch变量。</span></span><br><span class="line">	ch.niu()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	c := Chinese&#123;<span class="string">&quot;陈&quot;</span>&#125;</span><br><span class="line">	<span class="comment">// a := American&#123;&quot;宇&quot;&#125;</span></span><br><span class="line">	greet(c)</span><br><span class="line">	<span class="comment">// greet(a)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 接口的定义s</span></span><br><span class="line"><span class="keyword">type</span> SayHello <span class="keyword">interface</span> &#123;</span><br><span class="line">	<span class="comment">// 声明没有实现的方法。</span></span><br><span class="line">	sayHello()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 接口的实现</span></span><br><span class="line"><span class="comment">// 先定义一个结构体</span></span><br><span class="line"><span class="keyword">type</span> Chinese <span class="keyword">struct</span> &#123;</span><br><span class="line">	name <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 再 用一个绑定结构体的方法来实现 上面的接口。</span></span><br><span class="line"><span class="comment">// 如果想要实现某一个接口，需要把此接口内的所有的方法都实现。</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(person Chinese)</span></span> sayHello() &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;你好&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 一个接口外的 方法。</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(person Chinese)</span></span> niu() &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;扭秧歌&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> American <span class="keyword">struct</span> &#123;</span><br><span class="line">	name <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(person American)</span></span> sayHello() &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;hi&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个函数，用来接收 具备SayHello接口能力的变量。</span></span><br><span class="line"><span class="comment">// golang 实现接口是基于方法的，而不是基于接口的。</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">greet</span><span class="params">(s SayHello)</span></span> &#123;</span><br><span class="line">	s.sayHello()</span><br><span class="line">	<span class="comment">// 断言</span></span><br><span class="line">	ch, flag := s.(Chinese) <span class="comment">// 看s是否能转为Chinese类型，并赋给ch变量。</span></span><br><span class="line">	<span class="comment">// if ch, flag := s.(Chinese); flag == true &#123; //这样写；前是定义，；后判断。</span></span><br><span class="line">  <span class="keyword">if</span> flag == <span class="literal">true</span> &#123;</span><br><span class="line">		ch.niu()</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;不会扭秧歌&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// c := Chinese&#123;&quot;陈&quot;&#125;</span></span><br><span class="line">	a := American&#123;<span class="string">&quot;宇&quot;</span>&#125;</span><br><span class="line">	<span class="comment">// greet(c)</span></span><br><span class="line">	greet(a)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="文件"><a href="#文件" class="headerlink" title="文件"></a>文件</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;os&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">//打开</span></span><br><span class="line">	file, err := os.Open(<span class="string">&quot;/Users/chenyushao/Desktop/golang_draft/test.txt&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;文件打开失败,对应错误为：&quot;</span>, err)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;文件的指针是：&quot;</span>, file)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//一系列操作</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//关闭文件</span></span><br><span class="line">	err = file.Close()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;关闭失败&quot;</span>)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;关闭成功&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2025/01/01/go%E5%AD%A6%E4%B9%A0/go%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2023-09-04%2011.22.22.jpg" alt="截屏2023-09-04 11.22.22"></p>
<p>带缓冲的读取，4096.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;bufio&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;io&quot;</span></span><br><span class="line">	<span class="string">&quot;os&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">//打开</span></span><br><span class="line">	file, err := os.Open(<span class="string">&quot;/Users/chenyushao/Desktop/golang_draft/test.txt&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;文件打开成功。&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//函数退出时，关闭，防治内存泄漏。</span></span><br><span class="line">	<span class="keyword">defer</span> file.Close()</span><br><span class="line"></span><br><span class="line">	<span class="comment">//创建流</span></span><br><span class="line">	reader := bufio.NewReader(file)</span><br><span class="line">	<span class="comment">//读取,死循环读取。</span></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		str, err := reader.ReadString(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">		<span class="keyword">if</span> err == io.EOF &#123;</span><br><span class="line">			fmt.Println(<span class="string">&quot;读取完毕&quot;</span>)</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">		fmt.Println(str)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">&quot;文件读物成功，且读取完毕。&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;bufio&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;os&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 写入文件。</span></span><br><span class="line">	<span class="comment">//打开文件</span></span><br><span class="line">	file, err := os.OpenFile(<span class="string">&quot;/Users/chenyushao/Desktop/golang_draft/test.txt&quot;</span>, os.O_APPEND|os.O_RDWR|os.O_CREATE, <span class="number">0751</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;打开文件失败，&quot;</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//及时关闭资源</span></span><br><span class="line">	<span class="keyword">defer</span> file.Close()</span><br><span class="line"></span><br><span class="line">	<span class="comment">//写入</span></span><br><span class="line">	<span class="comment">//io流，先写入缓冲区。</span></span><br><span class="line">	writer := bufio.NewWriter(file)</span><br><span class="line">	writer.WriteString(<span class="string">&quot;hello &quot;</span>)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">		writer.WriteString(<span class="string">&quot;重复&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 流带缓冲区，刷新数据，把管子清一下。(真正写入到文件)</span></span><br><span class="line">	writer.Flush()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="进程、线程、协程、管道"><a href="#进程、线程、协程、管道" class="headerlink" title="进程、线程、协程、管道"></a>进程、线程、协程、管道</h1><p>一个运行的程序就是一个 进程；</p>
<p>一个进程中可以有一个或者多个线程；</p>
<p>一个cpu运行多个线程，就是伪多线程，实际上是一个cpu在多个线程片段之间切换，只是切换的速度比较快，切换不同的线程涉及系统层面的开销；</p>
<p>协程（goroutine） 就是 微线程，本质是 对单一线程的优化（协程是单线程的并发）。</p>
<p><img src="/2025/01/01/go%E5%AD%A6%E4%B9%A0/go%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2023-09-06%2010.55.26.jpg" alt="截屏2023-09-06 10.55.26"></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;strconv&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">()</span></span> &#123; <span class="comment">// 准备用作协程的函数（协程属于函数调用层面）</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++ &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;协程 goroutine:&quot;</span> + strconv.Itoa(i))</span><br><span class="line">		time.Sleep(time.Second * <span class="number">1</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123; <span class="comment">// 主线程</span></span><br><span class="line">	<span class="keyword">go</span> test() <span class="comment">// go 中开启协程。</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++ &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;主线程:&quot;</span> + strconv.Itoa(i))</span><br><span class="line">		time.Sleep(time.Second * <span class="number">1</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 运行结果</span></span><br><span class="line">主线程:<span class="number">1</span></span><br><span class="line">协程 goroutine:<span class="number">1</span></span><br><span class="line">协程 goroutine:<span class="number">2</span></span><br><span class="line">主线程:<span class="number">2</span></span><br><span class="line">主线程:<span class="number">3</span></span><br><span class="line">协程 goroutine:<span class="number">3</span></span><br><span class="line">主线程:<span class="number">4</span></span><br><span class="line">协程 goroutine:<span class="number">4</span></span><br><span class="line">协程 goroutine:<span class="number">5</span></span><br><span class="line">主线程:<span class="number">5</span></span><br><span class="line">协程 goroutine:<span class="number">6</span></span><br><span class="line">主线程:<span class="number">6</span></span><br><span class="line">主线程:<span class="number">7</span></span><br><span class="line">协程 goroutine:<span class="number">7</span></span><br><span class="line">协程 goroutine:<span class="number">8</span></span><br><span class="line">主线程:<span class="number">8</span></span><br><span class="line">协程 goroutine:<span class="number">9</span></span><br><span class="line">主线程:<span class="number">9</span></span><br><span class="line">协程 goroutine:<span class="number">10</span></span><br><span class="line">主线程:<span class="number">10</span></span><br></pre></td></tr></table></figure>

<p><img src="/2025/01/01/go%E5%AD%A6%E4%B9%A0/go%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2023-09-06%2011.12.39.jpg" alt="截屏2023-09-06 11.12.39"></p>
<p>主死随从</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 主线程结束了，协程也会跟着结束</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;strconv&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">()</span></span> &#123; <span class="comment">// 准备用作协程的函数（协程属于函数调用层面）</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= <span class="number">100</span>; i++ &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;协程 goroutine:&quot;</span> + strconv.Itoa(i))</span><br><span class="line">		time.Sleep(time.Second * <span class="number">1</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123; <span class="comment">// 主线程</span></span><br><span class="line">	<span class="keyword">go</span> test() <span class="comment">// go 中开启协程。</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++ &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;主线程:&quot;</span> + strconv.Itoa(i))</span><br><span class="line">		time.Sleep(time.Second * <span class="number">1</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 用匿名函数 和 外部变量组成 闭包</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">		<span class="comment">//启动协程</span></span><br><span class="line">		<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">			fmt.Println(i)</span><br><span class="line">		&#125;()</span><br><span class="line">	&#125;</span><br><span class="line">	time.Sleep(time.Second * <span class="number">2</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 以上代码 会让10个协程 并发， i变量不确定运行到多少时，被协程的匿名函数用上。</span></span><br><span class="line"><span class="number">10</span></span><br><span class="line"><span class="number">10</span></span><br><span class="line"><span class="number">10</span></span><br><span class="line"><span class="number">10</span></span><br><span class="line"><span class="number">10</span></span><br><span class="line"><span class="number">10</span></span><br><span class="line"><span class="number">10</span></span><br><span class="line"><span class="number">10</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="number">10</span></span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 用匿名函数 和 外部变量组成 闭包</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">		<span class="comment">//启动协程</span></span><br><span class="line">		<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(num <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">			fmt.Println(num)</span><br><span class="line">		&#125;(i)</span><br><span class="line">	&#125;</span><br><span class="line">	time.Sleep(time.Second * <span class="number">2</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 循环每生成一个协程的匿名函数时，把此时的i以参数形式，传入匿名函数。</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">9</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="number">8</span></span><br><span class="line"><span class="number">7</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">5</span></span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup <span class="comment">// 只需要定义，无需赋值。计数器</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 用匿名函数 和 外部变量组成 闭包</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">		wg.Add(<span class="number">1</span>) <span class="comment">// 注意这里wg add的次数，要保证和 协程的个数一致。</span></span><br><span class="line">		<span class="comment">//启动协程</span></span><br><span class="line">		<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(num <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">      <span class="keyword">defer</span> wg.Done()</span><br><span class="line">			fmt.Println(num)</span><br><span class="line">		&#125;(i)</span><br><span class="line">	&#125;</span><br><span class="line">	wg.Wait()</span><br><span class="line">&#125;</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">9</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="number">7</span></span><br><span class="line"><span class="number">8</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> num <span class="type">int</span></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup <span class="comment">//定义不需要赋值。</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> wg.Done()</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++ &#123;</span><br><span class="line">		num = num + <span class="number">1</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sub</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> wg.Done()</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++ &#123;</span><br><span class="line">		num = num - <span class="number">1</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	wg.Add(<span class="number">2</span>)</span><br><span class="line">	<span class="comment">//启动协程</span></span><br><span class="line">	<span class="keyword">go</span> add()</span><br><span class="line">	<span class="keyword">go</span> sub()</span><br><span class="line">	wg.Wait()</span><br><span class="line">	fmt.Println(num)</span><br><span class="line">&#125;  </span><br><span class="line"><span class="comment">//结果 </span></span><br><span class="line"><span class="number">1045</span></span><br></pre></td></tr></table></figure>

<p><img src="/2025/01/01/go%E5%AD%A6%E4%B9%A0/go%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2023-09-07%2010.34.18.jpg" alt="截屏2023-09-07 10.34.18"></p>
<p>多个协程之间 交替执行导致了问题，协程并发争抢资源。</p>
<p>用 锁 可以解决上面的问题，但是不推荐,因为性能低。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> num <span class="type">int</span></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup <span class="comment">//定义不需要赋值。</span></span><br><span class="line"><span class="comment">// 加入互斥锁 mutex lock</span></span><br><span class="line"><span class="keyword">var</span> lock sync.Mutex</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> wg.Done()</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++ &#123;</span><br><span class="line">		<span class="comment">// 加锁</span></span><br><span class="line">		lock.Lock()</span><br><span class="line">		num = num + <span class="number">1</span></span><br><span class="line">		<span class="comment">// 解锁</span></span><br><span class="line">		lock.Unlock()</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sub</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> wg.Done()</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++ &#123;</span><br><span class="line">		<span class="comment">// 加锁</span></span><br><span class="line">		lock.Lock()</span><br><span class="line">		num = num - <span class="number">1</span></span><br><span class="line">		<span class="comment">// 解锁</span></span><br><span class="line">		lock.Unlock()</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	wg.Add(<span class="number">2</span>)</span><br><span class="line">	<span class="comment">//启动协程</span></span><br><span class="line">	<span class="keyword">go</span> add()</span><br><span class="line">	<span class="keyword">go</span> sub()</span><br><span class="line">	wg.Wait()</span><br><span class="line">	fmt.Println(num)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>读多写少，推荐用读写锁RWLock。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> num <span class="type">int</span></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup <span class="comment">//定义不需要赋值。</span></span><br><span class="line"><span class="comment">// 加入读写锁 RWMutex lock</span></span><br><span class="line"><span class="keyword">var</span> lock sync.RWMutex</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> wg.Done()</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">		<span class="comment">// 加锁</span></span><br><span class="line">		lock.RLock() <span class="comment">// 读之间不锁，只针对写锁起来。</span></span><br><span class="line">		fmt.Println(<span class="string">&quot;开始读&quot;</span>)</span><br><span class="line">		num = num + <span class="number">1</span></span><br><span class="line">		time.Sleep(time.Second * <span class="number">1</span>)</span><br><span class="line">		<span class="comment">// 解锁</span></span><br><span class="line">		lock.RUnlock()</span><br><span class="line">		fmt.Println(<span class="string">&quot;读完了&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sub</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> wg.Done()</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">2</span>; i++ &#123;</span><br><span class="line">		<span class="comment">// 加锁</span></span><br><span class="line">		lock.Lock() <span class="comment">// 默认的Lock就是写锁。</span></span><br><span class="line">		fmt.Println(<span class="string">&quot;开始写&quot;</span>)</span><br><span class="line">		num = num - <span class="number">1</span></span><br><span class="line">		time.Sleep(time.Second * <span class="number">1</span>)</span><br><span class="line">		<span class="comment">// 解锁</span></span><br><span class="line">		lock.Unlock()</span><br><span class="line">		fmt.Println(<span class="string">&quot;写完了&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	wg.Add(<span class="number">2</span>) <span class="comment">// add 的计数要和 协程数量一致。</span></span><br><span class="line">	<span class="comment">//启动协程</span></span><br><span class="line">	<span class="keyword">go</span> add()</span><br><span class="line">	<span class="keyword">go</span> sub()</span><br><span class="line">	wg.Wait()</span><br><span class="line">	fmt.Println(num)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="管道"><a href="#管道" class="headerlink" title="管道"></a>管道</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 管道 声明</span></span><br><span class="line">	<span class="keyword">var</span> intChan <span class="keyword">chan</span> <span class="type">int</span></span><br><span class="line">	<span class="comment">// 通过make初始化，此管道可以放3个int数据。</span></span><br><span class="line">	intChan = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">3</span>)</span><br><span class="line">	<span class="comment">// 证明管道是 引用类型</span></span><br><span class="line">	fmt.Printf(<span class="string">&quot;intChan的值是：%v \n&quot;</span>, intChan)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 向管道放数据</span></span><br><span class="line">	intChan &lt;- <span class="number">10</span></span><br><span class="line">	num := <span class="number">20</span></span><br><span class="line">	intChan &lt;- num</span><br><span class="line">	intChan &lt;- <span class="number">50</span></span><br><span class="line">	<span class="comment">// intChan &lt;- 500 // 超了会死锁。</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 管道内读取数据</span></span><br><span class="line">	num1 := &lt;-intChan</span><br><span class="line">	num2 := &lt;-intChan</span><br><span class="line">	num3 := &lt;-intChan</span><br><span class="line">	fmt.Println(num1, num2, num3)</span><br><span class="line"></span><br><span class="line">	fmt.Printf(<span class="string">&quot;管道实际长度：%v,管道容量是 %v&quot;</span>, <span class="built_in">len</span>(intChan), <span class="built_in">cap</span>(intChan))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>管道关闭以后 读取可以，只是不能再写入了。如果写入超过容量，会死锁。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 管道 声明</span></span><br><span class="line">	<span class="keyword">var</span> intChan <span class="keyword">chan</span> <span class="type">int</span></span><br><span class="line">	<span class="comment">// 通过make初始化，此管道可以放3个int数据。</span></span><br><span class="line">	intChan = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">100</span>)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">		intChan &lt;- i</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">close</span>(intChan)</span><br><span class="line">	<span class="comment">//遍历 前记得关闭管道。</span></span><br><span class="line">	<span class="keyword">for</span> v := <span class="keyword">range</span> intChan &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;value = &quot;</span>, v)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2025/01/01/go%E5%AD%A6%E4%B9%A0/go%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2023-09-07%2022.14.58.jpg" alt="截屏2023-09-07 22.14.58"></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">writeData</span><span class="params">(intChan <span class="keyword">chan</span> <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> wg.Done()</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= <span class="number">50</span>; i++ &#123;</span><br><span class="line">		intChan &lt;- i</span><br><span class="line">		fmt.Println(<span class="string">&quot;写入的数据为：&quot;</span>, i)</span><br><span class="line">		time.Sleep(time.Second)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//写完以后关闭管道</span></span><br><span class="line">	<span class="built_in">close</span>(intChan)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">readData</span><span class="params">(intChan <span class="keyword">chan</span> <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> wg.Done()</span><br><span class="line">	<span class="keyword">for</span> v := <span class="keyword">range</span> intChan &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;读的数据为：&quot;</span>, v)</span><br><span class="line">		time.Sleep(time.Second)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup <span class="comment">// 用协程计数器 做一个阻塞。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123; <span class="comment">//主线程</span></span><br><span class="line">	<span class="comment">//写的协程 和 读协程 共同操作一个管道。</span></span><br><span class="line">	intChan := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">50</span>)</span><br><span class="line"></span><br><span class="line">	wg.Add(<span class="number">2</span>) <span class="comment">// 用到的是两个协程。</span></span><br><span class="line">	<span class="comment">//开启读写协程</span></span><br><span class="line">	<span class="keyword">go</span> writeData(intChan)</span><br><span class="line">	<span class="keyword">go</span> readData(intChan)</span><br><span class="line">	wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>管道可以声明 只读或者只写。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123; <span class="comment">//主线程</span></span><br><span class="line">	<span class="comment">// 正常情况下，管道是双向的，可读可写。</span></span><br><span class="line">	<span class="comment">// var intChan chan int</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 声明为只写</span></span><br><span class="line">	<span class="keyword">var</span> intChan2 <span class="keyword">chan</span>&lt;- <span class="type">int</span> <span class="comment">// 管道有 只读性质。而不是一种新类型</span></span><br><span class="line">	intChan2 = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">5</span>)</span><br><span class="line">	intChan2 &lt;- <span class="number">10</span></span><br><span class="line">	<span class="comment">// num := &lt;-intChan2 // 有只写性质后，这样的读管道就非法了。</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;intChan2&quot;</span>, intChan2)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 声明为只读</span></span><br><span class="line">	<span class="keyword">var</span> intChan3 &lt;-<span class="keyword">chan</span> <span class="type">int</span></span><br><span class="line">	<span class="keyword">if</span> intChan3 != <span class="literal">nil</span> &#123;</span><br><span class="line">		num1 := &lt;-intChan3</span><br><span class="line">		fmt.Println(<span class="string">&quot;num1&quot;</span>, num1)</span><br><span class="line">	&#125;</span><br><span class="line">	intChan3 &lt;- <span class="number">20</span> <span class="comment">// 有只读性质后，这样的写管道就非法了。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>有写没有读，管道就会deadlock 死锁。</p>
<p>但是写的快，读得慢，是不会死锁的。</p>
<h2 id="select"><a href="#select" class="headerlink" title="select"></a>select</h2><p>select 解决多个管道的选择问题，又叫“多路复用”</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123; <span class="comment">//主线程</span></span><br><span class="line">	<span class="comment">//管道1</span></span><br><span class="line">	intChan := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">1</span>)</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; <span class="comment">// 通过一个匿名函数往管道1内 写。</span></span><br><span class="line">		time.Sleep(time.Second * <span class="number">5</span>)</span><br><span class="line">		intChan &lt;- <span class="number">10</span></span><br><span class="line">	&#125;()</span><br><span class="line">	<span class="comment">//管道2</span></span><br><span class="line">	stringChan := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>, <span class="number">1</span>)</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; <span class="comment">// 通过一个匿名函数往管道2内 写。</span></span><br><span class="line">		time.Sleep(time.Second * <span class="number">2</span>)</span><br><span class="line">		stringChan &lt;- <span class="string">&quot;msbgolang&quot;</span></span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// fmt.Println(&lt;-intChan) // 本身 取数据就是 阻塞。</span></span><br><span class="line">	<span class="comment">// select 可以公平的从多个管道中按照时间长短， 选择一个来阻塞并执行。</span></span><br><span class="line">	<span class="comment">// 像以下就是输出“stringChan: msbgolang” 因为管道2的那个写入的协程时间短一些。</span></span><br><span class="line">	<span class="keyword">select</span> &#123;</span><br><span class="line">	<span class="keyword">case</span> v := &lt;-intChan: <span class="comment">// 语句写法是固定的。case 后跟一个读管道操作。</span></span><br><span class="line">		fmt.Println(<span class="string">&quot;intChan：&quot;</span>, v)</span><br><span class="line">	<span class="keyword">case</span> v := &lt;-stringChan:</span><br><span class="line">		fmt.Println(<span class="string">&quot;stringChan:&quot;</span>, v)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123; <span class="comment">//主线程</span></span><br><span class="line">	<span class="comment">//管道1</span></span><br><span class="line">	intChan := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">1</span>)</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; <span class="comment">// 通过一个匿名函数往管道1内 写。</span></span><br><span class="line">		time.Sleep(time.Second * <span class="number">5</span>)</span><br><span class="line">		intChan &lt;- <span class="number">10</span></span><br><span class="line">	&#125;()</span><br><span class="line">	<span class="comment">//管道2</span></span><br><span class="line">	stringChan := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>, <span class="number">1</span>)</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; <span class="comment">// 通过一个匿名函数往管道2内 写。</span></span><br><span class="line">		time.Sleep(time.Second * <span class="number">2</span>)</span><br><span class="line">		stringChan &lt;- <span class="string">&quot;msbgolang&quot;</span></span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// fmt.Println(&lt;-intChan) // 本身 取数据就是 阻塞。</span></span><br><span class="line">	<span class="comment">// select 可以公平的从多个管道中按照时间长短， 选择一个来阻塞并执行。</span></span><br><span class="line">	<span class="comment">// 像以下就是输出“stringChan: msbgolang” 因为管道2的那个写入的协程时间短一些。</span></span><br><span class="line">	<span class="keyword">select</span> &#123;</span><br><span class="line">	<span class="keyword">case</span> v := &lt;-intChan: <span class="comment">// 语句写法是固定的。case 后跟一个读管道操作。</span></span><br><span class="line">		fmt.Println(<span class="string">&quot;intChan：&quot;</span>, v)</span><br><span class="line">	<span class="keyword">case</span> v := &lt;-stringChan:</span><br><span class="line">		fmt.Println(<span class="string">&quot;stringChan:&quot;</span>, v)</span><br><span class="line">	<span class="keyword">default</span>: <span class="comment">//default 可以防止case 的阻塞被执行。</span></span><br><span class="line">		fmt.Println(<span class="string">&quot;防止select被阻塞&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>主动捕获异常defer+recover，来让协程出问题的时候，其它协程和主线程正常运行。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printNum</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">		fmt.Println(i)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">devide</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 捕获异常。</span></span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		err := <span class="built_in">recover</span>()</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			fmt.Println(<span class="string">&quot;devide() 出现错误:&quot;</span>, err)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	num1 := <span class="number">1</span></span><br><span class="line">	num2 := <span class="number">0</span></span><br><span class="line">	result := num1 / num2</span><br><span class="line">	fmt.Println(<span class="string">&quot;devide:&quot;</span>, result)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123; <span class="comment">//主线程</span></span><br><span class="line">	<span class="comment">//启动两个goroutine</span></span><br><span class="line">	<span class="keyword">go</span> printNum()</span><br><span class="line">	<span class="keyword">go</span> devide()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 让主线程等一等</span></span><br><span class="line">	time.Sleep(time.Second * <span class="number">4</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h1><p><img src="/2025/01/01/go%E5%AD%A6%E4%B9%A0/go%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2023-09-09%2010.41.22.jpg" alt="截屏2023-09-09 10.41.22"></p>
<h2 id="传输层：TCP-协议三次握手，四次挥手"><a href="#传输层：TCP-协议三次握手，四次挥手" class="headerlink" title="传输层：TCP 协议三次握手，四次挥手"></a>传输层：TCP 协议三次握手，四次挥手</h2><p><img src="/2025/01/01/go%E5%AD%A6%E4%B9%A0/go%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2023-09-09%2010.43.02.jpg" alt="截屏2023-09-09 10.43.02"></p>
<p><img src="/2025/01/01/go%E5%AD%A6%E4%B9%A0/go%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2023-09-09%2010.44.42.jpg" alt="截屏2023-09-09 10.44.42"></p>
<h2 id="传输层：UDP-协议（不可靠）"><a href="#传输层：UDP-协议（不可靠）" class="headerlink" title="传输层：UDP 协议（不可靠）"></a>传输层：UDP 协议（不可靠）</h2><p>UDP协议可能丢包；</p>
<p>数据切成一个一个的小数据包 发送给服务器。服务器也接收一个一个的小数据包。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 客户端</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;net&quot;</span> <span class="comment">// 网络需要的包。</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;客户端启动&quot;</span>)</span><br><span class="line">	<span class="comment">// 创建客户端(指定服务器端IP 和 PROT)</span></span><br><span class="line">	conn, err := net.Dial(<span class="string">&quot;tcp&quot;</span>, <span class="string">&quot;127.0.0.1:8888&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;客户端链接失败&quot;</span>)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">&quot;客户端连接成功,conn:&quot;</span>, conn)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 服务器端</span></span><br><span class="line"><span class="comment">// 测试时，要先启动服务器端，因为服务器端要先启动 等待客户端发消息过来。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;net&quot;</span> <span class="comment">// 网络需要的包。</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;服务器端启动&quot;</span>)</span><br><span class="line">	<span class="comment">// 监听</span></span><br><span class="line">	listen, err := net.Listen(<span class="string">&quot;tcp&quot;</span>, <span class="string">&quot;127.0.0.1:8888&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;监听失败,err:&quot;</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 监听成功后，等待客户端连接</span></span><br><span class="line">	conn, err2 := listen.Accept()</span><br><span class="line">	<span class="keyword">if</span> err2 != <span class="literal">nil</span> &#123; <span class="comment">// 客户端等待失败</span></span><br><span class="line">		fmt.Println(<span class="string">&quot;客户端等待失败，err2&quot;</span>, err2)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;连接成功,%v\n,接收到的客户端远程地址是:%v\n&quot;</span>, conn, conn.RemoteAddr().String())</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 在实际连接时，服务器会分配一个临时的端口给客户端，</span></span><br><span class="line"><span class="comment">而不是使用监听的端口。这是因为在传输层（TCP 协议）中，</span></span><br><span class="line"><span class="comment">客户端和服务器之间的通信是通过客户端随机 分配的一个临时端口与服务器的监听端口建立连接的。*/</span></span><br></pre></td></tr></table></figure>

<p>完整版</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 服务器</span></span><br><span class="line"><span class="comment">// 测试时，要先启动服务器端，因为服务器端要先启动 等待客户端发消息过来。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;net&quot;</span> <span class="comment">// 网络需要的包。</span></span><br><span class="line">	<span class="string">&quot;os&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">process</span><span class="params">(conn net.Conn)</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> conn.Close() <span class="comment">// 链接用完记得关闭。</span></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="comment">// 创建一个切片,将读入的数据 放进切片中。</span></span><br><span class="line">		buf := <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="number">1024</span>)</span><br><span class="line">		n, err := conn.Read(buf)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> <span class="type">string</span>(buf[<span class="number">0</span>:n]) == <span class="string">&quot;quit\n&quot;</span> &#123;</span><br><span class="line">			fmt.Println(<span class="string">&quot;接收到客户端注销信号,现在执行.&quot;</span>)</span><br><span class="line">			os.Exit(<span class="number">1</span>)</span><br><span class="line">		&#125;</span><br><span class="line">		fmt.Println(<span class="type">string</span>(buf[<span class="number">0</span>:n]))</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;服务器端启动&quot;</span>)</span><br><span class="line">	<span class="comment">// 监听</span></span><br><span class="line">	listen, err := net.Listen(<span class="string">&quot;tcp&quot;</span>, <span class="string">&quot;127.0.0.1:8888&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;监听失败,err:&quot;</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="comment">// 监听成功后，等待客户端连接</span></span><br><span class="line">		conn, err2 := listen.Accept()</span><br><span class="line">		<span class="keyword">if</span> err2 != <span class="literal">nil</span> &#123; <span class="comment">// 客户端等待失败</span></span><br><span class="line">			fmt.Println(<span class="string">&quot;客户端等待失败，err2&quot;</span>, err2)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			fmt.Printf(<span class="string">&quot;连接成功,%v\n,接收到的客户端远程地址是:%v\n&quot;</span>, conn, conn.RemoteAddr().String())</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 准备一个协程，此协程处理不同客户端请求。</span></span><br><span class="line">		<span class="keyword">go</span> process(conn)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;bufio&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;net&quot;</span> <span class="comment">// 网络需要的包。</span></span><br><span class="line">	<span class="string">&quot;os&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;客户端启动&quot;</span>)</span><br><span class="line">	<span class="comment">// 创建客户端(指定服务器端IP 和 PROT)</span></span><br><span class="line">	conn, err := net.Dial(<span class="string">&quot;tcp&quot;</span>, <span class="string">&quot;127.0.0.1:8888&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;客户端链接失败&quot;</span>)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">&quot;客户端连接成功,conn:&quot;</span>, conn)</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		reader := bufio.NewReader(os.Stdin)</span><br><span class="line">		str, err := reader.ReadString(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			fmt.Println(<span class="string">&quot;终端输入失败,err&quot;</span>, err)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> str == <span class="string">&quot;quit\n&quot;</span> &#123;</span><br><span class="line">			_, err := conn.Write([]<span class="type">byte</span>(str)) <span class="comment">// 这里需要强转一下。</span></span><br><span class="line">			<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">				fmt.Println(<span class="string">&quot;写入失败&quot;</span>)</span><br><span class="line">			&#125;</span><br><span class="line">			fmt.Println(<span class="string">&quot;手动退出客户端&quot;</span>)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 将str发送给服务器</span></span><br><span class="line">		n, err := conn.Write([]<span class="type">byte</span>(str)) <span class="comment">// 这里需要强转一下。</span></span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			fmt.Println(<span class="string">&quot;写入失败&quot;</span>)</span><br><span class="line">		&#125;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;客户端数据发送成功，一共发送了%d字节的数据。&quot;</span>, n)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="反射"><a href="#反射" class="headerlink" title="反射"></a>反射</h1><p>放射能够 在 运行时动态获取变量信息。</p>
<p><img src="/2025/01/01/go%E5%AD%A6%E4%B9%A0/go%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2023-09-10%2011.29.05.jpg" alt="截屏2023-09-10 11.29.05"></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;reflect&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 利用一个函数，函数的参数为空接口；</span></span><br><span class="line"><span class="comment">// 空接口没有方法，可以视为所有类型都实现了空接口。</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testReflect</span><span class="params">(i <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">	<span class="comment">// 1.调用TypeOf函数，返回reflect.Type类型</span></span><br><span class="line">	reType := reflect.TypeOf(i)</span><br><span class="line">	fmt.Println(<span class="string">&quot;reType:&quot;</span>, reType)</span><br><span class="line">	reValue := reflect.ValueOf(i)</span><br><span class="line">	fmt.Println(<span class="string">&quot;Value:&quot;</span>, reValue)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// num1 := 2</span></span><br><span class="line">	<span class="comment">// reValue 是 Value 类型的结构体 不是int类型</span></span><br><span class="line">	num2 := <span class="number">50</span> + reValue.Int() <span class="comment">//num1</span></span><br><span class="line">	fmt.Println(num2)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 原路返回</span></span><br><span class="line">	<span class="comment">// reValue 转为空接口(其实是转为保管在空接口中的类型)：</span></span><br><span class="line">	i2 := reValue.Interface()</span><br><span class="line">	<span class="comment">// 利用断言，看看能不能转为int类型。</span></span><br><span class="line">	n := i2.(<span class="type">int</span>)</span><br><span class="line">	fmt.Println(n + <span class="number">10</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 对基础数据类型进行反射</span></span><br><span class="line">	<span class="keyword">var</span> num <span class="type">int</span> = <span class="number">100</span></span><br><span class="line">	testReflect(num)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2025/01/01/go%E5%AD%A6%E4%B9%A0/go%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2023-09-10%2012.27.40.jpg" alt="截屏2023-09-10 12.27.40"></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;reflect&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 利用一个函数，函数的参数为空接口；</span></span><br><span class="line"><span class="comment">// 空接口没有方法，可以视为所有类型都实现了空接口。</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testReflect</span><span class="params">(i <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">	<span class="comment">// 1.调用TypeOf函数，返回reflect.Type类型</span></span><br><span class="line">	reType := reflect.TypeOf(i)</span><br><span class="line">	fmt.Println(<span class="string">&quot;reType:&quot;</span>, reType)</span><br><span class="line">	reValue := reflect.ValueOf(i)</span><br><span class="line">	fmt.Println(<span class="string">&quot;Value:&quot;</span>, reValue)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 原路返回</span></span><br><span class="line">	<span class="comment">// reValue 转为空接口(其实是转为保管在空接口中的类型)：</span></span><br><span class="line">	i2 := reValue.Interface()</span><br><span class="line">	<span class="comment">// 利用断言，看看能不能转为int类型。</span></span><br><span class="line">	n, flag := i2.(Student)</span><br><span class="line">	<span class="keyword">if</span> flag == <span class="literal">true</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;名字是：%v,年龄是：%v&quot;</span>, n.Name, n.Age)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Student <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="type">string</span></span><br><span class="line">	Age  <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 对基础数据类型进行反射</span></span><br><span class="line">	<span class="keyword">var</span> num <span class="type">int</span> = <span class="number">100</span></span><br><span class="line">	testReflect(num)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 对结构体反射</span></span><br><span class="line">	stu := Student&#123;</span><br><span class="line">		Name: <span class="string">&quot;丽丽&quot;</span>,</span><br><span class="line">		Age:  <span class="number">18</span>,</span><br><span class="line">	&#125;</span><br><span class="line">	testReflect(stu)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;reflect&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 利用一个函数，函数的参数为空接口；</span></span><br><span class="line"><span class="comment">// 空接口没有方法，可以视为所有类型都实现了空接口。</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testReflect</span><span class="params">(i <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">	<span class="comment">// 1.调用TypeOf函数，返回reflect.Type类型</span></span><br><span class="line">	reType := reflect.TypeOf(i)</span><br><span class="line">	fmt.Println(<span class="string">&quot;reType:&quot;</span>, reType)</span><br><span class="line">	reValue := reflect.ValueOf(i)</span><br><span class="line">	fmt.Println(<span class="string">&quot;Value:&quot;</span>, reValue)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 获取变量类别(类别比 类型的范围要大一些)</span></span><br><span class="line">	k1 := reType.Kind()  <span class="comment">// 方式一</span></span><br><span class="line">	k2 := reValue.Kind() <span class="comment">// 方式二</span></span><br><span class="line">	fmt.Println(k1, k2, k1 == k2, <span class="string">&quot;look this.&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 原路返回</span></span><br><span class="line">	<span class="comment">// reValue 转为空接口(其实是转为保管在空接口中的类型)：</span></span><br><span class="line">	i2 := reValue.Interface()</span><br><span class="line">	<span class="comment">// 利用断言，看看能不能转为int类型。</span></span><br><span class="line">	n, flag := i2.(Student)</span><br><span class="line">	<span class="keyword">if</span> flag == <span class="literal">true</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;名字是：%v,年龄是：%v&quot;</span>, n.Name, n.Age)</span><br><span class="line">		<span class="comment">// 获取变量类型</span></span><br><span class="line">		fmt.Printf(<span class="string">&quot;\n类型是:%T&quot;</span>, n)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Student <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="type">string</span></span><br><span class="line">	Age  <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 对基础数据类型进行反射</span></span><br><span class="line">	<span class="keyword">var</span> num <span class="type">int</span> = <span class="number">100</span></span><br><span class="line">	testReflect(num)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 对结构体反射</span></span><br><span class="line">	stu := Student&#123;</span><br><span class="line">		Name: <span class="string">&quot;丽丽&quot;</span>,</span><br><span class="line">		Age:  <span class="number">18</span>,</span><br><span class="line">	&#125;</span><br><span class="line">	testReflect(stu)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过反射修改变量</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;reflect&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 利用一个函数，函数的参数为空接口；</span></span><br><span class="line"><span class="comment">// 空接口没有方法，可以视为所有类型都实现了空接口。</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testReflect</span><span class="params">(i <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">	reValue := reflect.ValueOf(i)</span><br><span class="line">	fmt.Println(<span class="string">&quot;Value:&quot;</span>, reValue)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 通过Elen \SetInt 来改变值：</span></span><br><span class="line">	<span class="comment">// SetInt 设置v的持有值。如果v的Kind不是Int、Int8、Int16、Int32、Int64之一或者v.CanSet()返回假，会panic。</span></span><br><span class="line">	<span class="comment">// Elem Elem返回v持有的接口保管的值的Value封装，或者v持有的指针指向的值的Value封装。如果v的Kind不是Interface或Ptr会panic；如果v持有的值为nil，会返回Value零值。</span></span><br><span class="line">	reValue.Elem().SetInt(<span class="number">101</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Student <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="type">string</span></span><br><span class="line">	Age  <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> num <span class="type">int</span> = <span class="number">100</span></span><br><span class="line">	testReflect(&amp;num) <span class="comment">// 想要改变值 ，要传递指针。</span></span><br><span class="line">	fmt.Println(num)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;reflect&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Student <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="type">string</span></span><br><span class="line">	Age  <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s Student)</span></span> CPrint() &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;调用print方法，学生名字是：&quot;</span>, s.Name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s Student)</span></span> AGetSum(n1, n2 <span class="type">int</span>) <span class="type">int</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> n1 + n2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s Student)</span></span> BSet(name <span class="type">string</span>, age <span class="type">int</span>) &#123;</span><br><span class="line">	s.Name = name</span><br><span class="line">	s.Age = age</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个函数来 操作结构体 进行反射操作</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestStudentStruct</span><span class="params">(a <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">	<span class="comment">// 将a转成 reflect 的value 类型</span></span><br><span class="line">	val := reflect.ValueOf(a)</span><br><span class="line">	fmt.Println(val)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 操作结构体内部字段</span></span><br><span class="line">	n1 := val.NumField()</span><br><span class="line">	fmt.Println(<span class="string">&quot;结构体内部字段数为：&quot;</span>, n1)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n1; i++ &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;第%d个字段的值是：%v\n&quot;</span>, i, val.Field(i))</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 操作结构体内部方法</span></span><br><span class="line">	n2 := val.NumMethod()</span><br><span class="line">	fmt.Println(n2)</span><br><span class="line">	<span class="comment">// value 的 method 只能访问到 外部能访问的方法，也就是首字母大写的。</span></span><br><span class="line">	val.Method(<span class="number">2</span>).Call(<span class="literal">nil</span>) <span class="comment">//Call 的参数就是 结构体对应方法 输入的参数，上面的正好没有参数。</span></span><br><span class="line">	<span class="comment">// 定义Value 的切片,也就是一个切片，元素都是 reflect的Value类型。</span></span><br><span class="line">	<span class="keyword">var</span> params []reflect.Value</span><br><span class="line">	params = <span class="built_in">append</span>(params, reflect.ValueOf(<span class="number">10</span>))</span><br><span class="line">	params = <span class="built_in">append</span>(params, reflect.ValueOf(<span class="number">20</span>))</span><br><span class="line">	result := val.Method(<span class="number">0</span>).Call(params) <span class="comment">// Method 按照 ASCII 码取方法。 </span></span><br><span class="line">	fmt.Println(<span class="string">&quot;返回值是：&quot;</span>, result[<span class="number">0</span>], result)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	s := Student&#123;</span><br><span class="line">		Name: <span class="string">&quot;丽丽&quot;</span>,</span><br><span class="line">		Age:  <span class="number">18</span>,</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 调用</span></span><br><span class="line">	TestStudentStruct(s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;reflect&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Student <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="type">string</span></span><br><span class="line">	Age  <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s Student)</span></span> CPrint() &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;调用print方法，学生名字是：&quot;</span>, s.Name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s Student)</span></span> AGetSum(n1, n2 <span class="type">int</span>) <span class="type">int</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> n1 + n2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s Student)</span></span> BSet(name <span class="type">string</span>, age <span class="type">int</span>) &#123;</span><br><span class="line">	s.Name = name</span><br><span class="line">	s.Age = age</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个函数来 操作结构体 进行反射操作</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestStudentStruct</span><span class="params">(a <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">	<span class="comment">// 将a转成 reflect 的value 类型</span></span><br><span class="line">	val := reflect.ValueOf(a)</span><br><span class="line">	fmt.Println(val)</span><br><span class="line"></span><br><span class="line">	n := val.Elem().NumField()</span><br><span class="line">	fmt.Println(n)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 修改字段的值</span></span><br><span class="line">	val.Elem().Field(<span class="number">0</span>).SetString(<span class="string">&quot;张三&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	s := Student&#123;</span><br><span class="line">		Name: <span class="string">&quot;丽丽&quot;</span>,</span><br><span class="line">		Age:  <span class="number">18</span>,</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 调用</span></span><br><span class="line">	TestStudentStruct(&amp;s) <span class="comment">// 修改 要传 指针。</span></span><br><span class="line">	fmt.Println(s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="协程管道练习"><a href="#协程管道练习" class="headerlink" title="协程管道练习"></a>协程管道练习</h1><p><img src="/2025/01/01/go%E5%AD%A6%E4%B9%A0/go%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2023-09-18%2010.44.04.jpg" alt="截屏2023-09-18 10.44.04"></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> intChan <span class="keyword">chan</span> <span class="type">int</span> = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">10000</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> printChan <span class="keyword">chan</span> <span class="type">int</span> = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">10000</span>)</span><br><span class="line">	<span class="keyword">var</span> exitChan <span class="keyword">chan</span> <span class="type">bool</span> = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">bool</span>, <span class="number">8</span>)</span><br><span class="line">	<span class="keyword">go</span> initChan(<span class="number">10000</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt;= <span class="number">8</span>; i++ &#123;</span><br><span class="line">		<span class="keyword">go</span> isPrime(intChan, printChan, exitChan)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">8</span>; i++ &#123;</span><br><span class="line">			&lt;-exitChan</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">close</span>(printChan) <span class="comment">// 在这里关闭 上面的存放输出数据的管道。</span></span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		res, ok := &lt;-printChan</span><br><span class="line">		<span class="keyword">if</span> !ok &#123;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">		fmt.Println(<span class="string">&quot;素数是：&quot;</span>, res)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">initChan</span><span class="params">(num <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">1</span>; i &lt; num; i++ &#123;</span><br><span class="line">		intChan &lt;- i</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">close</span>(intChan) <span class="comment">// 写完后，不关闭掉，再读的时候可能有死锁问题。</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isPrime</span><span class="params">(intChan <span class="keyword">chan</span> <span class="type">int</span>, printChan <span class="keyword">chan</span> <span class="type">int</span>, exitChan <span class="keyword">chan</span> <span class="type">bool</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> flag <span class="type">bool</span></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		num, ok := &lt;-intChan</span><br><span class="line">		flag = <span class="literal">true</span></span><br><span class="line">		<span class="keyword">if</span> !ok &#123;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> j := <span class="number">2</span>; j &lt; num; j++ &#123;</span><br><span class="line">			<span class="keyword">if</span> num%j == <span class="number">0</span> &#123;</span><br><span class="line">				flag = <span class="literal">false</span></span><br><span class="line">				<span class="keyword">continue</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> flag &#123;</span><br><span class="line">			printChan &lt;- num</span><br><span class="line">			<span class="comment">// fmt.Println(num, &quot;是素数.&quot;)</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	exitChan &lt;- <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="label-和-select-管道"><a href="#label-和-select-管道" class="headerlink" title="label 和 select 管道"></a>label 和 select 管道</h2><p>​		管道写完都要 close，不然读的时候可能会死锁错误，如果不想总是用这个 锁，”每次操作管道”都要使用 label 配合 select 选择管道，select 的default 返回值 赋值给了label。</p>
<p><code>label: for &#123;select &#123;case := &lt;-chanName:</code><br><code> case := &lt;-chanName2:</code><br><code> default returnValue &#125;&#125;</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> intChan <span class="keyword">chan</span> <span class="type">int</span> = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">10000</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> printChan <span class="keyword">chan</span> <span class="type">int</span> = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">10000</span>)</span><br><span class="line">	<span class="keyword">var</span> exitChan <span class="keyword">chan</span> <span class="type">bool</span> = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">bool</span>, <span class="number">8</span>)</span><br><span class="line">	<span class="keyword">go</span> initChan(<span class="number">10000</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt;= <span class="number">8</span>; i++ &#123;</span><br><span class="line">		<span class="keyword">go</span> isPrime(intChan, printChan, exitChan)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">8</span>; i++ &#123;</span><br><span class="line">			&lt;-exitChan</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 用 label 配合 select 不再用 close关闭管道。</span></span><br><span class="line">		<span class="comment">//close(printChan) // 在这里关闭 上面的存放输出数据的管道。</span></span><br><span class="line">	&#125;()</span><br><span class="line">label:</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="keyword">select</span> &#123;</span><br><span class="line">		<span class="keyword">case</span> res := &lt;-printChan:</span><br><span class="line">			fmt.Println(<span class="string">&quot;素数是：&quot;</span>, res)</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="keyword">break</span> label</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">initChan</span><span class="params">(num <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">1</span>; i &lt; num; i++ &#123;</span><br><span class="line">		intChan &lt;- i</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">close</span>(intChan) <span class="comment">// 写完后，不关闭掉，再读的时候可能有死锁问题。</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isPrime</span><span class="params">(intChan <span class="keyword">chan</span> <span class="type">int</span>, printChan <span class="keyword">chan</span> <span class="type">int</span>, exitChan <span class="keyword">chan</span> <span class="type">bool</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> flag <span class="type">bool</span></span><br><span class="line">label:</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="keyword">select</span> &#123;</span><br><span class="line">		<span class="keyword">case</span> num := &lt;-intChan:</span><br><span class="line">			flag = <span class="literal">true</span></span><br><span class="line">			<span class="keyword">for</span> j := <span class="number">2</span>; j &lt; num; j++ &#123;</span><br><span class="line">				<span class="keyword">if</span> num%j == <span class="number">0</span> &#123;</span><br><span class="line">					flag = <span class="literal">false</span></span><br><span class="line">					<span class="keyword">continue</span></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> flag &#123;</span><br><span class="line">				printChan &lt;- num</span><br><span class="line">				<span class="comment">// fmt.Println(num, &quot;是素数.&quot;)</span></span><br><span class="line">			&#125;</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="keyword">break</span> label</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">&quot;协程已经结束&quot;</span>)</span><br><span class="line">	exitChan &lt;- <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2025/01/01/go%E5%AD%A6%E4%B9%A0/go%E7%AC%94%E8%AE%B0/%E6%88%AA%E5%B1%8F2023-09-19%2011.15.44.jpg" alt="截屏2023-09-19 11.15.44"></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;strconv&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println()</span><br><span class="line">	storageChan := <span class="built_in">make</span>(<span class="keyword">chan</span> Product, <span class="number">100</span>)</span><br><span class="line">	shopChan := <span class="built_in">make</span>(<span class="keyword">chan</span> Product, <span class="number">100</span>)</span><br><span class="line">	exitChan := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">bool</span>, <span class="number">1</span>)</span><br><span class="line">	<span class="comment">// 通过一个循环 开启多协程。</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">9</span>; i++ &#123; <span class="comment">// 但是这样一开以后，九个都会往管道写，每个都从10 开始循环，所以会被多个10填满管道。</span></span><br><span class="line">		<span class="keyword">go</span> Producer(storageChan, <span class="number">10</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// go Producer(storageChan, 10)</span></span><br><span class="line">	<span class="keyword">go</span> Logistics(storageChan, shopChan)</span><br><span class="line">	<span class="keyword">go</span> Consumer(shopChan, <span class="number">10</span>, exitChan)</span><br><span class="line">	<span class="keyword">if</span> &lt;-exitChan &#123;</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Product <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// storageChan 是只写。</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Producer</span><span class="params">(storageChan <span class="keyword">chan</span>&lt;- Product, count <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		producer := Product&#123;<span class="string">&quot;商品：&quot;</span> + strconv.Itoa(count)&#125;</span><br><span class="line">		storageChan &lt;- producer</span><br><span class="line">		time.Sleep(time.Second)</span><br><span class="line">		count--</span><br><span class="line">		fmt.Println(<span class="string">&quot;生产了，&quot;</span>, producer)</span><br><span class="line">		<span class="keyword">if</span> count &lt; <span class="number">1</span> &#123;</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// storageChan 是只读。</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Logistics</span><span class="params">(storageChan &lt;-<span class="keyword">chan</span> Product, shopChan <span class="keyword">chan</span>&lt;- Product)</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		product := &lt;-storageChan</span><br><span class="line">		shopChan &lt;- product</span><br><span class="line">		fmt.Println(<span class="string">&quot;运输了，&quot;</span>, product)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Consumer</span><span class="params">(shopChan &lt;-<span class="keyword">chan</span> Product, count <span class="type">int</span>, exitChan <span class="keyword">chan</span>&lt;- <span class="type">bool</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		product := &lt;-shopChan</span><br><span class="line">		fmt.Println(<span class="string">&quot;消费了，&quot;</span>, product)</span><br><span class="line">		count--</span><br><span class="line">		<span class="keyword">if</span> count &lt; <span class="number">1</span> &#123;</span><br><span class="line">			exitChan &lt;- <span class="literal">true</span></span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="管道定时任务应用"><a href="#管道定时任务应用" class="headerlink" title="管道定时任务应用"></a>管道定时任务应用</h2><p>第一类：定时任务，类似延时消息队列。</p>
<p>第二类：周期性执行某个任务，类似定期同步某些数据。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定时任务</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;math/rand&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> flag <span class="type">bool</span> = isStopTimer()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;当前时间&quot;</span>, time.Now())</span><br><span class="line">	<span class="comment">// 方式一</span></span><br><span class="line">	timer := time.NewTicker(time.Second * <span class="number">3</span>)</span><br><span class="line">	<span class="keyword">if</span> flag &#123;</span><br><span class="line">		timer.Stop()</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		t := &lt;-timer.C</span><br><span class="line">		fmt.Println(t)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 方式二</span></span><br><span class="line">	<span class="comment">// t := &lt;-time.After(time.Second * 3)</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isStopTimer</span><span class="params">()</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">	rand.Seed(time.Now().UnixNano())</span><br><span class="line">	tempInt := rand.Intn(<span class="number">2</span>) + <span class="number">18</span></span><br><span class="line">	<span class="keyword">if</span> tempInt &gt;= <span class="number">18</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;已经找到了大于18，结束。&quot;</span>)</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 周期任务</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> count <span class="type">int</span> = <span class="number">0</span></span><br><span class="line">	ticker := time.NewTicker(time.Second * <span class="number">1</span>) <span class="comment">// 定时器，定时间间隔。</span></span><br><span class="line">	<span class="comment">// 协程调用一个匿名函数，不停的输出定时器 管道中的时间，在&gt;3时停下计时器。</span></span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">for</span> &#123;</span><br><span class="line">			t := &lt;-ticker.C</span><br><span class="line">			fmt.Println(<span class="string">&quot;时间:&quot;</span>, t.Format(<span class="string">&quot;2003-01-02 03:04:05PM&quot;</span>))</span><br><span class="line">			count++</span><br><span class="line">			<span class="keyword">if</span> count &gt; <span class="number">3</span> &#123;</span><br><span class="line">				ticker.Stop()</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// for &#123;</span></span><br><span class="line">	<span class="comment">// 	t := &lt;-ticker.C</span></span><br><span class="line">	<span class="comment">// 	fmt.Println(&quot;时间:&quot;, t.Format(&quot;2003-01-02 03:04:05PM&quot;))</span></span><br><span class="line">	<span class="comment">// 	count++</span></span><br><span class="line">	<span class="comment">// 	if count &gt; 3 &#123;</span></span><br><span class="line">	<span class="comment">// 		ticker.Stop()</span></span><br><span class="line">	<span class="comment">// 	&#125;</span></span><br><span class="line">	<span class="comment">// &#125;</span></span><br><span class="line">	<span class="comment">//在第一个示例中，ticker.Stop() 是在协程内部执行的，当 count 大于 3 时，</span></span><br><span class="line">	<span class="comment">// 它会停止计时器。这样，</span></span><br><span class="line">	<span class="comment">// 协程内的 for 循环会因为 ticker.C 的通道关闭而结束，</span></span><br><span class="line">	<span class="comment">// 从而协程退出，程序继续执行后续代码，不会发生死锁。</span></span><br><span class="line">	<span class="comment">// 而在第二个示例中，ticker.Stop() 是在主函数内部执行的，</span></span><br><span class="line">	<span class="comment">// 但 for 循环仍然在继续从 ticker.C 接收时间值。</span></span><br><span class="line">	<span class="comment">// 当 ticker.Stop() 被调用后，ticker.C 通道会被关闭，</span></span><br><span class="line">	<span class="comment">// 但由于 for 循环仍在尝试从已关闭的通道中接收数据，会导致死锁错误。</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	time.Sleep(time.Second * <span class="number">10</span>)</span><br><span class="line">	fmt.Println(<span class="string">&quot;游戏结束&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> count <span class="type">int</span> = <span class="number">0</span></span><br><span class="line">	<span class="keyword">var</span> waitGroup sync.WaitGroup <span class="comment">// 有点像 别的语言的进程池的意思。但是控制的协程。</span></span><br><span class="line">	<span class="comment">// 用于向 WaitGroup 中添加指定数量的等待任务。</span></span><br><span class="line">	<span class="comment">// 通常在启动 goroutine 之前调用，表示有多少个任务需要等待完成。</span></span><br><span class="line">	waitGroup.Add(<span class="number">1</span>)</span><br><span class="line">	ticker := time.NewTicker(time.Second * <span class="number">1</span>) <span class="comment">// 定时器，定时间间隔。</span></span><br><span class="line">	<span class="comment">// 协程调用一个匿名函数，不停的输出定时器 管道中的时间，在&gt;3时停下计时器。</span></span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">defer</span> ticker.Stop()    <span class="comment">// 关闭定时器 的管道。</span></span><br><span class="line">		<span class="keyword">defer</span> waitGroup.Done() <span class="comment">// 书写的好习惯。表示一个协程任务已经完成。</span></span><br><span class="line">		<span class="keyword">for</span> &#123;</span><br><span class="line">			t := &lt;-ticker.C</span><br><span class="line">			fmt.Println(<span class="string">&quot;时间:&quot;</span>, t.Format(<span class="string">&quot;2003-01-02 03:04:05PM&quot;</span>))</span><br><span class="line">			count++</span><br><span class="line">			<span class="keyword">if</span> count &gt; <span class="number">3</span> &#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="comment">// 此时退出方法，进入defer的语句运行。</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	time.Sleep(time.Second * <span class="number">5</span>)</span><br><span class="line">	waitGroup.Wait() <span class="comment">// 结束协程池</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;游戏结束&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> count <span class="type">int</span> = <span class="number">0</span></span><br><span class="line">	<span class="keyword">var</span> waitGroup sync.WaitGroup <span class="comment">// 有点像 别的语言的进程池的意思。但是控制的协程。</span></span><br><span class="line">	<span class="comment">// 用于向 WaitGroup 中添加指定数量的等待任务。</span></span><br><span class="line">	<span class="comment">// 通常在启动 goroutine 之前调用，表示有多少个任务需要等待完成。</span></span><br><span class="line">	waitGroup.Add(<span class="number">1</span>)</span><br><span class="line">	ticker := time.NewTicker(time.Second * <span class="number">1</span>) <span class="comment">// 定时器，定时间间隔。</span></span><br><span class="line">	<span class="comment">// 协程调用一个匿名函数，不停的输出定时器 管道中的时间，在&gt;3时停下计时器。</span></span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">defer</span> ticker.Stop()    <span class="comment">// 关闭定时器 的管道。</span></span><br><span class="line">		<span class="keyword">defer</span> waitGroup.Done() <span class="comment">// 书写的好习惯。表示一个协程任务已经完成。</span></span><br><span class="line">		<span class="keyword">for</span> &#123;</span><br><span class="line">			t := &lt;-ticker.C</span><br><span class="line">			fmt.Println(<span class="string">&quot;ticker 时间:&quot;</span>, t.Format(<span class="string">&quot;2003-01-02 03:04:05PM&quot;</span>))</span><br><span class="line">			count++</span><br><span class="line">			<span class="keyword">if</span> count &gt; <span class="number">2</span> &#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="comment">// 此时退出方法，进入defer的语句运行。</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> countA <span class="type">int</span> = <span class="number">0</span></span><br><span class="line">	timer := time.NewTimer(time.Second * <span class="number">1</span>) <span class="comment">//单次触发的定时器，即定时器触发一次后就停止。</span></span><br><span class="line">	<span class="comment">// 协程调用一个匿名函数，不停的输出定时器 管道中的时间，在&gt;3时停下计时器。</span></span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">defer</span> timer.Stop()     <span class="comment">// 关闭定时器 的管道。</span></span><br><span class="line">		<span class="keyword">defer</span> waitGroup.Done() <span class="comment">// 书写的好习惯。表示一个协程任务已经完成。</span></span><br><span class="line">		<span class="keyword">for</span> &#123;</span><br><span class="line">			t := &lt;-ticker.C</span><br><span class="line">			fmt.Println(<span class="string">&quot;timer 时间:&quot;</span>, t.Format(<span class="string">&quot;2003-01-02 03:04:05PM&quot;</span>))</span><br><span class="line">			<span class="comment">// 重新设置定时器 timer，使其在1秒后触发。这意味着原来的定时器计时将被取消，</span></span><br><span class="line">			<span class="comment">// 并在调用 Reset 后重新开始计时，1秒后触发。</span></span><br><span class="line">			timer.Reset(time.Second)</span><br><span class="line">			countA++</span><br><span class="line">			<span class="keyword">if</span> countA &gt; <span class="number">3</span> &#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="comment">// 此时退出方法，进入defer的语句运行。</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	time.Sleep(time.Second * <span class="number">5</span>)</span><br><span class="line">	waitGroup.Wait() <span class="comment">// 结束协程池</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;游戏结束&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/go/" rel="tag"># go</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2024/12/25/Linux%E5%AD%A6%E4%B9%A0/CentOS%207%20%E6%9B%B4%E6%96%B0baseurl_for_repo/" rel="prev" title="CentOS 7 更新baseurl_for_repo">
                  <i class="fa fa-chevron-left"></i> CentOS 7 更新baseurl_for_repo
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2025/01/04/%20%E6%B8%B8%E6%B3%B3%E5%AD%A6%E4%B9%A0/%E6%B8%B8%E6%B3%B3%E5%AD%A6%E4%B9%A0/" rel="next" title="游泳学习">
                  游泳学习 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">陈宇韶chenyushao</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
