---
layout: posts
title: 服务器集群配置共享存储的过程
date: 2024-10-19 22:32:10
description: "这是文章开头，显示在主页面，详情请点击此处。"
categories: 
- "装机"
tags:
- "LUN映射"
- "交换机"

---



# 背景

记录服务器集群添加新机器后，这台新机器是找不到共享存储的，以下就是让它找到共享存储的过程。



# 总体逻辑

1. **服务器HBA卡连接到FC交换机上**    
2. **FC交换机上配置zone**    
3. **存储上添加主机LUN映射**   
4. **超融合平台添加新主机 这个在存储设备中 添加 新主机的LUN 映射** 

​		

​		在存储设备中添加新主机的LUN（逻辑单元号）映射是指将存储设备中的特定存储卷（LUN）分配给特定主机，以便该主机可以访问这些存储资源。这一过程通常用于存储区域网络（SAN）中，以实现主机与存储设备之间的有效通信和数据存取。

### 1. 服务器HBA卡连接到FC交换机上

**HBA（Host Bus Adapter）卡**是连接服务器与存储网络的重要组件。HBA卡将服务器的SCSI或SATA接口转换为光纤通道（FC）信号，使服务器能够通过FC网络访问存储设备。

- **连接目的**：通过HBA卡，服务器可以将数据发送到FC交换机，从而与存储设备进行通信。

- **操作要求**：确保HBA卡正确安装在服务器中，并通过光纤线缆与FC交换机相连。

  ![image-20241019204901472](%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE%E5%85%B1%E4%BA%AB%E5%AD%98%E5%82%A8%E7%9A%84%E8%BF%87%E7%A8%8B/image-20241019204901472.png)

![image-20241019204934143](%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE%E5%85%B1%E4%BA%AB%E5%AD%98%E5%82%A8%E7%9A%84%E8%BF%87%E7%A8%8B/image-20241019204934143.png)



### 2. FC交换机上配置zone

**Zone**是FC交换机中的一种配置，旨在控制设备之间的访问权限。

- **配置目的**：通过将特定的HBA卡和存储设备分配到同一个zone中，可以实现它们之间的通信。相应地，将不在同一zone中的设备隔离，以提高安全性。

- **操作要求**：通常需要在FC交换机的管理界面中，创建一个zone，并将服务器的HBA和相应的存储LUN添加到该zone中。

  ```apl
  # 先进入连接存储和服务器 FC交换机 ；
  # 可以通过 FC交换机的console控制口 在笔记本用一根 console 转 USB口的线连接；
  # 以Windows为例
  # 进入 【我的电脑】【管理】【设备管理器】【端口】看看 带serial的是哪一个口，比如说COM3等；
  # 进入 笔记本中的 xshell 或者其他远程工具，【串口】选择刚才的端口如 COM3，【波特率】用默认的9600，【协议】不用ssh改用serial；
  # 用 光交换机的 账号密码登录；
  ```

先通过 `switchshow` 命令看看 新加的服务器是不是在端口识别出来了，注意是从 0 开始计数，16 就是 第17个端口显示了连接。

![image-20241019210336106](%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE%E5%85%B1%E4%BA%AB%E5%AD%98%E5%82%A8%E7%9A%84%E8%BF%87%E7%A8%8B/image-20241019210336106.png)

用 `cfgshwo` 命令查看 zone的情况；

注意：  每一个 zone，  例如 【server10_cf5010】 是一个的zone名称，是自定义命名的只是为了方便自己记忆理解，下面的 【cf5010】是存储，【server10】是服务器，它们都是自定义的下面有解释；

![image-20241019210402111](%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE%E5%85%B1%E4%BA%AB%E5%AD%98%E5%82%A8%E7%9A%84%E8%BF%87%E7%A8%8B/image-20241019210402111.png)

可见 alias（别名）解释了上面的 命名，如 【cf5010】是交换机ID为1的20号、21号、22号、23号四个端口的别名；【server10】其实就是 FC交换机的 ID为1 的9号端口的别名。 

![截屏2024-10-19 21.22.07](%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE%E5%85%B1%E4%BA%AB%E5%AD%98%E5%82%A8%E7%9A%84%E8%BF%87%E7%A8%8B/%E6%88%AA%E5%B1%8F2024-10-19%2021.22.07.jpg)

说的糙一点就是一个zone 就是把两个端口的通信建立起来；



### 3. 存储上添加主机LUN映射

**LUN（Logical Unit Number）映射**是将存储设备中的逻辑单元（如硬盘卷）分配给特定主机的过程。

- **映射目的**：使特定的服务器能够访问某个存储卷（LUN）。这可以确保只有授权的主机可以访问敏感数据，并优化存储资源的使用。
- **操作要求**：在存储设备的管理界面中，选择要映射的LUN，并将其与前面配置的主机进行关联。可能还需设置访问权限。

我这里是通过 web的管理页面进去

在这个【Data Access】建立一个 host对象（就是服务器），对象内属性【initiators】（发起者）就是服务器中的HAB口，属性【volumes】5 对应存储中的卷的数量，意思是1号主机节点对象，对应了存储中划好的5个卷；

![截屏2024-10-19 21.39.18](%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE%E5%85%B1%E4%BA%AB%E5%AD%98%E5%82%A8%E7%9A%84%E8%BF%87%E7%A8%8B/%E6%88%AA%E5%B1%8F2024-10-19%2021.39.18.jpg)

#### 3-1、设置主机对象

在存储上要为新服务器 设置一个 host对象。点【Data Access】上的➕，这里的名字也是自定义的方便自己看，target port All 指的是 存储作为目标 开放所有端口，【initiators】 发起人 当然是 HBA卡啦，我们只有一张HBA卡的话，为了方便记忆，就可以写成initiators1，【WWPN】 就是 在FC交换机中 `switchshow` 命令中看到的 protol 对应的 服务器的 一长串 10:XX:XX:XX... 的编号。

![截屏2024-10-19 21.48.32](%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE%E5%85%B1%E4%BA%AB%E5%AD%98%E5%82%A8%E7%9A%84%E8%BF%87%E7%A8%8B/%E6%88%AA%E5%B1%8F2024-10-19%2021.48.32.jpg)

#### 3-2、作卷到主机对象的映射

在【Data Storage】 存储中一个一个编辑 volume卷的内容，点 笔的图标；

![截屏2024-10-19 21.57.36](%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE%E5%85%B1%E4%BA%AB%E5%AD%98%E5%82%A8%E7%9A%84%E8%BF%87%E7%A8%8B/%E6%88%AA%E5%B1%8F2024-10-19%2021.57.36.jpg)

一步一步 next ，找到 出现添加主机的页面，为这个卷 添加 前面设置的 主机节点对象；

![截屏2024-10-19 21.59.38](%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE%E5%85%B1%E4%BA%AB%E5%AD%98%E5%82%A8%E7%9A%84%E8%BF%87%E7%A8%8B/%E6%88%AA%E5%B1%8F2024-10-19%2021.59.38.jpg)

![截屏2024-10-19 22.01.56](%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE%E5%85%B1%E4%BA%AB%E5%AD%98%E5%82%A8%E7%9A%84%E8%BF%87%E7%A8%8B/%E6%88%AA%E5%B1%8F2024-10-19%2022.01.56.jpg)

记得save保存。



### 4. 超融合平台添加新主机

**超融合平台**是一种将计算、存储和网络资源整合到单一系统中的解决方案，通常用于简化数据中心的管理。

- **添加目的**：在超融合平台上注册新的主机，以便它可以利用存储和计算资源。这通常涉及将新主机纳入集群，使其能够访问共享存储。
- **操作要求**：在超融合平台的管理界面中，选择“添加主机”或类似选项，输入新主机的相关信息（如IP地址、访问凭证等），并确保它能够访问之前配置的存储和网络资源。



在主机集群的【存储】栏，一个卷一个卷的 去【发现主机】

![截屏2024-10-19 22.06.47](%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE%E5%85%B1%E4%BA%AB%E5%AD%98%E5%82%A8%E7%9A%84%E8%BF%87%E7%A8%8B/%E6%88%AA%E5%B1%8F2024-10-19%2022.06.47.jpg)

![截屏2024-10-19 22.08.57](%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE%E5%85%B1%E4%BA%AB%E5%AD%98%E5%82%A8%E7%9A%84%E8%BF%87%E7%A8%8B/%E6%88%AA%E5%B1%8F2024-10-19%2022.08.57.jpg)
